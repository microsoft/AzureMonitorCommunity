{
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "Pure Storage",
      "metadata": {
        "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "workbook",
      "metadata": {
        "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
      }
    },
    "workspaceLAW": {
      "type": "string",
      "defaultValue": "afoinc-nft-law",
      "metadata": {
        "description": "The friendly name for the workspace that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "connectedCluster": {
      "type": "string",
      "defaultValue": "nft-target-cluster",
      "metadata": {
        "description": "The friendly name for the connected cluster.  This name must be unique within a resource group."
      }
    },
    "workbookSourceId": {
      "type": "string",
      "defaultValue": "[concat(resourceGroup().id, '/providers/microsoft.operationalinsights/workspaces/', parameters('workspaceLAW'))]",
      "metadata": {
        "description": "The id of resource instance to which the workbook will be associated"
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    },
    "workbookConnectedCluster": {
      "type": "string",
      "defaultValue": "[concat(resourceGroup().id, '/providers/Microsoft.Kubernetes/connectedClusters/', parameters('connectedCluster'))]",
      "metadata": {
        "description": "The id of resource instance to which the workbook will be associated"
      }
    },
    "workbookLocation": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "The Azure region with which the workbook will be associated"
      }
    }
  },
  "variables": {
    "workbookContent": {
      "version": "Notebook/1.0",
      "items": [
        {
          "type": 1,
          "content": {
            "json": "# PURE Storage Dashboard\r\n---\r\n\r\nGet more value from your data with an easy-to-deploy, high-performance data experience, delivering real-time analytics on an all-flash distributed platform. Pure Storage helps you embrace the future of cloud and data flexibility with a true, as-a-service model that's simple to manage and always evergreen."
          },
          "name": "text - 7"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "parameters": [
                    {
                      "id": "0d1a63c9-7f3e-4b58-9787-46f7adf69a83",
                      "version": "KqlParameterItem/1.0",
                      "name": "Timeframe",
                      "type": 4,
                      "isRequired": true,
                      "isGlobal": true,
                      "value": {
                        "durationMs": 7776000000
                      },
                      "typeSettings": {
                        "selectableValues": [
                          {
                            "durationMs": 300000
                          },
                          {
                            "durationMs": 900000
                          },
                          {
                            "durationMs": 1800000
                          },
                          {
                            "durationMs": 3600000
                          },
                          {
                            "durationMs": 14400000
                          },
                          {
                            "durationMs": 43200000
                          },
                          {
                            "durationMs": 86400000
                          },
                          {
                            "durationMs": 172800000
                          },
                          {
                            "durationMs": 259200000
                          },
                          {
                            "durationMs": 604800000
                          },
                          {
                            "durationMs": 1209600000
                          },
                          {
                            "durationMs": 2419200000
                          },
                          {
                            "durationMs": 2592000000
                          },
                          {
                            "durationMs": 5184000000
                          },
                          {
                            "durationMs": 7776000000
                          }
                        ],
                        "allowCustom": true
                      },
                      "timeContext": {
                        "durationMs": 86400000
                      }
                    },
                    {
                      "id": "22898831-b5df-42f2-9cce-8b159cad03de",
                      "version": "KqlParameterItem/1.0",
                      "name": "Resource",
                      "label": "Workspace",
                      "type": 5,
                      "isRequired": true,
                      "isGlobal": true,
                      "query": "InsightsMetrics \r\n| where Namespace == \"prometheus\" and Name has \"purefa\"\r\n| distinct _ResourceId",
                      "typeSettings": {
                        "additionalResourceOptions": ["value::1"],
                        "showDefault": false
                      },
                      "timeContext": {
                        "durationMs": 0
                      },
                      "timeContextFromParameter": "Timeframe",
                      "defaultValue": "value::1",
                      "queryType": 0,
                      "resourceType": "microsoft.operationalinsights/workspaces",
                      "value": "[parameters('workbookConnectedCluster')]"
                    },
                    {
                      "id": "3611a3f2-125e-4ca3-86f1-83418b003244",
                      "version": "KqlParameterItem/1.0",
                      "name": "Computer",
                      "label": "Hostname",
                      "type": 2,
                      "isRequired": true,
                      "isGlobal": true,
                      "multiSelect": true,
                      "quote": "'",
                      "delimiter": ",",
                      "query": "InsightsMetrics\r\n| summarize by Computer",
                      "crossComponentResources": ["{Resource}"],
                      "typeSettings": {
                        "additionalResourceOptions": ["value::all"],
                        "showDefault": false
                      },
                      "timeContext": {
                        "durationMs": 0
                      },
                      "timeContextFromParameter": "Timeframe",
                      "defaultValue": "value::all",
                      "queryType": 0,
                      "resourceType": "microsoft.kubernetes/connectedclusters"
                    }
                  ],
                  "style": "above",
                  "queryType": 0,
                  "resourceType": "microsoft.kubernetes/connectedclusters"
                },
                "name": "parameters - 0"
              }
            ],
            "exportParameters": true
          },
          "name": "parameter"
        },
        {
          "type": 11,
          "content": {
            "version": "LinkItem/1.0",
            "style": "tabs",
            "links": [
              {
                "id": "33b4b53e-aba4-444f-8b64-439509a4c98c",
                "cellValue": "setTab",
                "linkTarget": "parameter",
                "linkLabel": "Pure Storage FlashArray Landscape",
                "subTarget": "Landscape",
                "preText": "Pure Storage FlashArray Landscape",
                "style": "link"
              },
              {
                "id": "79552baa-9948-4204-8bb0-b28681a2d0d6",
                "cellValue": "setTab",
                "linkTarget": "parameter",
                "linkLabel": "Pure Storage FlashArray Storage Usage Overview",
                "subTarget": "StorageO",
                "style": "link"
              },
              {
                "id": "8d06ae1a-6de8-4c30-96d5-2d539654e4dd",
                "cellValue": "setTab",
                "linkTarget": "parameter",
                "linkLabel": "Pure Storage FlashArray Volume Detail",
                "subTarget": "Volume",
                "style": "link"
              },
              {
                "id": "8e629aad-a74d-4cff-8fa0-fb628262f009",
                "cellValue": "setTab",
                "linkTarget": "parameter",
                "linkLabel": "Pure Pod/Container Analysis",
                "subTarget": "Log",
                "style": "link"
              }
            ]
          },
          "name": "links - 3"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "title": "Flasharray Capacity",
                        "items": [
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics \r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_info\"\r\n| parse-where kind = regex Tags with \"array_name\\\":\\\"\" array_name \"\\\",\" *\r\n| extend a=split(array_name,'\"')\r\n| project array_name=a[0]\r\n| summarize by tostring(array_name)",
                              "size": 3,
                              "title": "Array Name",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "card",
                              "tileSettings": {
                                "titleContent": {},
                                "leftContent": {
                                  "columnMatch": "array_name",
                                  "formatter": 1,
                                  "formatOptions": {
                                    "compositeBarSettings": {
                                      "labelText": "",
                                      "columnSettings": []
                                    }
                                  }
                                },
                                "showBorder": false
                              },
                              "textSettings": {
                                "style": "bignumber"
                              }
                            },
                            "name": "query - 0",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"\r\n| summarize capacityBytes=avgif(Val, Name contains \"purefa_array_space_capacity_bytes\")",
                              "size": 3,
                              "title": "Total Capacity",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {},
                                "leftContent": {
                                  "columnMatch": "capacityBytes",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "blue"
                                  },
                                  "numberFormat": {
                                    "unit": 2,
                                    "options": {
                                      "style": "decimal"
                                    }
                                  }
                                },
                                "showBorder": false
                              }
                            },
                            "name": "query - 0",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"\r\n| summarize usedBytes=avgif(Val, Name contains \"purefa_array_space_used_bytes\"), capacityBytes=avgif(Val, Name contains \"purefa_array_space_capacity_bytes\")\r\n| extend FreeSpace=capacityBytes-usedBytes",
                              "size": 3,
                              "title": "Free Space",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {},
                                "leftContent": {
                                  "columnMatch": "FreeSpace",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "blue"
                                  },
                                  "numberFormat": {
                                    "unit": 2,
                                    "options": {
                                      "style": "decimal"
                                    }
                                  }
                                },
                                "showBorder": false,
                                "size": "auto"
                              }
                            },
                            "name": "query - 0 - Copy",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"\r\n| summarize usedBytes=avgif(Val, Name contains \"purefa_array_space_used_bytes\"), capacityBytes=avgif(Val, Name contains \"purefa_array_space_capacity_bytes\")\r\n| extend FreeSpace80=(capacityBytes*(0.8))-usedBytes",
                              "size": 3,
                              "title": "Free Space with 80% capacity",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {},
                                "leftContent": {
                                  "columnMatch": "FreeSpace80",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "blue"
                                  },
                                  "numberFormat": {
                                    "unit": 2,
                                    "options": {
                                      "style": "decimal"
                                    }
                                  }
                                },
                                "showBorder": false,
                                "size": "auto"
                              }
                            },
                            "name": "query - 0 - Copy",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"\r\n| summarize usedBytes=avgif(Val, Name contains \"purefa_array_space_used_bytes\"), capacityBytes=avgif(Val, Name contains \"purefa_array_space_capacity_bytes\"), datareduction=avgif(Val, Name contains \"purefa_array_space_datareduction_ratio\")\r\n| extend FreeUsable=((capacityBytes*toint(0.8))-usedBytes)*datareduction\r\n\r\n//((sum(purefa_array_space_capacity_bytes{job=~\"$job\",instance=~\"$instance\"}) * $norm_percent /100)\r\n//-\r\n//sum(purefa_array_space_used_bytes{job=~\"$job\",instance=~\"$instance\"})) \r\n//* \r\n//avg(purefa_array_space_datareduction_ratio{job=~\"$job\",instance=~\"$instance\"})",
                              "size": 3,
                              "title": "Free Usable",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {},
                                "leftContent": {
                                  "columnMatch": "FreeUsable",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "blue"
                                  },
                                  "numberFormat": {
                                    "unit": 2,
                                    "options": {
                                      "style": "decimal"
                                    }
                                  }
                                },
                                "showBorder": false,
                                "size": "auto"
                              }
                            },
                            "name": "query - 0 - Copy - Copy",
                            "styleSettings": {
                              "showBorder": true
                            }
                          }
                        ]
                      },
                      "customWidth": "20",
                      "name": "storage top"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "let usedBytes = \r\nInsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_array_space_used_bytes\"\r\n| summarize usedBytes=avg(Val) by bin(TimeGenerated, 30m);\r\nInsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_array_space_capacity_bytes\"\r\n| summarize capacityBytes=avg(Val) by bin(TimeGenerated, 30m)\r\n| join (usedBytes) on TimeGenerated\r\n| extend Free_Space = capacityBytes-toint(toscalar(usedBytes))",
                        "size": 3,
                        "aggregation": 3,
                        "title": "Free Space",
                        "timeContextFromParameter": "Timeframe",
                        "queryType": 0,
                        "resourceType": "microsoft.kubernetes/connectedclusters",
                        "crossComponentResources": ["{Resource}"],
                        "visualization": "timechart",
                        "chartSettings": {
                          "xAxis": "TimeGenerated",
                          "yAxis": ["Free_Space", "capacityBytes", "usedBytes"],
                          "group": null,
                          "createOtherGroup": 0,
                          "ySettings": {
                            "numberFormatSettings": {
                              "unit": 2,
                              "options": {
                                "style": "decimal",
                                "useGrouping": true,
                                "maximumFractionDigits": 2
                              }
                            }
                          }
                        }
                      },
                      "customWidth": "60",
                      "name": "query - 1 - Copy",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "title": "Capacity Usage & Provisioned on Arrays",
                        "items": [
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_array_space_used_bytes\"\r\n| summarize UsedBytes=avg(Val)\r\n",
                              "size": 3,
                              "title": "Capacity Usage on Arrays",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {},
                                "leftContent": {
                                  "columnMatch": "UsedBytes",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "blue"
                                  },
                                  "numberFormat": {
                                    "unit": 2,
                                    "options": {
                                      "style": "decimal"
                                    }
                                  }
                                },
                                "showBorder": false
                              },
                              "chartSettings": {
                                "ySettings": {
                                  "numberFormatSettings": {
                                    "unit": 2,
                                    "options": {
                                      "style": "decimal",
                                      "useGrouping": true
                                    }
                                  }
                                }
                              }
                            },
                            "name": "query - 0",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_array_space_provisioned_bytes\"\r\n| summarize UsedBytes=avg(Val)",
                              "size": 3,
                              "title": "Provisioned bytes on Arrays",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {},
                                "leftContent": {
                                  "columnMatch": "UsedBytes",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "blue"
                                  },
                                  "numberFormat": {
                                    "unit": 2,
                                    "options": {
                                      "style": "decimal",
                                      "useGrouping": false
                                    }
                                  }
                                },
                                "showBorder": false,
                                "size": "auto"
                              }
                            },
                            "name": "query - 1",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "let provisionedBytes=InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_array_space_provisioned_bytes\"\r\n| summarize provisionedBytes=sum(Val);\r\nInsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_array_space_capacity_bytes\"\r\n| summarize CapacityBytes=sum(Val)\r\n| extend OverProvisionedBytes=toscalar(provisionedBytes)/CapacityBytes",
                              "size": 3,
                              "title": "Over Provisioned bytes on Arrays",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {},
                                "leftContent": {
                                  "columnMatch": "OverProvisionedBytes",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "blue"
                                  }
                                },
                                "showBorder": false,
                                "size": "auto"
                              }
                            },
                            "name": "query - 1 - Copy",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_array_space_datareduction_ratio\"\r\n| summarize datareductionratio=avg(Val)",
                              "size": 3,
                              "title": "Datareduction Ratio",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {},
                                "leftContent": {
                                  "columnMatch": "datareductionratio",
                                  "numberFormat": {
                                    "unit": 0,
                                    "options": {
                                      "style": "decimal",
                                      "maximumFractionDigits": 2
                                    }
                                  }
                                },
                                "showBorder": false
                              }
                            },
                            "name": "query - 4",
                            "styleSettings": {
                              "showBorder": true
                            }
                          }
                        ]
                      },
                      "customWidth": "20",
                      "name": "storage top - Copy"
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_array_performance_iops\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend dimension=tostring(json.dimension)\r\n| summarize avg(Val) by dimension",
                              "size": 3,
                              "title": "Average IOPS",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {
                                  "columnMatch": "dimension",
                                  "formatter": 1
                                },
                                "leftContent": {
                                  "columnMatch": "avg_Val",
                                  "formatter": 18,
                                  "formatOptions": {
                                    "thresholdsOptions": "colors",
                                    "thresholdsGrid": [
                                      {
                                        "operator": ">=",
                                        "thresholdValue": "80000",
                                        "representation": "redBright",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": ">=",
                                        "thresholdValue": "50000",
                                        "representation": "yellow",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": "Default",
                                        "thresholdValue": null,
                                        "representation": "green",
                                        "text": "{0}{1}"
                                      }
                                    ]
                                  },
                                  "numberFormat": {
                                    "unit": 0,
                                    "options": {
                                      "style": "decimal",
                                      "maximumFractionDigits": 2,
                                      "maximumSignificantDigits": 3
                                    }
                                  }
                                },
                                "showBorder": true,
                                "sortCriteriaField": "sum_Val",
                                "sortOrderField": 2,
                                "size": "auto"
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 0"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_array_performance_latency_usec\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend dimension=tostring(json.dimension)\r\n| summarize avg=avg(Val)/1000 by dimension\r\n| where avg > 0\r\n| order by avg desc\r\n| limit 3",
                              "size": 3,
                              "title": "Average IO Latency",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {
                                  "columnMatch": "dimension",
                                  "formatter": 1
                                },
                                "leftContent": {
                                  "columnMatch": "avg",
                                  "formatter": 18,
                                  "formatOptions": {
                                    "thresholdsOptions": "colors",
                                    "thresholdsGrid": [
                                      {
                                        "operator": ">=",
                                        "thresholdValue": "1.5",
                                        "representation": "redBright",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": ">=",
                                        "thresholdValue": "0.8",
                                        "representation": "yellow",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": "Default",
                                        "thresholdValue": null,
                                        "representation": "green",
                                        "text": "{0}{1}"
                                      }
                                    ]
                                  },
                                  "numberFormat": {
                                    "unit": 0,
                                    "options": {
                                      "style": "decimal",
                                      "maximumFractionDigits": 2,
                                      "maximumSignificantDigits": 3
                                    }
                                  }
                                },
                                "showBorder": true,
                                "sortCriteriaField": "avg",
                                "sortOrderField": 2,
                                "size": "auto"
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 1"
                          }
                        ]
                      },
                      "name": "Average",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "let usedBytes = \r\nInsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_array_space_used_bytes\"\r\n| summarize usedBytes=avg(Val) by Computer;\r\nInsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_array_space_capacity_bytes\"\r\n| summarize capacityBytes=avg(Val) by Computer\r\n| join (usedBytes) on Computer\r\n| extend Free_space = capacityBytes-usedBytes\r\n| extend Capacity_Usage = usedBytes/capacityBytes*100\r\n| extend Allocation=round(Capacity_Usage,3)\r\n| join kind = inner( InsightsMetrics\r\n    | where Computer in ({Computer})\r\n    | where Namespace == \"prometheus\"and Name contains \"purefa_array_space_used_bytes\"\r\n    | make-series Usage_Trend = avg(Val) default = 0 on TimeGenerated from  {Timeframe:start} to {Timeframe:end} step 1h by Computer\r\n    | project-away TimeGenerated\r\n    ) on Computer",
                              "size": 3,
                              "title": "Capacity Usage Table",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "table",
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "Computer",
                                    "formatter": 5
                                  },
                                  {
                                    "columnMatch": "capacityBytes",
                                    "formatter": 5,
                                    "numberFormat": {
                                      "unit": 2,
                                      "options": {
                                        "style": "decimal"
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "Computer1",
                                    "formatter": 5
                                  },
                                  {
                                    "columnMatch": "usedBytes",
                                    "formatter": 3,
                                    "formatOptions": {
                                      "palette": "turquoise",
                                      "customColumnWidthSetting": "50ch"
                                    },
                                    "numberFormat": {
                                      "unit": 2,
                                      "options": {
                                        "style": "decimal"
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "Free_space",
                                    "formatter": 5,
                                    "numberFormat": {
                                      "unit": 2,
                                      "options": {
                                        "style": "decimal"
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "Capacity_Usage",
                                    "formatter": 0,
                                    "formatOptions": {
                                      "customColumnWidthSetting": "35ch"
                                    },
                                    "numberFormat": {
                                      "unit": 1,
                                      "options": {
                                        "style": "decimal"
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "Allocation",
                                    "formatter": 5,
                                    "formatOptions": {
                                      "compositeBarSettings": {
                                        "labelText": "",
                                        "columnSettings": [
                                          {
                                            "columnName": "capacityBytes",
                                            "color": "blue"
                                          },
                                          {
                                            "columnName": "usedBytes",
                                            "color": "green"
                                          },
                                          {
                                            "columnName": "Free_space",
                                            "color": "yellow"
                                          }
                                        ]
                                      }
                                    },
                                    "numberFormat": {
                                      "unit": 2,
                                      "options": {
                                        "style": "decimal"
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "Usage_Trend",
                                    "formatter": 9,
                                    "formatOptions": {
                                      "palette": "coldHot",
                                      "customColumnWidthSetting": "100ch"
                                    }
                                  }
                                ],
                                "hierarchySettings": {
                                  "treeType": 1,
                                  "groupBy": ["Computer"],
                                  "expandTopLevel": true
                                }
                              },
                              "tileSettings": {
                                "showBorder": false
                              }
                            },
                            "customWidth": "70",
                            "name": "query - 0",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "let total_iops = InsightsMetrics\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_performance_iops\"\r\n| summarize total_iops=sum(Val)\r\n;\r\nInsightsMetrics\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_performance_iops\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend dimension=tostring(json.dimension)\r\n| extend volume=tostring(json.volume)\r\n| summarize iops=sum(Val) by dimension\r\n| extend total_iops=toscalar(total_iops)\r\n| extend iops_ratio = (iops/total_iops)*100",
                              "size": 3,
                              "title": "IOPS Ratio",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "piechart",
                              "chartSettings": {
                                "yAxis": ["iops_ratio"],
                                "group": "dimension",
                                "createOtherGroup": null,
                                "ySettings": {
                                  "numberFormatSettings": {
                                    "unit": 1,
                                    "options": {
                                      "style": "decimal",
                                      "useGrouping": true
                                    }
                                  }
                                }
                              }
                            },
                            "customWidth": "30",
                            "name": "query - 6",
                            "styleSettings": {
                              "showBorder": true
                            }
                          }
                        ]
                      },
                      "name": "group - 6"
                    }
                  ]
                },
                "name": "group - 5",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 1,
                "content": {
                  "json": "## Anomaly Detection & Trend Analysis"
                },
                "name": "text - 4"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "###     Anomaly Detection for UsedBytes"
                      },
                      "name": "text - 4 - Copy"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_array_space_used_bytes\"\r\n| project TimeGenerated, Computer, Val\r\n| summarize usedBytes=avg(Val), ActualusedBytes=avg(Val) by bin(TimeGenerated, 1d), Computer\r\n| summarize Timestamp=make_list(TimeGenerated), usedBytes=make_list(usedBytes) by Computer\r\n| extend series_decompose_anomalies(usedBytes)\r\n| mv-expand Timestamp, usedBytes, series_decompose_anomalies_usedBytes_ad_flag, series_decompose_anomalies_usedBytes_ad_score, series_decompose_anomalies_usedBytes_baseline\r\n| project-away series_decompose_anomalies_usedBytes_ad_score\r\n| project-rename ExpectedusedBytes=series_decompose_anomalies_usedBytes_baseline\r\n| project-rename Anomalies=series_decompose_anomalies_usedBytes_ad_flag\r\n| extend Gap = todecimal(usedBytes)-todecimal(ExpectedusedBytes)\r\n| where Gap != 0\r\n| extend Trend=iff(Gap>0, \"Up\", \"Down\")\r\n| extend ActualVsExpectedAsPercent = round(todecimal(usedBytes)*100/todecimal(ExpectedusedBytes), 2)\r\n| sort by todatetime(Timestamp) asc\r\n| extend Avg_usedBytes = round(todecimal(usedBytes) / 1000000000,3), Expected_Avg_usedBytes = round(todecimal(ExpectedusedBytes) / 1000000000,3)\r\n| extend Alert = case(ActualVsExpectedAsPercent>120, \"Alert\",ActualVsExpectedAsPercent<60, \"Alert\", \"OK\")\r\n| project Computer, Timestamp=format_datetime(todatetime(Timestamp), 'yyyy-MM-dd'), Trend, Avg_usedBytes, Expected_Avg_usedBytes, ActualVsExpectedAsPercent, Alert, Anomalies",
                        "size": 0,
                        "title": "Daily usedBytes Trend analysis",
                        "timeContextFromParameter": "Timeframe",
                        "queryType": 0,
                        "resourceType": "microsoft.kubernetes/connectedclusters",
                        "crossComponentResources": ["{Resource}"],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Computer",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Trend",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Up",
                                    "representation": "trendup",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Down",
                                    "representation": "trenddown",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ActualVsExpectedAsPercent",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal"
                                }
                              }
                            },
                            {
                              "columnMatch": "Alert",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Alert",
                                    "representation": "4",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Available",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            }
                          ],
                          "hierarchySettings": {
                            "treeType": 1,
                            "groupBy": ["Computer"],
                            "expandTopLevel": true
                          }
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 0",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_array_space_used_bytes\"\r\n| summarize usedBytes=avg(Val) by bin(TimeGenerated, 30m), Computer\r\n| order by TimeGenerated asc\r\n| summarize Timestamp=make_list(TimeGenerated), usedBytes=make_list(usedBytes) by Computer\r\n| extend series_decompose_anomalies(usedBytes, 1.5, -1, 'linefit')\r\n| mv-expand Timestamp, usedBytes, series_decompose_anomalies_usedBytes_ad_flag, series_decompose_anomalies_usedBytes_ad_score, series_decompose_anomalies_usedBytes_baseline\r\n| project-away series_decompose_anomalies_usedBytes_ad_score\r\n| project-rename ExpectedusedBytes=series_decompose_anomalies_usedBytes_baseline\r\n| project-rename anomalies=series_decompose_anomalies_usedBytes_ad_flag\r\n| project Timestamp, toint(usedBytes), toint(ExpectedusedBytes), toint(anomalies)\r\n| where anomalies >= 0\r\n| render anomalychart with(anomalycolumns=anomalies)",
                        "size": 0,
                        "aggregation": 3,
                        "title": "usedBytes Anomaly Detection",
                        "timeContextFromParameter": "Timeframe",
                        "queryType": 0,
                        "resourceType": "microsoft.kubernetes/connectedclusters",
                        "crossComponentResources": ["{Resource}"],
                        "visualization": "timechart",
                        "chartSettings": {
                          "xAxis": "Timestamp",
                          "ySettings": {
                            "numberFormatSettings": {
                              "unit": 2,
                              "options": {
                                "style": "decimal",
                                "useGrouping": true
                              }
                            }
                          }
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 1",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "###     Anomaly Detection for IOPS"
                      },
                      "name": "text - 4 - Copy - Copy"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_performance_iops\"\r\n| project TimeGenerated, Computer, Val\r\n| summarize iops=avg(Val), Actualiops=avg(Val) by bin(TimeGenerated, 1d), Computer\r\n| summarize Timestamp=make_list(TimeGenerated), iops=make_list(iops) by Computer\r\n| extend series_decompose_anomalies(iops)\r\n| mv-expand Timestamp, iops, series_decompose_anomalies_iops_ad_flag, series_decompose_anomalies_iops_ad_score, series_decompose_anomalies_iops_baseline\r\n| project-away series_decompose_anomalies_iops_ad_score\r\n| project-rename Expectediops=series_decompose_anomalies_iops_baseline\r\n| project-rename Anomalies=series_decompose_anomalies_iops_ad_flag\r\n| extend Gap = todecimal(iops)-todecimal(Expectediops)\r\n| where Gap != 0\r\n| extend Trend=iff(Gap>0, \"Up\", \"Down\")\r\n| extend ActualVsExpectedAsPercent = round(todecimal(iops)*100/todecimal(Expectediops), 2)\r\n| sort by todatetime(Timestamp) asc\r\n//| extend Avg_iops = round(todecimal(iops) / 1000000000,3), Expected_Avg_iops = round(todecimal(Expectediops) / 1000000000,3)\r\n| extend Avg_iops = round(todecimal(iops),3), Expected_Avg_iops = round(todecimal(Expectediops),3)\r\n| extend Alert = case(ActualVsExpectedAsPercent ==0, \"-\",\r\n                      ActualVsExpectedAsPercent>120, \"Alert\",\r\n                      ActualVsExpectedAsPercent<60, \"Alert\", \r\n                      \"OK\")\r\n| project Computer, Timestamp=format_datetime(todatetime(Timestamp), 'yyyy-MM-dd'), Trend, Avg_iops, Expected_Avg_iops, ActualVsExpectedAsPercent, Alert, Anomalies",
                        "size": 0,
                        "title": "Daily IOPS Trend analysis",
                        "timeContextFromParameter": "Timeframe",
                        "queryType": 0,
                        "resourceType": "microsoft.kubernetes/connectedclusters",
                        "crossComponentResources": ["{Resource}"],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Computer",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Trend",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Up",
                                    "representation": "trendup",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Down",
                                    "representation": "trenddown",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ActualVsExpectedAsPercent",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal"
                                }
                              }
                            },
                            {
                              "columnMatch": "Alert",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Alert",
                                    "representation": "4",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "unknown",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            }
                          ],
                          "hierarchySettings": {
                            "treeType": 1,
                            "groupBy": ["Computer"],
                            "expandTopLevel": true
                          }
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 0",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_performance_iops\"\r\n| summarize iops=avg(Val) by bin(TimeGenerated, 30m), Computer\r\n| order by TimeGenerated asc\r\n| summarize Timestamp=make_list(TimeGenerated), iops=make_list(iops) by Computer\r\n| extend series_decompose_anomalies(iops, 1.5, -1, 'linefit')\r\n| mv-expand Timestamp, iops, series_decompose_anomalies_iops_ad_flag, series_decompose_anomalies_iops_ad_score, series_decompose_anomalies_iops_baseline\r\n| project-away series_decompose_anomalies_iops_ad_score\r\n| project-rename Expectediops=series_decompose_anomalies_iops_baseline\r\n| project-rename anomalies=series_decompose_anomalies_iops_ad_flag\r\n| project Timestamp, toint(iops), toint(Expectediops), toint(anomalies)\r\n| render anomalychart with(anomalycolumns=anomalies)",
                        "size": 0,
                        "title": "IOPS Anomaly Detection",
                        "queryType": 0,
                        "resourceType": "microsoft.kubernetes/connectedclusters",
                        "crossComponentResources": ["{Resource}"],
                        "visualization": "timechart",
                        "chartSettings": {
                          "xAxis": "Timestamp",
                          "ySettings": {
                            "numberFormatSettings": {
                              "unit": 0,
                              "options": {
                                "style": "decimal",
                                "useGrouping": true
                              }
                            }
                          }
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 1",
                      "styleSettings": {
                        "showBorder": true
                      }
                    }
                  ]
                },
                "name": "ML",
                "styleSettings": {
                  "showBorder": true
                }
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "setTab",
            "comparison": "isEqualTo",
            "value": "StorageO"
          },
          "name": "Storage Usage"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "loadType": "always",
                  "items": [
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "let VSB = \r\nInsightsMetrics\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_space_bytes\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend dimension=tostring(json.dimension)\r\n| extend volume=tostring(json.volume)\r\n| summarize VSB=avg(Val) by volume;\r\nInsightsMetrics\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_space_size_bytes\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend dimension=tostring(json.dimension)\r\n| extend volume=tostring(json.volume)\r\n| summarize VSSB=avg(Val) by volume\r\n| join (VSB) on volume\r\n| extend Volume_Capacity_Usage =(VSB/VSSB)*100\r\n| order by Volume_Capacity_Usage desc\r\n| limit 10\r\n",
                        "size": 0,
                        "title": "Top 10 volume space usage",
                        "timeContextFromParameter": "Timeframe",
                        "queryType": 0,
                        "resourceType": "microsoft.kubernetes/connectedclusters",
                        "crossComponentResources": ["{Resource}"],
                        "visualization": "table",
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "VSSB",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 2,
                                "options": {
                                  "style": "decimal"
                                }
                              }
                            },
                            {
                              "columnMatch": "volume1",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "VSB",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 2,
                                "options": {
                                  "style": "decimal"
                                }
                              }
                            },
                            {
                              "columnMatch": "Volume_Capacity_Usage",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "greenRed"
                              }
                            },
                            {
                              "columnMatch": "VCU",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": ">=",
                                    "thresholdValue": "1",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "<=",
                                    "thresholdValue": "1",
                                    "representation": "green",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ],
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": []
                                }
                              },
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal"
                                }
                              }
                            }
                          ]
                        },
                        "sortBy": []
                      },
                      "customWidth": "30",
                      "name": "query - 3",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "InsightsMetrics\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_space_datareduction_ratio\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend dimension=tostring(json.dimension)\r\n| extend volume=tostring(json.volume)\r\n| summarize DRR=sum(Val) by volume",
                        "size": 3,
                        "title": "Datareduction Ratio",
                        "timeContextFromParameter": "Timeframe",
                        "queryType": 0,
                        "resourceType": "microsoft.kubernetes/connectedclusters",
                        "crossComponentResources": ["{Resource}"],
                        "visualization": "piechart",
                        "chartSettings": {
                          "yAxis": ["DRR"],
                          "createOtherGroup": null,
                          "ySettings": {
                            "numberFormatSettings": {
                              "unit": 2,
                              "options": {
                                "style": "decimal",
                                "useGrouping": true
                              }
                            }
                          }
                        }
                      },
                      "customWidth": "25",
                      "name": "query - 1",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "InsightsMetrics\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_space_bytes\"\r\n| parse-where kind = regex Tags with \"dimension\\\":\\\"\" dimension \"\\\",\" *\r\n| extend dimension=tostring(split(dimension,'\"')[0])\r\n| summarize avg(Val) by bin(TimeGenerated, 30m), dimension",
                        "size": 0,
                        "aggregation": 3,
                        "title": "Average Capacity Usage Distribution",
                        "timeContextFromParameter": "Timeframe",
                        "queryType": 0,
                        "resourceType": "microsoft.kubernetes/connectedclusters",
                        "crossComponentResources": ["{Resource}"],
                        "visualization": "timechart",
                        "chartSettings": {
                          "group": "dimension",
                          "createOtherGroup": null,
                          "ySettings": {
                            "numberFormatSettings": {
                              "unit": 2,
                              "options": {
                                "style": "decimal",
                                "useGrouping": true
                              }
                            }
                          }
                        }
                      },
                      "customWidth": "45",
                      "showPin": true,
                      "name": "query - 1",
                      "styleSettings": {
                        "showBorder": true
                      }
                    }
                  ]
                },
                "name": "top",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_space_size_bytes\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend instance=tostring(json.instance)\r\n| extend volume=tostring(json.volume)\r\n| extend dimension=tostring(json.dimension)\r\n| summarize VSB=avg(Val) by bin(TimeGenerated,30m), volume\r\n//| order by VSB desc",
                        "size": 3,
                        "aggregation": 3,
                        "title": "Volume SizeUsage over Time",
                        "timeContextFromParameter": "Timeframe",
                        "queryType": 0,
                        "resourceType": "microsoft.kubernetes/connectedclusters",
                        "crossComponentResources": ["{Resource}"],
                        "visualization": "timechart",
                        "chartSettings": {
                          "ySettings": {
                            "numberFormatSettings": {
                              "unit": 2,
                              "options": {
                                "style": "decimal",
                                "useGrouping": true
                              }
                            }
                          }
                        }
                      },
                      "customWidth": "33",
                      "name": "query - 0 - Copy",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_space_bytes\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend instance=tostring(json.instance)\r\n| extend volume=tostring(json.volume)\r\n| extend dimension=tostring(json.dimension)\r\n| summarize VSB=avg(Val) by bin (TimeGenerated,30m), volume\r\n//| order by VSB desc",
                        "size": 3,
                        "aggregation": 3,
                        "title": "Volume Space Usage over Time",
                        "timeContextFromParameter": "Timeframe",
                        "queryType": 0,
                        "resourceType": "microsoft.kubernetes/connectedclusters",
                        "crossComponentResources": ["{Resource}"],
                        "visualization": "timechart",
                        "chartSettings": {
                          "ySettings": {
                            "numberFormatSettings": {
                              "unit": 2,
                              "options": {
                                "style": "decimal",
                                "useGrouping": true
                              }
                            }
                          }
                        }
                      },
                      "customWidth": "33",
                      "name": "query - 0",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_datareduction_ratio\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend instance=tostring(json.instance)\r\n| extend volume=tostring(json.volume)\r\n| extend dimension=tostring(json.dimension)\r\n| summarize VSB=avg(Val) by bin(TimeGenerated,30m), volume\r\n//| order by VSB desc",
                        "size": 3,
                        "title": "Volume DatareductionRatio over Time",
                        "timeContextFromParameter": "Timeframe",
                        "queryType": 0,
                        "resourceType": "microsoft.kubernetes/connectedclusters",
                        "crossComponentResources": ["{Resource}"],
                        "visualization": "timechart"
                      },
                      "customWidth": "33",
                      "name": "query - 0 - Copy - Copy",
                      "styleSettings": {
                        "showBorder": true
                      }
                    }
                  ]
                },
                "name": "Vol Storage"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "InsightsMetrics\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_performance_throughput_bytes\"\r\n| parse-where kind = regex Tags with \"dimension\\\":\\\"\" dimension \"\\\",\" *\r\n| extend dimension=tostring(split(dimension,'\"')[0])\r\n| summarize sum(Val) by bin(TimeGenerated, 30m), dimension",
                        "size": 0,
                        "title": "Volume Throughput",
                        "timeContextFromParameter": "Timeframe",
                        "queryType": 0,
                        "resourceType": "microsoft.kubernetes/connectedclusters",
                        "crossComponentResources": ["{Resource}"],
                        "visualization": "categoricalbar",
                        "chartSettings": {
                          "group": "dimension",
                          "createOtherGroup": null,
                          "ySettings": {
                            "numberFormatSettings": {
                              "unit": 2,
                              "options": {
                                "style": "decimal",
                                "useGrouping": true
                              }
                            }
                          }
                        }
                      },
                      "showPin": true,
                      "name": "query - 1 - Copy",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "InsightsMetrics\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_performance_latency_usec\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend dimension=tostring(json.dimension)\r\n| extend volume=tostring(json.volume)\r\n| summarize latency=sum(Val)/1000 by bin(TimeGenerated, 30m), dimension",
                        "size": 0,
                        "title": "Volume Latency",
                        "timeContextFromParameter": "Timeframe",
                        "queryType": 0,
                        "resourceType": "microsoft.kubernetes/connectedclusters",
                        "crossComponentResources": ["{Resource}"],
                        "visualization": "categoricalbar",
                        "chartSettings": {
                          "xAxis": "TimeGenerated",
                          "yAxis": ["latency"],
                          "group": "dimension",
                          "createOtherGroup": null
                        }
                      },
                      "showPin": true,
                      "name": "query - 3",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "InsightsMetrics\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_performance_iops\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend dimension=tostring(json.dimension)\r\n| extend volume=tostring(json.volume)\r\n| summarize iops=sum(Val) by bin(TimeGenerated, 30m), dimension",
                        "size": 0,
                        "title": "Volume IOPS",
                        "timeContextFromParameter": "Timeframe",
                        "queryType": 0,
                        "resourceType": "microsoft.kubernetes/connectedclusters",
                        "crossComponentResources": ["{Resource}"],
                        "visualization": "categoricalbar",
                        "chartSettings": {
                          "xAxis": "TimeGenerated",
                          "yAxis": ["iops"],
                          "group": "dimension",
                          "createOtherGroup": null
                        }
                      },
                      "showPin": true,
                      "name": "query - 4",
                      "styleSettings": {
                        "showBorder": true
                      }
                    }
                  ]
                },
                "customWidth": "50",
                "name": "group - 5"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_performance_throughput_bytes\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend dimension=tostring(json.dimension)\r\n| extend volume=tostring(json.volume)\r\n| summarize sum(Val) by bin(TimeGenerated, 30m), volume",
                        "size": 0,
                        "title": "Top talker volumes by throughput",
                        "timeContextFromParameter": "Timeframe",
                        "queryType": 0,
                        "resourceType": "microsoft.kubernetes/connectedclusters",
                        "crossComponentResources": ["{Resource}"],
                        "visualization": "timechart"
                      },
                      "name": "query - 0",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_performance_latency_usec\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend dimension=tostring(json.dimension)\r\n| extend volume=tostring(json.volume)\r\n| summarize avg(Val) /1000 by bin(TimeGenerated, 30m), volume",
                        "size": 0,
                        "title": "Top talker volumes by Latency",
                        "timeContextFromParameter": "Timeframe",
                        "queryType": 0,
                        "resourceType": "microsoft.kubernetes/connectedclusters",
                        "crossComponentResources": ["{Resource}"],
                        "visualization": "timechart"
                      },
                      "name": "query - 0 - Copy - Copy",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_performance_iops\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend dimension=tostring(json.dimension)\r\n| extend volume=tostring(json.volume)\r\n| summarize sum(Val) by bin(TimeGenerated, 30m), volume",
                        "size": 0,
                        "title": "Top talker volumes by IOPS",
                        "timeContextFromParameter": "Timeframe",
                        "queryType": 0,
                        "resourceType": "microsoft.kubernetes/connectedclusters",
                        "crossComponentResources": ["{Resource}"],
                        "visualization": "timechart"
                      },
                      "name": "query - 0 - Copy",
                      "styleSettings": {
                        "showBorder": true
                      }
                    }
                  ]
                },
                "customWidth": "50",
                "name": "last - Copy"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "setTab",
            "comparison": "isEqualTo",
            "value": "Volume"
          },
          "name": "group - 4"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "title": "Pure Storage FlashArray Landscape",
            "items": [
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Namespace == \"prometheus\" and Name has \"purefa_info\"\r\n| where Computer in ({Computer})\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend array_name=tostring(json.array_name)\r\n| summarize by tostring(array_name)",
                              "size": 3,
                              "title": "Array Name",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "card",
                              "textSettings": {
                                "style": "bignumber"
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 0",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Namespace == \"prometheus\" and Name has \"purefa_info\"\r\n| where Computer in ({Computer})\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend version=tostring(json.version)\r\n| summarize by tostring(version)",
                              "size": 3,
                              "title": "Firmware Version",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "card",
                              "textSettings": {
                                "style": "bignumber"
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 1",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Namespace == \"prometheus\" and Name has \"purefa_hardware_temperature_celsius\"\r\n| where Computer in ({Computer})\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend controller=tostring(json.controller)\r\n| extend controller=iff(string_size(controller)>=1,strcat(\"Controller \",controller), \"\")\r\n| where string_size(controller)>=1\r\n| summarize temp=avg(Val)\r\n",
                              "size": 3,
                              "title": "Hardware Temp in C",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {},
                                "leftContent": {
                                  "columnMatch": "temp",
                                  "formatter": 18,
                                  "formatOptions": {
                                    "thresholdsOptions": "colors",
                                    "thresholdsGrid": [
                                      {
                                        "operator": ">=",
                                        "thresholdValue": "50",
                                        "representation": "redBright",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": ">=",
                                        "thresholdValue": "40",
                                        "representation": "yellow",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": "Default",
                                        "thresholdValue": null,
                                        "representation": "green",
                                        "text": "{0}{1}"
                                      }
                                    ]
                                  },
                                  "numberFormat": {
                                    "unit": 0,
                                    "options": {
                                      "style": "decimal",
                                      "maximumFractionDigits": 2
                                    }
                                  }
                                },
                                "showBorder": false
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 2",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Namespace == \"prometheus\" and Name has \"purefa_hardware_power_volts\"\r\n| where Computer in ({Computer})\r\n| summarize volt=avg(Val)",
                              "size": 3,
                              "title": "Power Voltage",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {},
                                "leftContent": {
                                  "columnMatch": "volt",
                                  "formatter": 18,
                                  "formatOptions": {
                                    "thresholdsOptions": "colors",
                                    "thresholdsGrid": [
                                      {
                                        "operator": ">=",
                                        "thresholdValue": "235",
                                        "representation": "redBright",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": ">=",
                                        "thresholdValue": "215",
                                        "representation": "yellow",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": "Default",
                                        "thresholdValue": null,
                                        "representation": "green",
                                        "text": "{0}{1}"
                                      }
                                    ]
                                  },
                                  "numberFormat": {
                                    "unit": 0,
                                    "options": {
                                      "style": "decimal",
                                      "maximumFractionDigits": 2
                                    }
                                  }
                                },
                                "showBorder": false
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 2 - Copy",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"\r\n| summarize capacityBytes=avgif(Val, Name has \"purefa_array_space_capacity_bytes\")",
                              "size": 3,
                              "title": "Total Capacity",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {},
                                "leftContent": {
                                  "columnMatch": "capacityBytes",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "blue"
                                  },
                                  "numberFormat": {
                                    "unit": 2,
                                    "options": {
                                      "style": "decimal"
                                    }
                                  }
                                },
                                "showBorder": false
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 0",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"\r\n| summarize usedBytes=avgif(Val, Name has \"purefa_array_space_used_bytes\"), capacityBytes=avgif(Val, Name has \"purefa_array_space_capacity_bytes\")\r\n| extend FreeSpace=capacityBytes-usedBytes",
                              "size": 3,
                              "title": "Free Space",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {},
                                "leftContent": {
                                  "columnMatch": "FreeSpace",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "blue"
                                  },
                                  "numberFormat": {
                                    "unit": 2,
                                    "options": {
                                      "style": "decimal"
                                    }
                                  }
                                },
                                "showBorder": false,
                                "size": "auto"
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 0 - Copy",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics \r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"\r\n| summarize capacity=sumif(Val, Name has \"purefa_array_space_capacity_bytes\"), used=sumif(Val, Name has \"purefa_array_space_used_bytes\")\r\n| extend capacity_usage = (used/capacity)*100",
                              "size": 3,
                              "title": "Capacity Usage",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "tiles",
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "capacity_usage",
                                    "formatter": 0,
                                    "numberFormat": {
                                      "unit": 1,
                                      "options": {
                                        "style": "decimal"
                                      }
                                    }
                                  }
                                ]
                              },
                              "tileSettings": {
                                "titleContent": {},
                                "leftContent": {
                                  "columnMatch": "capacity_usage",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "blue"
                                  },
                                  "numberFormat": {
                                    "unit": 1,
                                    "options": {
                                      "style": "decimal"
                                    }
                                  }
                                },
                                "showBorder": false,
                                "size": "auto"
                              }
                            },
                            "customWidth": "33",
                            "name": "query - 2",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Namespace == \"prometheus\"and Name has \"purefa_array_space_used_bytes\"\r\n| summarize UsedBytes=avg(Val)\r\n",
                              "size": 3,
                              "title": "Usage on Arrays",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {},
                                "leftContent": {
                                  "columnMatch": "UsedBytes",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "blue"
                                  },
                                  "numberFormat": {
                                    "unit": 2,
                                    "options": {
                                      "style": "decimal"
                                    }
                                  }
                                },
                                "showBorder": false
                              }
                            },
                            "customWidth": "33",
                            "name": "query - 0",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics \r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name has \"purefa_array_space_datareduction_ratio\"\r\n| summarize datareduction_ratio=avg(Val)",
                              "size": 3,
                              "title": "Datareduction ratio",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {},
                                "leftContent": {
                                  "columnMatch": "datareduction_ratio",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "blue"
                                  },
                                  "numberFormat": {
                                    "unit": 0,
                                    "options": {
                                      "style": "decimal",
                                      "useGrouping": true,
                                      "minimumIntegerDigits": 1,
                                      "minimumFractionDigits": 2,
                                      "maximumFractionDigits": 2
                                    }
                                  }
                                },
                                "showBorder": false,
                                "size": "auto"
                              }
                            },
                            "customWidth": "33",
                            "name": "query - 3",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics \r\n| where Namespace == \"prometheus\"and Name contains \"pure\"\r\n| summarize by Name\r\n| extend Category=case( Name contains \"hardware\", \"Hardware\", \r\n                        Name contains \"Volume\", \"Volume\", \r\n                        Name contains \"performance\", \"Performance\",\r\n                        Name contains \"space\", \"Space\",\r\n                        \"Others\")\r\n| project Category, Name",
                              "size": 3,
                              "title": "Metrics collected from Pure Storage",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "table",
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "Category",
                                    "formatter": 5
                                  }
                                ],
                                "hierarchySettings": {
                                  "treeType": 1,
                                  "groupBy": ["Category"],
                                  "expandTopLevel": true
                                },
                                "sortBy": [
                                  {
                                    "itemKey": "Name",
                                    "sortOrder": 1
                                  }
                                ]
                              },
                              "sortBy": [
                                {
                                  "itemKey": "Name",
                                  "sortOrder": 1
                                }
                              ]
                            },
                            "name": "query - 1",
                            "styleSettings": {
                              "showBorder": true
                            }
                          }
                        ]
                      },
                      "customWidth": "25",
                      "name": "top left",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 12,
                            "content": {
                              "version": "NotebookGroup/1.0",
                              "groupType": "editable",
                              "items": [
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_component_health\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend component=tostring(json.component)\r\n| where component == \"BAY\"\r\n| summarize Disk=count(Val)-sum(Val)",
                                    "size": 3,
                                    "title": "Disk BAYS",
                                    "timeContextFromParameter": "Timeframe",
                                    "queryType": 0,
                                    "resourceType": "microsoft.kubernetes/connectedclusters",
                                    "crossComponentResources": ["{Resource}"],
                                    "visualization": "tiles",
                                    "tileSettings": {
                                      "titleContent": {},
                                      "leftContent": {
                                        "columnMatch": "Disk",
                                        "formatter": 18,
                                        "formatOptions": {
                                          "thresholdsOptions": "icons",
                                          "thresholdsGrid": [
                                            {
                                              "operator": "==",
                                              "thresholdValue": "1",
                                              "representation": "4",
                                              "text": "FAIL"
                                            },
                                            {
                                              "operator": "Default",
                                              "thresholdValue": null,
                                              "representation": "success",
                                              "text": "OK"
                                            }
                                          ]
                                        }
                                      },
                                      "showBorder": false,
                                      "size": "auto"
                                    },
                                    "textSettings": {
                                      "style": "bignumber"
                                    }
                                  },
                                  "customWidth": "25",
                                  "name": "query - 0",
                                  "styleSettings": {
                                    "showBorder": true
                                  }
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_component_health\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend component=tostring(json.component)\r\n| where component == \"NVB\"\r\n| summarize Disk=count(Val)-sum(Val)",
                                    "size": 3,
                                    "title": "NVRAM",
                                    "timeContextFromParameter": "Timeframe",
                                    "queryType": 0,
                                    "resourceType": "microsoft.kubernetes/connectedclusters",
                                    "crossComponentResources": ["{Resource}"],
                                    "visualization": "tiles",
                                    "tileSettings": {
                                      "titleContent": {},
                                      "leftContent": {
                                        "columnMatch": "Disk",
                                        "formatter": 18,
                                        "formatOptions": {
                                          "thresholdsOptions": "icons",
                                          "thresholdsGrid": [
                                            {
                                              "operator": "==",
                                              "thresholdValue": "1",
                                              "representation": "4",
                                              "text": "FAIL"
                                            },
                                            {
                                              "operator": "Default",
                                              "thresholdValue": null,
                                              "representation": "success",
                                              "text": "OK"
                                            }
                                          ]
                                        }
                                      },
                                      "showBorder": false,
                                      "size": "auto"
                                    },
                                    "textSettings": {
                                      "style": "bignumber"
                                    }
                                  },
                                  "customWidth": "25",
                                  "name": "query - 0 - Copy",
                                  "styleSettings": {
                                    "showBorder": true
                                  }
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_component_health\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend component=tostring(json.component)\r\n| where component == \"PWR\"\r\n| summarize Disk=count(Val)-sum(Val)",
                                    "size": 3,
                                    "title": "Power Supply",
                                    "queryType": 0,
                                    "resourceType": "microsoft.kubernetes/connectedclusters",
                                    "crossComponentResources": ["{Resource}"],
                                    "visualization": "tiles",
                                    "tileSettings": {
                                      "titleContent": {},
                                      "leftContent": {
                                        "columnMatch": "Disk",
                                        "formatter": 18,
                                        "formatOptions": {
                                          "thresholdsOptions": "icons",
                                          "thresholdsGrid": [
                                            {
                                              "operator": "==",
                                              "thresholdValue": "1",
                                              "representation": "4",
                                              "text": "FAIL"
                                            },
                                            {
                                              "operator": "Default",
                                              "thresholdValue": null,
                                              "representation": "success",
                                              "text": "OK"
                                            }
                                          ]
                                        }
                                      },
                                      "showBorder": false,
                                      "size": "auto"
                                    },
                                    "textSettings": {
                                      "style": "bignumber"
                                    }
                                  },
                                  "customWidth": "25",
                                  "name": "query - 0 - Copy - Copy",
                                  "styleSettings": {
                                    "showBorder": true
                                  }
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_chassis_health\"\r\n| summarize CH=avg(Val)",
                                    "size": 3,
                                    "title": "Chassis Health",
                                    "timeContextFromParameter": "Timeframe",
                                    "queryType": 0,
                                    "resourceType": "microsoft.kubernetes/connectedclusters",
                                    "crossComponentResources": ["{Resource}"],
                                    "visualization": "tiles",
                                    "tileSettings": {
                                      "titleContent": {},
                                      "leftContent": {
                                        "columnMatch": "CH",
                                        "formatter": 18,
                                        "formatOptions": {
                                          "thresholdsOptions": "icons",
                                          "thresholdsGrid": [
                                            {
                                              "operator": "==",
                                              "thresholdValue": "1",
                                              "representation": "Available",
                                              "text": "OK"
                                            },
                                            {
                                              "operator": "<",
                                              "thresholdValue": "1",
                                              "representation": "4",
                                              "text": "{0}{1}"
                                            },
                                            {
                                              "operator": "Default",
                                              "thresholdValue": null,
                                              "representation": "success",
                                              "text": "{0}{1}"
                                            }
                                          ]
                                        },
                                        "tooltipFormat": {
                                          "tooltip": "OK"
                                        }
                                      },
                                      "showBorder": false
                                    }
                                  },
                                  "customWidth": "25",
                                  "name": "query - 1",
                                  "styleSettings": {
                                    "showBorder": true
                                  }
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_controller_health\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend controller=tostring(json.controller)\r\n| summarize c1=avg(Val) by controller\r\n| extend status=iff(toint(c1) == 1, \"OK\", \"FAIL\"), controller=strcat(\"Controller \",controller)\r\n",
                                    "size": 3,
                                    "title": "Controller Health",
                                    "timeContextFromParameter": "Timeframe",
                                    "queryType": 0,
                                    "resourceType": "microsoft.kubernetes/connectedclusters",
                                    "crossComponentResources": ["{Resource}"],
                                    "visualization": "tiles",
                                    "tileSettings": {
                                      "titleContent": {
                                        "columnMatch": "controller",
                                        "formatter": 12,
                                        "formatOptions": {
                                          "palette": "blue"
                                        }
                                      },
                                      "leftContent": {
                                        "columnMatch": "status",
                                        "formatter": 18,
                                        "formatOptions": {
                                          "thresholdsOptions": "icons",
                                          "thresholdsGrid": [
                                            {
                                              "operator": "==",
                                              "thresholdValue": "OK",
                                              "representation": "Available",
                                              "text": "{0}{1}"
                                            },
                                            {
                                              "operator": "!=",
                                              "thresholdValue": "OK",
                                              "representation": "4",
                                              "text": "{0}{1}"
                                            },
                                            {
                                              "operator": "Default",
                                              "thresholdValue": null,
                                              "representation": "success",
                                              "text": "{0}{1}"
                                            }
                                          ]
                                        },
                                        "numberFormat": {
                                          "unit": 17,
                                          "options": {
                                            "style": "decimal",
                                            "maximumFractionDigits": 2,
                                            "maximumSignificantDigits": 3
                                          }
                                        }
                                      },
                                      "showBorder": false
                                    }
                                  },
                                  "customWidth": "20",
                                  "name": "query - 0",
                                  "styleSettings": {
                                    "showBorder": true
                                  }
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_temperature_celsius\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend controller=tostring(json.controller)\r\n| summarize c1=avg(Val) by controller\r\n| extend controller=iff(string_size(controller)>=1,strcat(\"Controller \",controller), \"\")\r\n| where string_size(controller)>=1",
                                    "size": 3,
                                    "title": "Controller Temperature",
                                    "timeContextFromParameter": "Timeframe",
                                    "queryType": 0,
                                    "resourceType": "microsoft.kubernetes/connectedclusters",
                                    "crossComponentResources": ["{Resource}"],
                                    "visualization": "tiles",
                                    "tileSettings": {
                                      "titleContent": {
                                        "columnMatch": "controller",
                                        "formatter": 12,
                                        "formatOptions": {
                                          "palette": "blue"
                                        }
                                      },
                                      "leftContent": {
                                        "columnMatch": "c1",
                                        "formatter": 12,
                                        "formatOptions": {
                                          "palette": "auto"
                                        },
                                        "numberFormat": {
                                          "unit": 0,
                                          "options": {
                                            "style": "decimal",
                                            "maximumFractionDigits": 2,
                                            "maximumSignificantDigits": 3
                                          }
                                        }
                                      },
                                      "showBorder": false,
                                      "size": "auto"
                                    }
                                  },
                                  "customWidth": "20",
                                  "name": "query - 0 - Copy",
                                  "styleSettings": {
                                    "showBorder": true
                                  }
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_component_health\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend component=tostring(json.component)\r\n| extend controller=tostring(json.controller)\r\n| where component == \"ETH\"\r\n| summarize Disk=count(Val)-sum(Val) by controller\r\n| extend controller=iff(string_size(controller)>=1,strcat(\"Controller \",controller), \"\")\r\n| where string_size(controller)>=1\r\n| extend Disk=iff(Disk == 0, \"OK\", \"ERROR\")",
                                    "size": 3,
                                    "title": "Ethernet Ports",
                                    "timeContextFromParameter": "Timeframe",
                                    "queryType": 0,
                                    "resourceType": "microsoft.kubernetes/connectedclusters",
                                    "crossComponentResources": ["{Resource}"],
                                    "visualization": "tiles",
                                    "tileSettings": {
                                      "titleContent": {},
                                      "subtitleContent": {
                                        "columnMatch": "controller",
                                        "formatter": 12,
                                        "formatOptions": {
                                          "palette": "none"
                                        }
                                      },
                                      "leftContent": {
                                        "columnMatch": "Disk",
                                        "formatter": 18,
                                        "formatOptions": {
                                          "thresholdsOptions": "icons",
                                          "thresholdsGrid": [
                                            {
                                              "operator": "==",
                                              "thresholdValue": "1",
                                              "representation": "4",
                                              "text": "{0}{1}"
                                            },
                                            {
                                              "operator": "Default",
                                              "thresholdValue": null,
                                              "representation": "success",
                                              "text": "{0}{1}"
                                            }
                                          ]
                                        }
                                      },
                                      "showBorder": false,
                                      "size": "auto"
                                    },
                                    "textSettings": {
                                      "style": "bignumber"
                                    }
                                  },
                                  "customWidth": "20",
                                  "name": "query - 0",
                                  "styleSettings": {
                                    "showBorder": true
                                  }
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_component_health\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend component=tostring(json.component)\r\n| extend controller=tostring(json.controller)\r\n| where component == \"FAN\"\r\n| summarize Disk=count(Val)-sum(Val) by controller\r\n| extend controller=iff(string_size(controller)>=1,strcat(\"Controller \",controller), \"\")\r\n| where string_size(controller)>=1\r\n| extend Disk=iff(Disk == 0, \"OK\", \"ERROR\")",
                                    "size": 3,
                                    "title": "Fans",
                                    "timeContextFromParameter": "Timeframe",
                                    "queryType": 0,
                                    "resourceType": "microsoft.kubernetes/connectedclusters",
                                    "crossComponentResources": ["{Resource}"],
                                    "visualization": "tiles",
                                    "tileSettings": {
                                      "titleContent": {},
                                      "subtitleContent": {
                                        "columnMatch": "controller",
                                        "formatter": 12,
                                        "formatOptions": {
                                          "palette": "none"
                                        }
                                      },
                                      "leftContent": {
                                        "columnMatch": "Disk",
                                        "formatter": 18,
                                        "formatOptions": {
                                          "thresholdsOptions": "icons",
                                          "thresholdsGrid": [
                                            {
                                              "operator": "==",
                                              "thresholdValue": "1",
                                              "representation": "4",
                                              "text": "{0}{1}"
                                            },
                                            {
                                              "operator": "Default",
                                              "thresholdValue": null,
                                              "representation": "success",
                                              "text": "{0}{1}"
                                            }
                                          ]
                                        }
                                      },
                                      "showBorder": false,
                                      "size": "auto"
                                    },
                                    "textSettings": {
                                      "style": "bignumber"
                                    }
                                  },
                                  "customWidth": "20",
                                  "name": "query - 0 - Copy - Copy",
                                  "styleSettings": {
                                    "showBorder": true
                                  }
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_component_health\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend component=tostring(json.component)\r\n| extend controller=tostring(json.controller)\r\n| where component == \"TMP\"\r\n| summarize Disk=count(Val)-sum(Val) by controller\r\n| extend controller=iff(string_size(controller)>=1,strcat(\"Controller \",controller), \"\")\r\n| where string_size(controller)>=1\r\n| extend Disk=iff(toint(Disk) == 0, \"OK\", \"CRITICAL\")",
                                    "size": 3,
                                    "title": "Temperature sensors",
                                    "timeContextFromParameter": "Timeframe",
                                    "queryType": 0,
                                    "resourceType": "microsoft.kubernetes/connectedclusters",
                                    "crossComponentResources": ["{Resource}"],
                                    "visualization": "tiles",
                                    "tileSettings": {
                                      "titleContent": {},
                                      "subtitleContent": {
                                        "columnMatch": "controller",
                                        "formatter": 12,
                                        "formatOptions": {
                                          "palette": "none"
                                        }
                                      },
                                      "leftContent": {
                                        "columnMatch": "Disk",
                                        "formatter": 18,
                                        "formatOptions": {
                                          "thresholdsOptions": "icons",
                                          "thresholdsGrid": [
                                            {
                                              "operator": "==",
                                              "thresholdValue": "1",
                                              "representation": "4",
                                              "text": "{0}{1}"
                                            },
                                            {
                                              "operator": "Default",
                                              "thresholdValue": null,
                                              "representation": "success",
                                              "text": "{0}{1}"
                                            }
                                          ]
                                        }
                                      },
                                      "showBorder": false,
                                      "size": "auto"
                                    },
                                    "textSettings": {
                                      "style": "bignumber"
                                    }
                                  },
                                  "customWidth": "20",
                                  "name": "query - 0 - Copy - Copy - Copy",
                                  "styleSettings": {
                                    "showBorder": true
                                  }
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_component_health\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend component=tostring(json.component)\r\n| where component == \"BAY\"\r\n| summarize Disk=avg(Val) by bin(TimeGenerated, 30m)\r\n| where Disk != 1",
                                    "size": 3,
                                    "title": "Failed SSD's",
                                    "noDataMessage": "No Failed SSD's",
                                    "timeContextFromParameter": "Timeframe",
                                    "queryType": 0,
                                    "resourceType": "microsoft.kubernetes/connectedclusters",
                                    "crossComponentResources": ["{Resource}"],
                                    "visualization": "timechart"
                                  },
                                  "name": "query - 5",
                                  "styleSettings": {
                                    "showBorder": true
                                  }
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_component_health\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend component=tostring(json.component)\r\n| where component == \"NVB\"\r\n| summarize Disk=avg(Val) by bin(TimeGenerated, 30m)\r\n| where Disk != 1",
                                    "size": 3,
                                    "title": "Failed NVRAM Modules",
                                    "noDataMessage": "No Failed NVRAM Modules",
                                    "timeContextFromParameter": "Timeframe",
                                    "queryType": 0,
                                    "resourceType": "microsoft.kubernetes/connectedclusters",
                                    "crossComponentResources": ["{Resource}"],
                                    "visualization": "timechart",
                                    "tileSettings": {
                                      "titleContent": {},
                                      "leftContent": {
                                        "columnMatch": "Disk",
                                        "formatter": 18,
                                        "formatOptions": {
                                          "thresholdsOptions": "icons",
                                          "thresholdsGrid": [
                                            {
                                              "operator": "==",
                                              "thresholdValue": "1",
                                              "representation": "4",
                                              "text": "{0}{1}"
                                            },
                                            {
                                              "operator": "Default",
                                              "thresholdValue": null,
                                              "representation": "success",
                                              "text": "{0}{1}"
                                            }
                                          ]
                                        }
                                      },
                                      "showBorder": false,
                                      "size": "auto"
                                    },
                                    "textSettings": {
                                      "style": "bignumber"
                                    }
                                  },
                                  "name": "query - 0 - Copy - Copy",
                                  "styleSettings": {
                                    "showBorder": true
                                  }
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_component_health\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend component=tostring(json.component)\r\n| where component == \"PWR\"\r\n| summarize Disk=avg(Val) by bin(TimeGenerated, 30m)\r\n| where Disk != 1",
                                    "size": 3,
                                    "title": "Failed Power Supply",
                                    "noDataMessage": "No Failed Power Supply",
                                    "timeContextFromParameter": "Timeframe",
                                    "queryType": 0,
                                    "resourceType": "microsoft.kubernetes/connectedclusters",
                                    "crossComponentResources": ["{Resource}"],
                                    "visualization": "timechart",
                                    "tileSettings": {
                                      "titleContent": {},
                                      "leftContent": {
                                        "columnMatch": "Disk",
                                        "formatter": 18,
                                        "formatOptions": {
                                          "thresholdsOptions": "icons",
                                          "thresholdsGrid": [
                                            {
                                              "operator": "==",
                                              "thresholdValue": "1",
                                              "representation": "4",
                                              "text": "{0}{1}"
                                            },
                                            {
                                              "operator": "Default",
                                              "thresholdValue": null,
                                              "representation": "success",
                                              "text": "{0}{1}"
                                            }
                                          ]
                                        }
                                      },
                                      "showBorder": false,
                                      "size": "auto"
                                    },
                                    "textSettings": {
                                      "style": "bignumber"
                                    }
                                  },
                                  "name": "query - 0 - Copy - Copy - Copy",
                                  "styleSettings": {
                                    "showBorder": true
                                  }
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_component_health\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend component=tostring(json.component)\r\n| extend controller=tostring(json.controller)\r\n| where component == \"ETH\"\r\n| summarize Disk=count(Val)-sum(Val) by bin(TimeGenerated, 30m), controller\r\n| where Disk != 0",
                                    "size": 3,
                                    "title": "Failed Ethernet Ports",
                                    "noDataMessage": "No Failed Ethernet Ports",
                                    "timeContextFromParameter": "Timeframe",
                                    "queryType": 0,
                                    "resourceType": "microsoft.kubernetes/connectedclusters",
                                    "crossComponentResources": ["{Resource}"],
                                    "visualization": "timechart"
                                  },
                                  "customWidth": "50",
                                  "name": "query - 0",
                                  "styleSettings": {
                                    "showBorder": true
                                  }
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_component_health\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend component=tostring(json.component)\r\n| extend controller=tostring(json.controller)\r\n| where component == \"FAN\"\r\n| summarize Disk=count(Val)-sum(Val) by bin(TimeGenerated, 30m), controller\r\n| where Disk != 0",
                                    "size": 3,
                                    "title": "Failed fans",
                                    "noDataMessage": "No Failed Fans",
                                    "timeContextFromParameter": "Timeframe",
                                    "queryType": 0,
                                    "resourceType": "microsoft.kubernetes/connectedclusters",
                                    "crossComponentResources": ["{Resource}"],
                                    "visualization": "timechart"
                                  },
                                  "customWidth": "50",
                                  "name": "query - 0 - Copy",
                                  "styleSettings": {
                                    "showBorder": true
                                  }
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_component_health\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend component=tostring(json.component)\r\n| extend controller=tostring(json.controller)\r\n| where component == \"FC\"\r\n| summarize Disk=count(Val)-sum(Val) by bin(TimeGenerated, 30m), controller\r\n| where Disk != 0",
                                    "size": 3,
                                    "title": "Failed fiber channel ports",
                                    "noDataMessage": "No Failed fiber channel ports",
                                    "timeContextFromParameter": "Timeframe",
                                    "queryType": 0,
                                    "resourceType": "microsoft.kubernetes/connectedclusters",
                                    "crossComponentResources": ["{Resource}"],
                                    "visualization": "timechart"
                                  },
                                  "customWidth": "50",
                                  "name": "query - 0 - Copy",
                                  "styleSettings": {
                                    "showBorder": true
                                  }
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_component_health\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend component=tostring(json.component)\r\n| extend controller=tostring(json.controller)\r\n| where component == \"TMP\"\r\n| summarize Disk=count(Val)-sum(Val) by bin(TimeGenerated, 30m), controller\r\n| where Disk != 0",
                                    "size": 3,
                                    "title": "Failed temperature sensors",
                                    "noDataMessage": "No Failed temperature sensors",
                                    "timeContextFromParameter": "Timeframe",
                                    "queryType": 0,
                                    "resourceType": "microsoft.kubernetes/connectedclusters",
                                    "crossComponentResources": ["{Resource}"],
                                    "visualization": "timechart"
                                  },
                                  "customWidth": "50",
                                  "name": "query - 0 - Copy - Copy",
                                  "styleSettings": {
                                    "showBorder": true
                                  }
                                }
                              ]
                            },
                            "name": "Health Check"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics \r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"alerts\"\r\n| parse-where kind = regex Tags with \"severity\\\":\\\"\"severity\"\\\"}\"\r\n| summarize count() by severity",
                              "size": 3,
                              "title": "Alert classification",
                              "color": "redBright",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {
                                  "columnMatch": "severity",
                                  "formatter": 1
                                },
                                "leftContent": {
                                  "columnMatch": "count_",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "hotCold"
                                  },
                                  "numberFormat": {
                                    "unit": 17,
                                    "options": {
                                      "style": "decimal",
                                      "maximumFractionDigits": 2,
                                      "maximumSignificantDigits": 3
                                    }
                                  }
                                },
                                "showBorder": true
                              }
                            },
                            "name": "query - 0",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_array_performance_latency_usec\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend dimension=tostring(json.dimension)\r\n| where dimension == \"mirrored_write\"\r\n| summarize SB=sum(Val) by bin(TimeGenerated, 30m), dimension",
                              "size": 0,
                              "title": "Mirrored Write",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "linechart",
                              "chartSettings": {
                                "seriesLabelSettings": [
                                  {
                                    "seriesName": "critical",
                                    "color": "redBright"
                                  },
                                  {
                                    "seriesName": "warning",
                                    "color": "orange"
                                  },
                                  {
                                    "seriesName": "info",
                                    "color": "green"
                                  }
                                ]
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 0 - Copy",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_alerts_total\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend instance=tostring(json.instance)\r\n| extend volume=tostring(json.volume)\r\n| extend dimension=tostring(json.dimension)\r\n| extend severity=tostring(json.severity)\r\n| summarize SB=count(severity) by bin(TimeGenerated, 30m), severity",
                              "size": 0,
                              "title": "System Events",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.kubernetes/connectedclusters",
                              "crossComponentResources": ["{Resource}"],
                              "visualization": "linechart",
                              "chartSettings": {
                                "seriesLabelSettings": [
                                  {
                                    "seriesName": "critical",
                                    "color": "redBright"
                                  },
                                  {
                                    "seriesName": "warning",
                                    "color": "orange"
                                  },
                                  {
                                    "seriesName": "info",
                                    "color": "green"
                                  }
                                ]
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 0",
                            "styleSettings": {
                              "showBorder": true
                            }
                          }
                        ]
                      },
                      "customWidth": "75",
                      "name": "top mid"
                    }
                  ]
                },
                "name": "Main",
                "styleSettings": {
                  "showBorder": true
                }
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "setTab",
            "comparison": "isEqualTo",
            "value": "Landscape"
          },
          "name": "Landscape",
          "styleSettings": {
            "showBorder": true
          }
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_info\"\r\n| where Computer in ({Computer})\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend array_name=tostring(json.array_name)\r\n| summarize by tostring(array_name)",
                              "size": 3,
                              "title": "Array Name",
                              "queryType": 0,
                              "resourceType": "microsoft.resources/resourcegroups",
                              "visualization": "card",
                              "textSettings": {
                                "style": "bignumber"
                              }
                            },
                            "name": "query - 0",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_info\"\r\n| where Computer in ({Computer})\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend version=tostring(json.version)\r\n| summarize by tostring(version)",
                              "size": 3,
                              "title": "Firmware Version",
                              "queryType": 0,
                              "resourceType": "microsoft.resources/resourcegroups",
                              "visualization": "card",
                              "textSettings": {
                                "style": "bignumber"
                              }
                            },
                            "name": "query - 1",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "let component = InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_component_health\"\r\n| summarize comp=count(Val)-sum(Val);\r\nlet chassis = InsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_chassis_health\"\r\n| summarize chassis=count(Val)-sum(Val);\r\nInsightsMetrics\r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\" and Name contains \"purefa_hardware_controller_health\"\r\n| summarize controller=count(Val)-sum(Val)\r\n| extend overall=controller + toscalar(chassis)+toscalar(component)",
                              "size": 3,
                              "title": "Hardware Health",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.resources/resourcegroups",
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {},
                                "leftContent": {
                                  "columnMatch": "overall",
                                  "formatter": 18,
                                  "formatOptions": {
                                    "thresholdsOptions": "colors",
                                    "thresholdsGrid": [
                                      {
                                        "operator": "==",
                                        "thresholdValue": "1",
                                        "representation": "redBright",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": "Default",
                                        "thresholdValue": null,
                                        "representation": "green",
                                        "text": "{0}{1}"
                                      }
                                    ]
                                  }
                                },
                                "showBorder": false
                              }
                            },
                            "name": "query - 3"
                          },
                          {
                            "type": 12,
                            "content": {
                              "version": "NotebookGroup/1.0",
                              "groupType": "editable",
                              "items": [
                                {
                                  "type": 12,
                                  "content": {
                                    "version": "NotebookGroup/1.0",
                                    "groupType": "editable",
                                    "items": [
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "InsightsMetrics \r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_array_performance_iops\"\r\n| summarize avg_iops=avg(Val)",
                                          "size": 3,
                                          "title": "Average IOPS",
                                          "timeContextFromParameter": "Timeframe",
                                          "queryType": 0,
                                          "resourceType": "microsoft.resources/resourcegroups",
                                          "visualization": "tiles",
                                          "tileSettings": {
                                            "titleContent": {},
                                            "leftContent": {
                                              "columnMatch": "avg_iops",
                                              "formatter": 12,
                                              "formatOptions": {
                                                "palette": "blue"
                                              }
                                            },
                                            "showBorder": false
                                          }
                                        },
                                        "customWidth": "50",
                                        "name": "query - 4",
                                        "styleSettings": {
                                          "showBorder": true
                                        }
                                      },
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "InsightsMetrics \r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_array_performance_latency_usec\"\r\n| summarize avg_io_latency=avg(Val)",
                                          "size": 3,
                                          "title": "Average IO Latency",
                                          "timeContextFromParameter": "Timeframe",
                                          "queryType": 0,
                                          "resourceType": "microsoft.resources/resourcegroups",
                                          "visualization": "tiles",
                                          "tileSettings": {
                                            "titleContent": {
                                              "formatter": 1
                                            },
                                            "leftContent": {
                                              "columnMatch": "avg_io_latency",
                                              "formatter": 12,
                                              "formatOptions": {
                                                "palette": "blue"
                                              }
                                            },
                                            "showBorder": false
                                          }
                                        },
                                        "customWidth": "50",
                                        "name": "query - 6",
                                        "styleSettings": {
                                          "showBorder": true
                                        }
                                      },
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "InsightsMetrics \r\n| where Computer in ({Computer})\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_array_performance_latency_usec\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend dimension=tostring(json.dimension)\r\n| where dimension == \"mirrored_write\"\r\n| summarize avg_io_latency=avg(Val)",
                                          "size": 3,
                                          "title": "Average Mirror Latency",
                                          "queryType": 0,
                                          "resourceType": "microsoft.resources/resourcegroups",
                                          "visualization": "tiles",
                                          "tileSettings": {
                                            "titleContent": {
                                              "formatter": 1
                                            },
                                            "leftContent": {
                                              "columnMatch": "avg_io_latency",
                                              "formatter": 12,
                                              "formatOptions": {
                                                "palette": "blue"
                                              }
                                            },
                                            "showBorder": false
                                          }
                                        },
                                        "customWidth": "50",
                                        "name": "query - 6 - Copy",
                                        "styleSettings": {
                                          "showBorder": true
                                        }
                                      }
                                    ]
                                  },
                                  "name": "Average"
                                }
                              ]
                            },
                            "name": "top first"
                          }
                        ]
                      },
                      "customWidth": "25",
                      "name": "left",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "let total_iops = InsightsMetrics\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_performance_iops\"\r\n| summarize total_iops=sum(Val)\r\n;\r\nInsightsMetrics\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_performance_iops\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend dimension=tostring(json.dimension)\r\n| extend volume=tostring(json.volume)\r\n| summarize iops=sum(Val) by dimension\r\n| extend total_iops=toscalar(total_iops)\r\n| extend iops_ratio = (iops/total_iops)*100",
                              "size": 3,
                              "title": "IOPS Ratio",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.resources/resourcegroups",
                              "visualization": "piechart",
                              "chartSettings": {
                                "yAxis": ["iops_ratio"],
                                "group": "dimension",
                                "createOtherGroup": null,
                                "ySettings": {
                                  "numberFormatSettings": {
                                    "unit": 1,
                                    "options": {
                                      "style": "decimal",
                                      "useGrouping": true
                                    }
                                  }
                                }
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 6",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_space_datareduction_ratio\"\r\n| extend json=parse_json(todynamic(Tags))\r\n| extend dimension=tostring(json.dimension)\r\n| extend volume=tostring(json.volume)\r\n| summarize DRR=sum(Val) by volume",
                              "size": 3,
                              "title": "Datareduction Ratio",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.resources/resourcegroups",
                              "visualization": "piechart",
                              "chartSettings": {
                                "yAxis": ["DRR"],
                                "createOtherGroup": null,
                                "ySettings": {
                                  "numberFormatSettings": {
                                    "unit": 2,
                                    "options": {
                                      "style": "decimal",
                                      "useGrouping": true
                                    }
                                  }
                                }
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 1",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "InsightsMetrics\r\n| where Namespace == \"prometheus\"and Name contains \"purefa_volume_space_bytes\"\r\n| parse-where kind = regex Tags with \"dimension\\\":\\\"\" dimension \"\\\",\" *\r\n| extend dimension=tostring(split(dimension,'\"')[0])\r\n| summarize avg(Val) by bin(TimeGenerated, 30m), dimension",
                              "size": 0,
                              "title": "Capacity Usage Distribution",
                              "timeContextFromParameter": "Timeframe",
                              "queryType": 0,
                              "resourceType": "microsoft.resources/resourcegroups",
                              "visualization": "categoricalbar",
                              "chartSettings": {
                                "group": "dimension",
                                "createOtherGroup": null,
                                "ySettings": {
                                  "numberFormatSettings": {
                                    "unit": 2,
                                    "options": {
                                      "style": "decimal",
                                      "useGrouping": true
                                    }
                                  }
                                }
                              }
                            },
                            "name": "query - 1",
                            "styleSettings": {
                              "showBorder": true
                            }
                          },
                          {
                            "type": 12,
                            "content": {
                              "version": "NotebookGroup/1.0",
                              "groupType": "editable",
                              "items": []
                            },
                            "customWidth": "30",
                            "name": "right"
                          }
                        ]
                      },
                      "customWidth": "40",
                      "name": "middle",
                      "styleSettings": {
                        "showBorder": true
                      }
                    }
                  ]
                },
                "name": "top"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "setTab",
            "comparison": "isEqualTo",
            "value": "System"
          },
          "name": "main"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "parameters": [
                    {
                      "id": "1d9aca7f-8515-44d2-8416-7892105135c0",
                      "version": "KqlParameterItem/1.0",
                      "name": "Application",
                      "type": 2,
                      "value": "pure",
                      "isHiddenWhenLocked": true,
                      "typeSettings": {
                        "additionalResourceOptions": [],
                        "showDefault": false
                      },
                      "jsonData": "[[\"kubevirt\", \"coredns\", \"pure\", \"virt\"]",
                      "timeContext": {
                        "durationMs": 86400000
                      }
                    }
                  ],
                  "style": "pills",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                "name": "parameters - 10"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "KubePodInventory\r\n| where Name has strcat(\"{Application}\",\"-\")\r\n| where Computer in ({Computer})\r\n| distinct Computer, Name, Namespace\r\n| summarize dcount(Name) by Computer",
                  "size": 3,
                  "aggregation": 3,
                  "title": "Count of Pod running in each Node",
                  "timeContextFromParameter": "Timeframe",
                  "queryType": 0,
                  "resourceType": "microsoft.kubernetes/connectedclusters",
                  "crossComponentResources": ["{Resource}"],
                  "visualization": "tiles",
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Computer",
                      "formatter": 1
                    },
                    "leftContent": {
                      "columnMatch": "dcount_Name",
                      "formatter": 12,
                      "formatOptions": {
                        "palette": "auto"
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 2,
                          "maximumSignificantDigits": 3
                        }
                      }
                    },
                    "showBorder": false
                  }
                },
                "customWidth": "50",
                "name": "query - 0",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "KubePodInventory\r\n| where Name has strcat(\"{Application}\",\"-\")\r\n| where Computer in ({Computer})\r\n| distinct Computer, Name, Namespace, ContainerID\r\n| summarize dcount(ContainerID) by Computer",
                  "size": 3,
                  "aggregation": 3,
                  "title": "Count of Container running in each Node",
                  "timeContextFromParameter": "Timeframe",
                  "queryType": 0,
                  "resourceType": "microsoft.kubernetes/connectedclusters",
                  "crossComponentResources": ["{Resource}"],
                  "visualization": "tiles",
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Computer",
                      "formatter": 1
                    },
                    "leftContent": {
                      "columnMatch": "dcount_ContainerID",
                      "formatter": 12,
                      "formatOptions": {
                        "palette": "auto"
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 2,
                          "maximumSignificantDigits": 3
                        }
                      }
                    },
                    "showBorder": false
                  }
                },
                "customWidth": "50",
                "name": "query - 0 - Copy",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "KubePodInventory\r\n| where Name has strcat(\"{Application}\",\"-\")\r\n| where Computer in ({Computer})\r\n| distinct Computer, Namespace, Name, _ResourceId, PodStatus\r\n| summarize count() by PodStatus",
                  "size": 3,
                  "aggregation": 3,
                  "title": "Pod Status",
                  "timeContextFromParameter": "Timeframe",
                  "queryType": 0,
                  "resourceType": "microsoft.kubernetes/connectedclusters",
                  "crossComponentResources": ["{Resource}"],
                  "visualization": "piechart"
                },
                "customWidth": "20",
                "name": "query - 0 - Copy",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "KubePodInventory\r\n| where Name has strcat(\"{Application}\",\"-\")\r\n| where Computer in ({Computer})\r\n| distinct Computer, Namespace, Name, _ResourceId, PodStatus",
                  "size": 0,
                  "aggregation": 3,
                  "title": "Pod Status",
                  "timeContextFromParameter": "Timeframe",
                  "queryType": 0,
                  "resourceType": "microsoft.kubernetes/connectedclusters",
                  "crossComponentResources": ["{Resource}"],
                  "visualization": "table",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "_ResourceId",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "PodStatus",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Running",
                              "representation": "Available",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "Terminating",
                              "representation": "disabled",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "Pending",
                              "representation": "pending",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "more",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      }
                    ]
                  }
                },
                "customWidth": "40",
                "name": "query - 0 - Copy - Copy",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "KubePodInventory\r\n| where Name has strcat(\"{Application}\",\"-\")\r\n| where Computer in ({Computer})\r\n| project TimeGenerated, Computer, Namespace, Name, PodUid, PodCreationTimeStamp, PodRestartCount, PodStartTime, PodStatus, PodIp, ServiceName, ControllerKind, ControllerName\r\n| summarize sum(PodRestartCount) by bin(TimeGenerated,30m), Name",
                  "size": 0,
                  "aggregation": 3,
                  "title": "Pod Restarts over Time",
                  "timeContextFromParameter": "Timeframe",
                  "queryType": 0,
                  "resourceType": "microsoft.kubernetes/connectedclusters",
                  "crossComponentResources": ["{Resource}"],
                  "visualization": "timechart"
                },
                "customWidth": "40",
                "name": "query - 0 - Copy",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "KubePodInventory\r\n| where Name has strcat(\"{Application}\",\"-\")\r\n| where Computer in ({Computer})\r\n| distinct Computer, Namespace, Name, _ResourceId, ContainerStatus, ContainerID\r\n| summarize count() by ContainerStatus",
                  "size": 3,
                  "aggregation": 3,
                  "title": "Container Status",
                  "timeContextFromParameter": "Timeframe",
                  "queryType": 0,
                  "resourceType": "microsoft.kubernetes/connectedclusters",
                  "crossComponentResources": ["{Resource}"],
                  "visualization": "piechart"
                },
                "customWidth": "20",
                "name": "query - 0 - Copy",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "KubePodInventory\r\n| where Name has strcat(\"{Application}\",\"-\")\r\n| where Computer in ({Computer})\r\n| distinct Computer, Namespace, Name, _ResourceId, ContainerStatus, ContainerID",
                  "size": 0,
                  "aggregation": 3,
                  "title": "Container Status",
                  "timeContextFromParameter": "Timeframe",
                  "queryType": 0,
                  "resourceType": "microsoft.kubernetes/connectedclusters",
                  "crossComponentResources": ["{Resource}"],
                  "visualization": "table",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "_ResourceId",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "ContainerStatus",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "running",
                              "representation": "success",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "text": "{0}{1}"
                            },
                            {
                              "thresholdValue": "waiting",
                              "representation": "pending",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "more",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      }
                    ]
                  }
                },
                "customWidth": "40",
                "name": "query - 0 - Copy - Copy",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "KubePodInventory\r\n| where Name has strcat(\"{Application}\",\"-\")\r\n| where Computer in ({Computer})\r\n| project TimeGenerated, Computer, Namespace, Name, ContainerID, ContainerLastStatus, ContainerName, ContainerRestartCount, ContainerStartTime, ContainerStatus, ContainerStatusReason, ControllerKind, ControllerName\r\n| summarize sum(ContainerRestartCount) by bin(TimeGenerated,30m), ContainerName",
                  "size": 0,
                  "aggregation": 3,
                  "title": "Container details",
                  "timeContextFromParameter": "Timeframe",
                  "queryType": 0,
                  "resourceType": "microsoft.kubernetes/connectedclusters",
                  "crossComponentResources": ["{Resource}"],
                  "visualization": "timechart"
                },
                "customWidth": "40",
                "name": "query - 0 - Copy",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 1,
                "content": {
                  "json": "##  _Click on a Pod to see more details about the Container's listed, logs, events and more information._ "
                },
                "name": "text - 14"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "KubePodInventory\r\n| where Name has strcat(\"{Application}\",\"-\")\r\n| where Computer in ({Computer})\r\n| distinct Computer, Name, Namespace, ContainerName\r\n| extend PodName = Name\r\n| project-away Name\r\n| project-reorder Computer, PodName, Namespace, ContainerName",
                  "size": 0,
                  "title": "List Node, Pod, Containers",
                  "timeContextFromParameter": "Timeframe",
                  "exportParameterName": "row",
                  "exportDefaultValue": "{}",
                  "queryType": 0,
                  "resourceType": "microsoft.kubernetes/connectedclusters",
                  "crossComponentResources": ["{Resource}"]
                },
                "customWidth": "50",
                "name": "query - 15",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "let row = dynamic({row});\r\nKubePodInventory\r\n| where Name has strcat(\"{Application}\", \"-\")\r\n| where Computer in ({Computer})\r\n| where '{row}' == '{}' or (Name == row.PodName)\r\n//| where TimeGenerated >= ago(startDateTime)\r\n| where Namespace in('default', 'kube-system', 'nc-system') // and ControllerKind == 'ReplicaSet' // the system namespace filter goes here\r\n| distinct\r\n    ClusterName,\r\n    Computer,\r\n    PodUid,\r\n    TimeGenerated,\r\n    PodStatus,\r\n    ServiceName,\r\n    PodLabel,\r\n    Namespace,\r\n    ContainerStatus,\r\n    Name,\r\n    ControllerKind\r\n| summarize\r\n    arg_max(TimeGenerated, *),\r\n    TotalPODCount = count(),\r\n    podCount = sumif(1, PodStatus == 'Running' or PodStatus != 'Running'),\r\n    containerNotrunning = sumif(1, ContainerStatus != 'running')\r\n    by\r\n    ClusterName,\r\n    TimeGenerated,\r\n    ServiceName,\r\n    PodLabel,\r\n    Namespace,\r\n    Name,\r\n    ControllerKind\r\n| project\r\n    ClusterName,\r\n    ServiceName,\r\n    podCount,\r\n    containerNotrunning,\r\n    containerNotrunningPercent = (containerNotrunning * 100 / podCount),\r\n    TimeGenerated,\r\n    PodStatus,\r\n    PodLabel,\r\n    Namespace,\r\n    Environment = tostring(split(ClusterName, '-')[3]),\r\n    Location = tostring(split(ClusterName, '-')[4]),\r\n    ContainerStatus,\r\n    ControllerKind,\r\n    Name,\r\n    Computer\r\n//Uncomment the below line to set for automated alert\r\n| where PodStatus == \"Running\" //and containerNotrunningPercent > _minalertThreshold and containerNotrunningPercent < _maxalertThreshold\r\n| summarize arg_max(TimeGenerated, *), c_entry=count() by PodLabel, ServiceName, ClusterName, ControllerKind, Name, Computer\r\n//Below lines are to parse the labels to identify the impacted service/component name\r\n| extend parseLabel = replace(@'k8s-app', @'k8sapp', PodLabel)\r\n| extend parseLabel = replace(@'app.kubernetes.io/component', @'appkubernetesiocomponent', parseLabel)\r\n| extend parseLabel = replace(@'app.kubernetes.io/instance', @'appkubernetesioinstance', parseLabel)\r\n| extend tags = todynamic(parseLabel)\r\n| extend tag01 = todynamic(tags[0].app)\r\n| extend tag02 = todynamic(tags[0].k8sapp)\r\n| extend tag03 = todynamic(tags[0].appkubernetesiocomponent)\r\n| extend tag04 = todynamic(tags[0].aadpodidbinding)\r\n| extend tag05 = todynamic(tags[0].appkubernetesioinstance)\r\n| extend tag06 = todynamic(tags[0].component)\r\n| extend ContainerRunning = 100 - containerNotrunningPercent\r\n| project ClusterName, TimeGenerated, ControllerKind, Name, Computer,\r\n    ServiceName = strcat(ServiceName, tag01, tag02, tag03, tag04, tag05, tag06),\r\n    ContainerUnavailable = strcat(\"Unavailable Percentage: \", containerNotrunningPercent),\r\n    ContainerRunning,\r\n    containerNotrunningPercent,\r\n    PodStatus = PodStatus, \r\n    ContainerStatus = ContainerStatus",
                  "size": 0,
                  "title": "Pod/Container Availability",
                  "timeContextFromParameter": "Timeframe",
                  "queryType": 0,
                  "resourceType": "microsoft.kubernetes/connectedclusters",
                  "crossComponentResources": ["{Resource}"],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "ClusterName",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "TimeGenerated",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "ContainerRunning",
                        "formatter": 22,
                        "formatOptions": {
                          "compositeBarSettings": {
                            "labelText": "",
                            "columnSettings": [
                              {
                                "columnName": "ContainerRunning",
                                "color": "blue"
                              },
                              {
                                "columnName": "containerNotrunningPercent",
                                "color": "red"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "containerNotrunningPercent",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "PodStatus",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Running",
                              "representation": "success",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "Terminating",
                              "representation": "disabled",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "more",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      {
                        "columnMatch": "containerrunningPercent",
                        "formatter": 22,
                        "formatOptions": {
                          "compositeBarSettings": {
                            "labelText": "",
                            "columnSettings": [
                              {
                                "columnName": "containerrunningPercent",
                                "color": "blue"
                              },
                              {
                                "columnName": "containerNotrunningPercent",
                                "color": "red"
                              }
                            ]
                          }
                        }
                      }
                    ]
                  }
                },
                "customWidth": "50",
                "name": "query - 11",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "let row = dynamic({row});\r\nKubePodInventory\r\n| where Name has strcat(\"{Application}\",\"-\")\r\n| where Computer in ({Computer})\r\n| where '{row}' == '{}' or (Name == row.PodName)\r\n| top-nested of PodUid by max(1), top-nested 1 of TimeGenerated by max(TimeGenerated), top-nested of Computer by max(1), top-nested of Namespace by max(1), top-nested of Name by max(1), top-nested of PodCreationTimeStamp by max(1), top-nested of PodRestartCount by max(1), top-nested of PodStartTime by max(1), top-nested of PodStatus by max(1), top-nested of PodIp by max(1), top-nested of ServiceName by max(1), top-nested of ControllerKind by max(1), top-nested of ControllerName by max(1)\r\n| extend  PodName = Name\r\n| project TimeGenerated, Computer, Namespace, PodName, PodUid, PodCreationTimeStamp, PodRestartCount, PodStartTime, PodStatus, PodIp, ServiceName, ControllerKind, ControllerName\r\n//| project TimeGenerated, Computer, Namespace, PodName, ContainerID, ContainerLastStatus, ContainerName, ContainerRestartCount, ContainerStartTime, ContainerStatus, ContainerStatusReason, ControllerKind, ControllerName",
                  "size": 0,
                  "title": "Pod details",
                  "timeContextFromParameter": "Timeframe",
                  "queryType": 0,
                  "resourceType": "microsoft.kubernetes/connectedclusters",
                  "crossComponentResources": ["{Resource}"],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Computer",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "Name",
                        "formatter": 5
                      }
                    ],
                    "hierarchySettings": {
                      "treeType": 1,
                      "groupBy": ["Computer"],
                      "expandTopLevel": true
                    }
                  }
                },
                "customWidth": "50",
                "name": "query - 0 - Copy",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "let row = dynamic({row});\r\nKubePodInventory\r\n| where Name has strcat(\"{Application}\",\"-\")\r\n| where Computer in ({Computer})\r\n| where '{row}' == '{}' or (Name == row.PodName)\r\n| top-nested of ContainerID by max(1), top-nested 1 of TimeGenerated by max(TimeGenerated), top-nested of Computer by max(1), top-nested of Namespace by max(1), top-nested of Name by max(1), top-nested of ContainerLastStatus by max(1), top-nested of ContainerName by max(1), top-nested of ContainerRestartCount by max(1), top-nested of ContainerStartTime by max(1), top-nested of ContainerStatus by max(1), top-nested of ContainerStatusReason by max(1), top-nested of ControllerKind by max(1), top-nested of ControllerName by max(1)\r\n| extend  PodName = Name\r\n| project TimeGenerated, Computer, Namespace, PodName, ContainerID, ContainerLastStatus, ContainerName, ContainerRestartCount, ContainerStartTime, ContainerStatus, ContainerStatusReason, ControllerKind, ControllerName\r\n//| project TimeGenerated, Computer, Namespace, Name, ContainerID, ContainerLastStatus, ContainerName, ContainerRestartCount, ContainerStartTime, ContainerStatus, ContainerStatusReason, ControllerKind, ControllerName",
                  "size": 0,
                  "title": "Container details",
                  "timeContextFromParameter": "Timeframe",
                  "queryType": 0,
                  "resourceType": "microsoft.kubernetes/connectedclusters",
                  "crossComponentResources": ["{Resource}"],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Computer",
                        "formatter": 5
                      }
                    ],
                    "hierarchySettings": {
                      "treeType": 1,
                      "groupBy": ["Computer"],
                      "expandTopLevel": true
                    }
                  }
                },
                "customWidth": "50",
                "name": "query - 0 - Copy - Copy",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "let row = dynamic({row});\r\nKubePodInventory\r\n| where Name has strcat(\"{Application}\",\"-\")\r\n| where Computer in ({Computer})\r\n| where '{row}' == '{}' or (Name == row.PodName)\r\n| project TimeGenerated, Computer, Namespace, Name, PodUid, PodCreationTimeStamp, PodRestartCount, PodStartTime, PodStatus, PodIp, ServiceName, ControllerKind, ControllerName, ContainerID, ContainerLastStatus, ContainerName, ContainerRestartCount, ContainerStartTime, ContainerStatus, ContainerStatusReason, _ResourceId\r\n| join KubeEvents on Computer, Name, _ResourceId, TimeGenerated\r\n| project TimeGenerated, Computer, Name, Reason, Message, KubeEventType, SourceComponent\r\n| extend PodName = Name\r\n\r\n\r\n",
                  "size": 0,
                  "title": "KubeEvents for the Pods",
                  "timeContextFromParameter": "Timeframe",
                  "queryType": 0,
                  "resourceType": "microsoft.kubernetes/connectedclusters",
                  "crossComponentResources": ["{Resource}"],
                  "visualization": "table",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Name",
                        "formatter": 5
                      }
                    ]
                  }
                },
                "customWidth": "50",
                "name": "query - 0 - Copy",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "let row = dynamic({row});\r\nKubePodInventory\r\n| where Name has strcat(\"{Application}\",\"-\")\r\n| where Computer in ({Computer})\r\n| where '{row}' == '{}' or (Name == row.PodName)\r\n| project TimeGenerated, Computer, Namespace, Name, PodUid, PodCreationTimeStamp, PodRestartCount, PodStartTime, PodStatus, PodIp, ServiceName, ControllerKind, ControllerName, ContainerID, ContainerLastStatus, ContainerName, ContainerRestartCount, ContainerStartTime, ContainerStatus, ContainerStatusReason, _ResourceId\r\n| join ContainerLog on Computer, ContainerID, _ResourceId\r\n| project-away TimeGenerated\r\n| project TimeGenerated1, ContainerID, TimeOfCommand, Image, LogEntry, LogEntrySource\r\n| project-rename TimeGenerated = TimeGenerated1\r\n",
                  "size": 0,
                  "title": "Container Log",
                  "timeContextFromParameter": "Timeframe",
                  "queryType": 0,
                  "resourceType": "microsoft.kubernetes/connectedclusters",
                  "crossComponentResources": ["{Resource}"]
                },
                "customWidth": "50",
                "name": "query - 13",
                "styleSettings": {
                  "showBorder": true
                }
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "setTab",
            "comparison": "isEqualTo",
            "value": "Log"
          },
          "name": "group - 6"
        }
      ],
      "isLocked": false,
      "fallbackResourceIds": ["[parameters('workbookSourceId')]"],
      "styleSettings": {
        "paddingStyle": "wide",
        "spacingStyle": "wide"
      }
    }
  },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[parameters('workbookLocation')]",
      "apiVersion": "2021-03-08",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "[string(variables('workbookContent'))]",
        "version": "1.0",
        "sourceId": "[parameters('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
}
