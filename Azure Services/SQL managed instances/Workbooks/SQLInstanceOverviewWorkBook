{
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "OMP Cloud - SQL Instance Overview",
      "metadata": {
        "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "workload-insights",
      "metadata": {
        "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
      }
    },
    "workbookSourceId": {
      "type": "string",
      "defaultValue": "azure monitor",
      "metadata": {
        "description": "The id of resource instance to which the workbook will be associated"
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    }
  },
  "variables": {
    "workbookContent": {
      "version": "Notebook/1.0",
      "items": [
        {
          "type": 1,
          "content": {
            "json": "   ![alt](https://ehnkw9yknjp.exactdn.com/app/themes/coginiti-sage/resources/svg/Logo=Azure%20SQL%20Server,%20Color=Yes.svg)\r\n![alt](https://azureclidevops2021.blob.core.windows.net/repo/kcloud.png?sp=r&st=2022-01-05T15:45:57Z&se=2099-01-05T23:45:57Z&sv=2020-08-04&sr=b&sig=ycEAnRhZty7qtRadZ3uXYcVeJgQI6XnZ3A%2FsoYYrYpA%3D)"
          },
          "showPin": true,
          "name": "text - 10",
          "styleSettings": {
            "showBorder": true
          }
        },
        {
          "type": 1,
          "content": {
            "json": "## ⏬ Please select \"Customer DB Profile\" below the list\r\n",
            "style": "info"
          },
          "name": "text - 11"
        },
        {
          "type": 9,
          "content": {
            "version": "KqlParameterItem/1.0",
            "parameters": [
              {
                "id": "af2af70b-7ea5-40a0-be60-2d87c0d17ed8",
                "version": "KqlParameterItem/1.0",
                "name": "MonitoringProfile",
                "label": "Customer DB Profile",
                "type": 5,
                "isRequired": true,
                "query": "Resources\r\n| where type =~ 'microsoft.insights/datacollectionrules'\r\n| where name contains \"SMP\" ",
                "crossComponentResources": [
                  "value::all"
                ],
                "typeSettings": {
                  "additionalResourceOptions": [],
                  "showDefault": false
                },
                "timeContext": {
                  "durationMs": 86400000
                },
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "value": "/subscriptions/9fd8aad6-f192-44f1-8fe4-5c6a9fe955a5/resourceGroups/ompc-110020-log/providers/Microsoft.Insights/dataCollectionRules/SMP-110020"
              },
              {
                "id": "0cebb139-7c97-434a-b077-07704c77c295",
                "version": "KqlParameterItem/1.0",
                "name": "Associations",
                "type": 2,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{MonitoringProfile}/associations?api-version=2019-11-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"id\",\"columnid\":\"Id\"}]}}]}",
                "value": [
                  "value::all"
                ],
                "isHiddenWhenLocked": true,
                "typeSettings": {
                  "additionalResourceOptions": [
                    "value::all"
                  ],
                  "showDefault": false
                },
                "queryType": 12
              },
              {
                "id": "0a9b1be7-5981-4d35-9b5e-fd7c7f9e80ef",
                "version": "KqlParameterItem/1.0",
                "name": "Workspaces",
                "type": 5,
                "isRequired": true,
                "query": "Resources\n| where id =~ '{MonitoringProfile}'\n| project la = properties.destinations.logAnalytics\n| mvexpand la limit 400\n| project id = tostring (la.workspaceResourceId)\n| project value = id, label = id, selected = true",
                "crossComponentResources": [
                  "value::all"
                ],
                "isHiddenWhenLocked": true,
                "typeSettings": {
                  "additionalResourceOptions": [],
                  "showDefault": false
                },
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources"
              },
              {
                "id": "0b697882-249b-4053-9807-9e654383d2a5",
                "version": "KqlParameterItem/1.0",
                "name": "TimeRange",
                "label": "Time range",
                "type": 4,
                "isRequired": true,
                "value": {
                  "durationMs": 3600000
                },
                "typeSettings": {
                  "selectableValues": [
                    {
                      "durationMs": 300000
                    },
                    {
                      "durationMs": 900000
                    },
                    {
                      "durationMs": 1800000
                    },
                    {
                      "durationMs": 3600000
                    },
                    {
                      "durationMs": 14400000
                    },
                    {
                      "durationMs": 43200000
                    },
                    {
                      "durationMs": 86400000
                    },
                    {
                      "durationMs": 172800000
                    },
                    {
                      "durationMs": 259200000
                    },
                    {
                      "durationMs": 604800000
                    },
                    {
                      "durationMs": 1209600000
                    },
                    {
                      "durationMs": 2419200000
                    },
                    {
                      "durationMs": 2592000000
                    },
                    {
                      "durationMs": 5184000000
                    },
                    {
                      "durationMs": 7776000000
                    }
                  ]
                }
              },
              {
                "id": "c7688036-0080-4174-94ae-51b64b5211d9",
                "version": "KqlParameterItem/1.0",
                "name": "OnboardedComputers",
                "type": 5,
                "isRequired": true,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "query": "Resources\r\n| take 1\r\n| project associations = dynamic([{Associations}])\r\n| mvexpand associations limit 400\r\n| project id = tolower(extract(@'(?i)/subscriptions/.+/resourcegroups/.+/providers/microsoft.compute/virtualmachines/(.+)/providers/microsoft.insights/datacollectionruleassociations/.+', 1, tostring(associations)))\r\n| project value = id, label = id, selected = true\r\n\r\n",
                "crossComponentResources": [
                  "value::all"
                ],
                "isHiddenWhenLocked": true,
                "typeSettings": {
                  "additionalResourceOptions": [],
                  "showDefault": false
                },
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources"
              },
              {
                "id": "594fa1c4-5b3a-463e-a729-8ac227d61c64",
                "version": "KqlParameterItem/1.0",
                "name": "SqlType",
                "type": 1,
                "isRequired": true,
                "value": "SQL Server instances",
                "isHiddenWhenLocked": true
              },
              {
                "id": "65e627f5-fc41-41cf-aaf3-c1b31ba2e01d",
                "version": "KqlParameterItem/1.0",
                "name": "SqlServers",
                "label": "Servers",
                "type": 2,
                "isRequired": true,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace contains 'sqlserver_server_properties' and Name == 'engine_edition'\r\n| extend Tags = todynamic(Tags)\r\n| extend Database = tostring(Tags.database_name), Instance = tostring(Tags.sql_instance)\r\n| where ('{SqlType}' == 'Databases' and Val == 5) or \r\n    ('{SqlType}'  == 'Instances' and Val == 8) or\r\n    ('{SqlType}'  == 'SQL Server instances' and Val in (1, 2, 3, 4))\r\n| summarize by Instance\r\n| project value = Instance, label = Instance, selected = true",
                "crossComponentResources": [
                  "{Workspaces}"
                ],
                "typeSettings": {
                  "additionalResourceOptions": [
                    "value::all"
                  ],
                  "showDefault": false
                },
                "timeContext": {
                  "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "value": [
                  "value::all"
                ]
              }
            ],
            "style": "above",
            "queryType": 0,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          "customWidth": "0",
          "name": "parameters - 0",
          "styleSettings": {
            "margin": "15px 0 0 0"
          }
        },
        {
          "type": 11,
          "content": {
            "version": "LinkItem/1.0",
            "style": "tabs",
            "links": [
              {
                "id": "37f0d44c-c4f4-44e6-ad23-63ddfdfe6386",
                "cellValue": "selectedTab",
                "linkTarget": "parameter",
                "linkLabel": "Overview",
                "subTarget": "Overview",
                "style": "link"
              },
              {
                "id": "552fee76-401d-4342-84d0-b5fb1354a5e4",
                "cellValue": "selectedTab",
                "linkTarget": "parameter",
                "linkLabel": "Activities",
                "subTarget": "Activities",
                "style": "link"
              },
              {
                "id": "4869d2b3-eec8-4c5f-9b40-c861ba79c853",
                "cellValue": "selectedTab",
                "linkTarget": "parameter",
                "linkLabel": "Replicas",
                "subTarget": "Replicas",
                "style": "link"
              },
              {
                "id": "5546a076-3427-4bf3-8c44-a3be9a1c39d0",
                "cellValue": "selectedTab",
                "linkTarget": "parameter",
                "linkLabel": "Database space",
                "subTarget": "Database space",
                "style": "link"
              },
              {
                "id": "5473b66e-5f55-48a3-9b1f-86a1eb2d625e",
                "cellValue": "selectedTab",
                "linkTarget": "parameter",
                "linkLabel": "Transactions",
                "subTarget": "Transactions",
                "style": "link"
              },
              {
                "id": "51bcef84-f9a7-4936-98cd-6f9c10412a52",
                "cellValue": "selectedTab",
                "linkTarget": "parameter",
                "linkLabel": "Database IO",
                "subTarget": "Database IO",
                "style": "link"
              },
              {
                "id": "fb8074f5-1109-44a3-ab3b-9c95eb768b68",
                "cellValue": "selectedTab",
                "linkTarget": "parameter",
                "linkLabel": "Explore metrics",
                "subTarget": "Sql counters",
                "style": "link"
              }
            ]
          },
          "name": "links - 3",
          "styleSettings": {
            "margin": "15px 0 0 0"
          }
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "Please select an existing SQL monitoring profile or create a new one using the `Create new profile` button.",
                  "style": "warning"
                },
                "conditionalVisibility": {
                  "parameterName": "MonitoringProfile",
                  "comparison": "isEqualTo"
                },
                "name": "text - 0",
                "styleSettings": {
                  "margin": "20px 0 0 0"
                }
              },
              {
                "type": 1,
                "content": {
                  "json": "Looks like you don't have any monitoring virtual machines associated with this profile. Please associate one or more from the `Manage profile` tab.",
                  "style": "warning"
                },
                "conditionalVisibilities": [
                  {
                    "parameterName": "MonitoringProfile",
                    "comparison": "isNotEqualTo"
                  },
                  {
                    "parameterName": "OnboardedComputers",
                    "comparison": "isEqualTo"
                  }
                ],
                "name": "text - 0 - Copy",
                "styleSettings": {
                  "margin": "20px 0 0 0"
                }
              }
            ]
          },
          "conditionalVisibilities": [
            {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Overview"
            },
            {
              "parameterName": "OnboardedComputers",
              "comparison": "isEqualTo",
              "value": ""
            }
          ],
          "name": "Onboarding message"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "let data = InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace contains 'sqlserver_server_properties'\r\n| extend Tags = todynamic(Tags)\r\n| extend Database = tostring(Tags.database_name), Instance = tostring(Tags.sql_instance)\r\n| extend DatabaseKey = iff(Database == Instance, Database, strcat(Database, ' on ', Instance))\r\n| where Instance in~ ({SqlServers});\r\ndata\r\n| summarize (LastTimestamp, Val) = arg_max(TimeGenerated, Val) by Name, Database, Instance, Computer\r\n| extend Val = iff(LastTimestamp < now() - 10m and Name != 'engine_edition', 0.0, Val)\r\n| summarize CurrentOnline = sumif(Val, Name == 'db_online'),\r\n    CurrentUnhealthy = sumif(Val, Name in~ ('db_offline', 'db_recovering', 'db_recoveryPending', 'db_restoring', 'db_suspect')),\r\n    EngineEdition = sumif(Val, Name == 'engine_edition')\r\n  by Database, Instance, Computer\r\n| extend CurrentOnline = iff(EngineEdition == 5 and CurrentOnline > 0, 1.0, CurrentOnline)\r\n| extend Key = strcat(Computer, '/', Instance, '/', Database)\r\n| join kind = inner (data\r\n    | summarize OverallOnline = minif(Val, Name == 'db_online'),\r\n                OverallUnhealthy = maxif(Val, Name in~ ('db_offline', 'db_recovering', 'db_recoveryPending', 'db_restoring', 'db_suspect')),\r\n                EngineEdition = sumif(Val, Name == 'engine_edition')\r\n    by Key = strcat(Computer, '/', Instance, '/', Database)\r\n) on Key\r\n| extend CurrentOnline = iff(EngineEdition == 5 and CurrentOnline > 0, 1.0, CurrentOnline), OverallOnline = iff(EngineEdition == 5 and OverallOnline > 0, 1.0, OverallOnline)\r\n| project-away Key, Key1, EngineEdition1\r\n| extend Type = case(\r\n            EngineEdition == 1, 'SQL Server Personal',\r\n            EngineEdition == 2, 'SQL Server Standard',\r\n            EngineEdition == 3, 'SQL Server Enterprise',\r\n            EngineEdition == 4, 'SQL Server Express',\r\n            EngineEdition == 5, 'Azure SQL Database ',\r\n            EngineEdition == 6, 'Microsoft Azure Synapse Analytics',\r\n            EngineEdition == 8, 'Instance',\r\n            EngineEdition == 9, 'Azure SQL Edge',\r\n            EngineEdition == 20, 'Azure Logical SQL Server',\r\n            '-')\r\n| project Database = strcat(Instance, '/', Database), Green = CurrentOnline, Yellow = OverallUnhealthy - CurrentUnhealthy, Red = CurrentUnhealthy, Total = CurrentOnline + CurrentUnhealthy, Gray = iff(OverallOnline == CurrentOnline, 0.0, OverallOnline + OverallUnhealthy - CurrentOnline - CurrentUnhealthy), Type, Computer\r\n| summarize ['Online dbs'] = sum(Green), ['Previously unhealthy dbs'] = sum(Yellow), ['Currently unhealthy dbs'] = sum(Red), [\"No telemetry dbs\"] = sum(Gray), Total = sum(Total) by Type\r\n| extend Subtitle = '━━━'\r\n| order by ['Currently unhealthy dbs'] desc, [\"No telemetry dbs\"] desc, ['Previously unhealthy dbs'] desc, ['Online dbs'] desc\r\n",
                        "size": 4,
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspaces}"
                        ],
                        "visualization": "tiles",
                        "sortBy": [],
                        "tileSettings": {
                          "titleContent": {
                            "columnMatch": "Type",
                            "formatter": 1
                          },
                          "subtitleContent": {
                            "columnMatch": "Subtitle",
                            "formatter": 1
                          },
                          "leftContent": {
                            "columnMatch": "Green",
                            "formatter": 22,
                            "formatOptions": {
                              "compositeBarSettings": {
                                "labelText": "[\"Online dbs\"] / [\"Total\"] dbs are online",
                                "columnSettings": [
                                  {
                                    "columnName": "Online dbs",
                                    "color": "green"
                                  },
                                  {
                                    "columnName": "No telemetry dbs",
                                    "color": "orange"
                                  },
                                  {
                                    "columnName": "Previously unhealthy dbs",
                                    "color": "yellow"
                                  },
                                  {
                                    "columnName": "Currently unhealthy dbs",
                                    "color": "redBright"
                                  }
                                ]
                              }
                            },
                            "numberFormat": {
                              "unit": 17,
                              "options": {
                                "style": "decimal",
                                "useGrouping": false,
                                "maximumFractionDigits": 1
                              }
                            }
                          },
                          "secondaryContent": {
                            "columnMatch": "Trend",
                            "formatter": 21,
                            "formatOptions": {
                              "min": 0,
                              "palette": "blue"
                            }
                          },
                          "showBorder": false
                        }
                      },
                      "name": "query - 0"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "let data = InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace contains 'sqlserver_server_properties'\r\n| extend Tags = todynamic(Tags)\r\n| extend Database = tostring(Tags.database_name), Instance = tostring(Tags.sql_instance)\r\n| extend DatabaseKey = iff(Database == Instance, Database, strcat(Database, ' on ', Instance))\r\n| where Instance in~ ({SqlServers});\r\nlet results = data\r\n| summarize (LastTimestamp, Val) = arg_max(TimeGenerated, Val) by Name, Database, Instance, Computer, TenantId\r\n| extend Val = iff(LastTimestamp < now() - 10m and Name != 'engine_edition', 0.0, Val)\r\n| summarize CurrentOnline = sumif(Val, Name == 'db_online'),\r\n    CurrentUnhealthy = sumif(Val, Name in~ ('db_offline', 'db_recovering', 'db_recoveryPending', 'db_restoring', 'db_suspect')),\r\n    EngineEdition = sumif(Val, Name == 'engine_edition')\r\n  by Database, Instance, Computer, TenantId\r\n| extend CurrentOnline = iff(EngineEdition == 5 and CurrentOnline > 0, 1.0, CurrentOnline)\r\n| extend Key = strcat(Computer, '/', Instance, '/', Database)\r\n| join kind = inner (data\r\n    | summarize OverallOnline = minif(Val, Name == 'db_online'),\r\n                OverallUnhealthy = maxif(Val, Name in~ ('db_offline', 'db_recovering', 'db_recoveryPending', 'db_restoring', 'db_suspect')),\r\n                EngineEdition = sumif(Val, Name == 'engine_edition')\r\n    by Key = strcat(Computer, '/', Instance, '/', Database)\r\n) on Key\r\n| extend CurrentOnline = iff(EngineEdition == 5 and CurrentOnline > 0, 1.0, CurrentOnline), OverallOnline = iff(EngineEdition == 5 and OverallOnline > 0, 1.0, OverallOnline)\r\n;\r\nresults\r\n| where EngineEdition == 5\r\n| summarize \r\n        CurrentOnline = sum(CurrentOnline),\r\n        CurrentUnhealthy = sum(CurrentUnhealthy),\r\n        OverallUnhealthy = sum(OverallUnhealthy),\r\n        OverallOnline = sum(OverallOnline)\r\n    by Id = Instance, Parent = '', Name = Instance, key = Instance, Instance, TenantId, Database = '*'\r\n| extend EngineEdition = 20.0\r\n| union (results\r\n    | where EngineEdition == 5\r\n    | project Id = strcat(Computer, '/', Instance, '/', Database), Parent = Instance, Name = Database, CurrentOnline, CurrentUnhealthy, OverallOnline, OverallUnhealthy, EngineEdition, Computer, Instance, Database, TenantId\r\n    | extend key = Id)\r\n| union (results\r\n    | where EngineEdition != 5\r\n    | project Id = strcat(Computer, '/', Instance), Parent = '', Name = Instance, CurrentOnline, CurrentUnhealthy, OverallOnline, OverallUnhealthy, EngineEdition, Computer, key = strcat(Computer, '/', Instance, '/', Database), Instance, Database, TenantId)\r\n| join kind = inner (\r\ndata\r\n    | where Name in~ ('db_online', 'engine_edition')\r\n    | summarize Online = minif(Val, Name == 'db_online'),\r\n                EngineEdition = maxif(Val, Name == 'engine_edition')\r\n            by Database, Instance, Computer, bin(TimeGenerated, {TimeRange:grain})\r\n    | extend Online = iff(EngineEdition == 5, 1.0, Online)\r\n    | make-series Trend = min(Online) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} by key = strcat(Computer, '/', Instance, '/', Database)\r\n| union (\r\ndata\r\n    | where Name in~ ('db_online', 'engine_edition')\r\n    | summarize Online = minif(Val, Name == 'db_online'),\r\n                EngineEdition = maxif(Val, Name == 'engine_edition')\r\n            by Database, Instance, Computer, bin(TimeGenerated, {TimeRange:grain})\r\n    | where EngineEdition == 5\r\n    | extend Online = iff(EngineEdition == 5, 1.0, Online)\r\n    | make-series Trend = sum(Online) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} by key = Instance\r\n)\r\n) on key\r\n| extend Type = case(\r\n            EngineEdition == 1, 'SQL Server Personal',\r\n            EngineEdition == 2, 'SQL Server Standard',\r\n            EngineEdition == 3, 'SQL Server Enterprise',\r\n            EngineEdition == 4, 'SQL Server Express',\r\n            EngineEdition == 5, 'Azure SQL Database ',\r\n            EngineEdition == 6, 'Microsoft Azure Synapse Analytics',\r\n            EngineEdition == 8, 'Azure Managed Instance',\r\n            EngineEdition == 9, 'Azure SQL Edge',\r\n            EngineEdition == 20, 'Azure Logical SQL Server',            '-')\r\n| project Id, Parent, Name, Status = case(CurrentUnhealthy > 0, 'Offline', CurrentOnline + CurrentUnhealthy < OverallOnline + OverallUnhealthy, 'No telemetry', OverallUnhealthy - CurrentUnhealthy > 0, 'Previously offline', OverallUnhealthy == 0, 'Online', ''), ['Online dbs'] = CurrentOnline, ['Previously unhealthy dbs'] = OverallUnhealthy - CurrentUnhealthy, ['Currently unhealthy dbs'] = CurrentUnhealthy, Total = CurrentOnline + CurrentUnhealthy, Trend, Type, Computer, DbId = strcat('/workspace/', TenantId, '/computer/', iff(Computer == '', '*', Computer), '/sqlinstance/', Instance, '/database/', Database), Title = strcat(Type, ' > ', iff(EngineEdition == 5, strcat(Instance, '/', Database), Instance)), [\"No telemetry dbs\"] =  iff(OverallOnline == CurrentOnline, 0.0, OverallOnline + OverallUnhealthy - CurrentOnline - CurrentUnhealthy)\r\n| order by ['Currently unhealthy dbs'] desc, [\"No telemetry dbs\"] desc, ['Previously unhealthy dbs'] desc, ['Online dbs'] desc, Name asc, Computer asc",
                        "size": 2,
                        "title": "Server details",
                        "timeContextFromParameter": "TimeRange",
                        "showRefreshButton": true,
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspaces}"
                        ],
                        "visualization": "table",
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Id",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Parent",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Name",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "WorkbookTemplate",
                                "workbookContext": {
                                  "componentIdSource": "column",
                                  "componentId": "Title",
                                  "resourceIdsSource": "column",
                                  "resourceIds": "DbId",
                                  "templateIdSource": "static",
                                  "templateId": "Community-Workbooks/Workloads/SQL/SQL Server",
                                  "typeSource": "static",
                                  "type": "workbook",
                                  "gallerySource": "static",
                                  "gallery": "Azure Monitor",
                                  "locationSource": "default"
                                }
                              }
                            },
                            {
                              "columnMatch": "Status",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Offline",
                                    "representation": "critical",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Previously offline",
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Online",
                                    "representation": "Blank",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "No telemetry",
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "unknown",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Online dbs",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "[[[\"Online dbs\"] / [\"Total\"]",
                                  "columnSettings": [
                                    {
                                      "columnName": "Online dbs",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "No telemetry dbs",
                                      "color": "orange"
                                    },
                                    {
                                      "columnName": "Previously unhealthy dbs",
                                      "color": "yellow"
                                    },
                                    {
                                      "columnName": "Currently unhealthy dbs",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "Previously unhealthy dbs",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Currently unhealthy dbs",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Trend",
                              "formatter": 21,
                              "formatOptions": {
                                "min": 0,
                                "palette": "grayBlue"
                              }
                            },
                            {
                              "columnMatch": "DbId",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Title",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "No telemetry dbs",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Server memory",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 3,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false
                                }
                              }
                            },
                            {
                              "columnMatch": "HealthLabel",
                              "formatter": 5
                            }
                          ],
                          "rowLimit": 1000,
                          "hierarchySettings": {
                            "idColumn": "Id",
                            "parentColumn": "Parent",
                            "treeType": 0,
                            "expanderColumn": "Name",
                            "expandTopLevel": true
                          },
                          "labelSettings": [
                            {
                              "columnId": "Online dbs",
                              "label": "Online databases"
                            },
                            {
                              "columnId": "Trend",
                              "label": "Online database trend"
                            },
                            {
                              "columnId": "Type",
                              "label": "Database type"
                            },
                            {
                              "columnId": "Computer",
                              "label": "Monitored by"
                            }
                          ]
                        },
                        "sortBy": [],
                        "tileSettings": {
                          "titleContent": {
                            "columnMatch": "Name",
                            "formatter": 1,
                            "formatOptions": {
                              "showIcon": true
                            }
                          },
                          "leftContent": {
                            "columnMatch": "Value",
                            "formatter": 12,
                            "formatOptions": {
                              "min": 0,
                              "palette": "blue",
                              "showIcon": true
                            },
                            "numberFormat": {
                              "unit": 17,
                              "options": {
                                "style": "decimal",
                                "maximumFractionDigits": 1
                              }
                            }
                          },
                          "secondaryContent": {
                            "columnMatch": "Trend",
                            "formatter": 21,
                            "formatOptions": {
                              "min": 0,
                              "palette": "blue",
                              "showIcon": true
                            }
                          },
                          "showBorder": false
                        },
                        "graphSettings": {
                          "type": 0,
                          "topContent": {
                            "columnMatch": "Id",
                            "formatter": 1
                          },
                          "centerContent": {
                            "columnMatch": "Online dbs",
                            "formatter": 1,
                            "numberFormat": {
                              "unit": 17,
                              "options": {
                                "maximumSignificantDigits": 3,
                                "maximumFractionDigits": 2
                              }
                            }
                          }
                        },
                        "mapSettings": {
                          "locInfo": "LatLong",
                          "sizeSettings": "Online dbs",
                          "sizeAggregation": "Sum",
                          "legendMetric": "Online dbs",
                          "legendAggregation": "Sum",
                          "itemColorSettings": {
                            "type": "heatmap",
                            "colorAggregation": "Sum",
                            "nodeColorField": "Online dbs",
                            "heatmapPalette": "greenRed"
                          }
                        }
                      },
                      "showPin": false,
                      "name": "Server details"
                    }
                  ]
                },
                "conditionalVisibilities": [
                  {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Overview"
                  },
                  {
                    "parameterName": "OnboardedComputerCount",
                    "comparison": "isNotEqualTo",
                    "value": "0"
                  }
                ],
                "name": "Overview"
              }
            ]
          },
          "conditionalVisibilities": [
            {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Overview"
            },
            {
              "parameterName": "Workspaces",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            {
              "parameterName": "OnboardedComputers",
              "comparison": "isNotEqualTo"
            }
          ],
          "name": "Overview",
          "styleSettings": {
            "margin": "15px 0 0 0"
          }
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace =~ 'sqlserver_performance' \r\n| extend Tags = todynamic(Tags)\r\n| extend Name = tostring(Tags.counter), Database = tostring(Tags.instance), Instance = tostring(Tags.sql_instance)\r\n| where Instance in~ ({SqlServers}) and Database == 'Total'\r\n| where Name =~ 'Transactions/sec'\r\n| extend SeriesName = strcat(Instance, '/', Database)\r\n| summarize (StartTime, StartValue) = arg_min(TimeGenerated, Val), (EndTime, EndValue) = arg_max(TimeGenerated, Val) by bin(TimeGenerated, {TimeRange:grain}), SeriesName\r\n| extend Val = iff(EndValue >= StartValue, EndValue - StartValue, real(null))\r\n| make-series Trend = sum(Val) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} by SeriesName",
                  "size": 0,
                  "aggregation": 5,
                  "showAnalytics": true,
                  "title": "Transactions./sec",
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "timechart",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Online",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "minimumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Online trend",
                        "formatter": 21,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "Offline|Recovering|Recovery pending|Restoring|Suspect",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "red",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Server memory",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 4,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "Total storage",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 38,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      }
                    ]
                  },
                  "sortBy": [],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  },
                  "chartSettings": {
                    "createOtherGroup": 0,
                    "showLegend": true,
                    "ySettings": {
                      "numberFormatSettings": {
                        "unit": 31,
                        "options": {
                          "style": "decimal"
                        }
                      }
                    }
                  }
                },
                "showPin": true,
                "name": "Transactions/sec"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace =~ 'sqlserver_performance' \r\n| extend Tags = todynamic(Tags)\r\n| extend Name = tostring(Tags.counter), Database = tostring(Tags.database_name), Instance = tostring(Tags.sql_instance)\r\n| where Instance in~ ({SqlServers})\r\n| where Name =~ 'User connections'\r\n| extend SeriesName = strcat(Instance, '/', Database)\r\n| make-series Trend = sum(Val) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} by SeriesName",
                  "size": 0,
                  "aggregation": 5,
                  "showAnalytics": true,
                  "title": "User connections",
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "timechart",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Online",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "minimumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Online trend",
                        "formatter": 21,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "Offline|Recovering|Recovery pending|Restoring|Suspect",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "red",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Server memory",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 4,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "Total storage",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 38,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      }
                    ]
                  },
                  "sortBy": [],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  },
                  "chartSettings": {
                    "ySettings": {
                      "unit": 17,
                      "min": null,
                      "max": null
                    }
                  }
                },
                "customWidth": "33",
                "showPin": true,
                "name": "User connections"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace =~ 'sqlserver_performance' \r\n| extend Tags = todynamic(Tags)\r\n| extend Name = tostring(Tags.counter), Database = tostring(Tags.database_name), Instance = tostring(Tags.sql_instance)\r\n| where Instance in~ ({SqlServers})\r\n| where Name =~ 'Batch requests/sec'\r\n| extend SeriesName = strcat(Instance, '/', Database)\r\n| summarize (StartTime, StartValue) = arg_min(TimeGenerated, Val), (EndTime, EndValue) = arg_max(TimeGenerated, Val) by bin(TimeGenerated, {TimeRange:grain}), SeriesName\r\n| extend Val = iff(EndValue >= StartValue, EndValue - StartValue, real(null))\r\n| make-series Trend = sum(Val) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} by SeriesName",
                  "size": 0,
                  "aggregation": 5,
                  "showAnalytics": true,
                  "title": "Batch requests/sec",
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "timechart",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Online",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "minimumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Online trend",
                        "formatter": 21,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "Offline|Recovering|Recovery pending|Restoring|Suspect",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "red",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Server memory",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 4,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "Total storage",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 38,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      }
                    ]
                  },
                  "sortBy": [],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  },
                  "chartSettings": {
                    "ySettings": {
                      "unit": 31,
                      "min": null,
                      "max": null
                    }
                  }
                },
                "customWidth": "33",
                "showPin": true,
                "name": "Batch requests per second"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace =~ 'sqlserver_performance' \r\n| extend Tags = todynamic(Tags)\r\n| extend Name = tostring(Tags.counter), Database = tostring(Tags.database_name), Instance = tostring(Tags.sql_instance)\r\n| where Instance in~ ({SqlServers})\r\n| where Name =~ 'SQL compilations/sec'\r\n| extend SeriesName = strcat(Instance, '/', Database)\r\n| summarize (StartTime, StartValue) = arg_min(TimeGenerated, Val), (EndTime, EndValue) = arg_max(TimeGenerated, Val) by bin(TimeGenerated, {TimeRange:grain}), SeriesName\r\n| extend Val = iff(EndValue >= StartValue, EndValue - StartValue, real(null))\r\n| make-series Trend = sum(Val) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} by SeriesName",
                  "size": 0,
                  "aggregation": 5,
                  "showAnalytics": true,
                  "title": "SQL compilations/sec",
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "timechart",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Online",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "minimumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Online trend",
                        "formatter": 21,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "Offline|Recovering|Recovery pending|Restoring|Suspect",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "red",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Server memory",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 4,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "Total storage",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 38,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      }
                    ]
                  },
                  "sortBy": [],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  },
                  "chartSettings": {
                    "ySettings": {
                      "unit": 31,
                      "min": null,
                      "max": null
                    }
                  }
                },
                "customWidth": "33",
                "showPin": true,
                "name": "SQL compilations/sec"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace =~ 'sqlserver_performance' \r\n| extend Tags = todynamic(Tags)\r\n| extend Name = tostring(Tags.counter), Database = tostring(Tags.database_name), Instance = tostring(Tags.sql_instance)\r\n| where Instance in~ ({SqlServers})\r\n| where Name =~ 'SQL re-compilations/sec'\r\n| extend SeriesName = strcat(Instance, '/', Database)\r\n| summarize (StartTime, StartValue) = arg_min(TimeGenerated, Val), (EndTime, EndValue) = arg_max(TimeGenerated, Val) by bin(TimeGenerated, {TimeRange:grain}), SeriesName\r\n| extend Val = iff(EndValue >= StartValue, EndValue - StartValue, real(null))\r\n| make-series Trend = sum(Val) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} by SeriesName",
                  "size": 0,
                  "aggregation": 5,
                  "showAnalytics": true,
                  "title": "SQL re-compilations/sec",
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "timechart",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Online",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "minimumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Online trend",
                        "formatter": 21,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "Offline|Recovering|Recovery pending|Restoring|Suspect",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "red",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Server memory",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 4,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "Total storage",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 38,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      }
                    ]
                  },
                  "sortBy": [],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  },
                  "chartSettings": {
                    "ySettings": {
                      "unit": 31,
                      "min": null,
                      "max": null
                    }
                  }
                },
                "customWidth": "33",
                "showPin": true,
                "name": "SQL re-compilations/sec"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace =~ 'sqlserver_performance' \r\n| extend Tags = todynamic(Tags)\r\n| extend Name = tostring(Tags.counter), Database = tostring(Tags.database_name), Instance = tostring(Tags.sql_instance)\r\n| where Instance in~ ({SqlServers})\r\n| where Name =~ 'Processes blocked'\r\n| extend SeriesName = strcat(Instance, '/', Database)\r\n| summarize (StartTime, StartValue) = arg_min(TimeGenerated, Val), (EndTime, EndValue) = arg_max(TimeGenerated, Val) by bin(TimeGenerated, {TimeRange:grain}), SeriesName\r\n| extend Val = iff(EndValue >= StartValue, EndValue - StartValue, real(null))\r\n| make-series Trend = sum(Val) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} by SeriesName",
                  "size": 0,
                  "aggregation": 5,
                  "showAnalytics": true,
                  "title": "Processes blocked",
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "timechart",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Online",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "minimumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Online trend",
                        "formatter": 21,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "Offline|Recovering|Recovery pending|Restoring|Suspect",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "red",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Server memory",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 4,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "Total storage",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 38,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      }
                    ]
                  },
                  "sortBy": [],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  },
                  "chartSettings": {
                    "ySettings": {
                      "unit": 17,
                      "min": null,
                      "max": null
                    }
                  }
                },
                "customWidth": "33",
                "showPin": true,
                "name": "Processes blocked"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace =~ 'sqlserver_performance' \r\n| extend Tags = todynamic(Tags)\r\n| extend Name = tostring(Tags.counter), Database = tostring(Tags.database_name), Instance = tostring(Tags.sql_instance)\r\n| where Instance in~ ({SqlServers})\r\n| where Name =~ 'Number of deadlocks/sec'\r\n| extend SeriesName = strcat(Instance, '/', Database)\r\n| summarize (StartTime, StartValue) = arg_min(TimeGenerated, Val), (EndTime, EndValue) = arg_max(TimeGenerated, Val) by bin(TimeGenerated, {TimeRange:grain}), SeriesName\r\n| extend Val = iff(EndValue >= StartValue, EndValue - StartValue, real(null))\r\n| make-series Trend = sum(Val) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} by SeriesName",
                  "size": 0,
                  "aggregation": 5,
                  "showAnalytics": true,
                  "title": "Number of deadlocks/sec",
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "timechart",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Online",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "minimumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Online trend",
                        "formatter": 21,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "Offline|Recovering|Recovery pending|Restoring|Suspect",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "red",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Server memory",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 4,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "Total storage",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 38,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      }
                    ]
                  },
                  "sortBy": [],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  },
                  "chartSettings": {
                    "ySettings": {
                      "unit": 31,
                      "min": null,
                      "max": null
                    }
                  }
                },
                "customWidth": "33",
                "showPin": true,
                "name": "Number of deadlocks/sec"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "selectedTab",
            "comparison": "isEqualTo",
            "value": "Activities"
          },
          "name": "Activities"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "let data = InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| extend Tags = todynamic(Tags)\r\n| where Namespace =~ 'sqlserver_performance' \r\n| extend Object = tostring(Tags.object)\r\n| where Object endswith 'availability replica'\r\n| extend Counter = tostring(Tags.counter), Database = tostring(Tags.database_name), Instance = tostring(Tags.instance), SqlInstance = tostring(Tags.sql_instance)\r\n| where SqlInstance in ({SqlServers}) or '*' in ({SqlServers})\r\n| where Instance !~ 'Total';\r\ndata\r\n| summarize (t1, StartValue) = arg_min(TimeGenerated, Val), (t2, EndValue) = arg_max(TimeGenerated, Val) by Database, SqlInstance, Counter, Instance\r\n| project Value = iff(EndValue >= StartValue, EndValue - StartValue, real(null)), Database, SqlInstance, Counter, Instance\r\n| summarize \r\n        SendsToTransportsPerSec = avgif(Value, Counter =~ 'Sends to Transport/sec'),\r\n        SendsToReplicasPerSec = avgif(Value, Counter =~ 'Sends to Replica/sec'),\r\n        ReceivesFromReplicasPerSec = avgif(Value, Counter =~ 'Receives from Replica/sec'),\r\n        ResentMessagesPerSec = avgif(Value, Counter =~ 'Resent Messages/sec'),\r\n        FlowControlPerSec = avgif(Value, Counter =~ 'Flow Control/sec'),\r\n        FlowControlTimeMsPerSec = avgif(Value, Counter =~ 'Flow Control Time (ms/sec)')\r\n    by SqlInstance, Database, Instance",
                  "size": 2,
                  "showAnalytics": true,
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "table",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "SqlInstance",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "Database",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "Instance",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "SendsTo.*|Receives.*",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "blue",
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 11,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "ResentMessagesPerSec",
                        "formatter": 0,
                        "formatOptions": {
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 31,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      {
                        "columnMatch": "FlowControlPerSec",
                        "formatter": 0,
                        "formatOptions": {
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 31,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "FlowControlTimeMsPerSec",
                        "formatter": 0,
                        "formatOptions": {
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 0,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      }
                    ],
                    "rowLimit": 1000,
                    "filter": true,
                    "hierarchySettings": {
                      "treeType": 1,
                      "groupBy": [
                        "SqlInstance"
                      ],
                      "expandTopLevel": true,
                      "finalBy": "Instance"
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_SendsTo.*|Receives.*_4",
                        "sortOrder": 2
                      }
                    ],
                    "labelSettings": [
                      {
                        "columnId": "SqlInstance",
                        "label": "Name"
                      },
                      {
                        "columnId": "Database"
                      },
                      {
                        "columnId": "Instance"
                      },
                      {
                        "columnId": "SendsToTransportsPerSec",
                        "label": "Sends to transports"
                      },
                      {
                        "columnId": "SendsToReplicasPerSec",
                        "label": "Sends to replicas"
                      },
                      {
                        "columnId": "ReceivesFromReplicasPerSec",
                        "label": "Receives from replicas"
                      },
                      {
                        "columnId": "ResentMessagesPerSec",
                        "label": "Resent messages"
                      },
                      {
                        "columnId": "FlowControlPerSec",
                        "label": "Flow control"
                      },
                      {
                        "columnId": "FlowControlTimeMsPerSec",
                        "label": "Flow control time (ms/sec)"
                      }
                    ]
                  },
                  "sortBy": [
                    {
                      "itemKey": "$gen_heatmap_SendsTo.*|Receives.*_4",
                      "sortOrder": 2
                    }
                  ],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  }
                },
                "showPin": true,
                "name": "Replicas"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "selectedTab",
            "comparison": "isEqualTo",
            "value": "Replicas"
          },
          "name": "Replicas"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| extend Tags = todynamic(Tags)\r\n| where Namespace =~ 'sqlserver_performance' and tostring(Tags.object) endswith ':Databases' and tostring(Tags.instance) !~ 'total'\r\n| extend Database = tostring(Tags.database_name), SqlInstance = tostring(Tags.sql_instance), Counter = tostring(Tags.counter), DbInstance = tostring(Tags.instance)\r\n| where SqlInstance in ({SqlServers}) or '*' in ({SqlServers})\r\n| summarize \r\n        DataFilesSize = avgif(Val, Counter == 'Data File(s) Size (KB)'),\r\n        LogFilesSize = avgif(Val, Counter == 'Log File(s) Size (KB)'),\r\n        LogFilesUsedSize = avgif(Val, Counter == 'Log File(s) Used Size (KB)'),\r\n        PercentLogUsed = avgif(Val, Counter == 'Percent Log Used')\r\n    by SqlInstance, DbInstance, DbId = strcat('/workspace/', TenantId, '/computer/', iff(Computer == '', '*', Computer), '/sqlinstance/', SqlInstance, '/database/')\r\n\r\n",
                  "size": 2,
                  "showAnalytics": true,
                  "timeContext": {
                    "durationMs": 14400000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "table",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "$gen_group",
                        "formatter": 1,
                        "formatOptions": {
                          "linkColumn": "DbId",
                          "linkTarget": "WorkbookTemplate",
                          "workbookContext": {
                            "componentIdSource": "workbook",
                            "resourceIdsSource": "column",
                            "resourceIds": "DbId",
                            "templateIdSource": "static",
                            "templateId": "Community-Workbooks/Workloads/SQL/SQL Server",
                            "typeSource": "static",
                            "type": "workbook",
                            "gallerySource": "static",
                            "gallery": "Azure Monitor",
                            "locationSource": "default"
                          }
                        }
                      },
                      {
                        "columnMatch": "SqlInstance",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "DbInstance",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "DbId",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "DataFilesSize|LogFilesSize|LogFilesUsedSize",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "blue",
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 37,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "PercentLogUsed",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "max": 100,
                          "palette": "orange"
                        },
                        "numberFormat": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Database",
                        "formatter": 5
                      }
                    ],
                    "rowLimit": 1000,
                    "filter": true,
                    "hierarchySettings": {
                      "treeType": 1,
                      "groupBy": [
                        "SqlInstance"
                      ],
                      "expandTopLevel": true,
                      "finalBy": "DbInstance"
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_DataFilesSize|LogFilesSize|LogFilesUsedSize_4",
                        "sortOrder": 2
                      }
                    ],
                    "labelSettings": [
                      {
                        "columnId": "SqlInstance",
                        "label": "Name"
                      },
                      {
                        "columnId": "DbInstance",
                        "label": "Name"
                      },
                      {
                        "columnId": "DbId"
                      },
                      {
                        "columnId": "DataFilesSize",
                        "label": "Data file(s) size"
                      },
                      {
                        "columnId": "LogFilesSize",
                        "label": "Log file(s) size"
                      },
                      {
                        "columnId": "LogFilesUsedSize",
                        "label": "Log file(s) used size"
                      },
                      {
                        "columnId": "PercentLogUsed",
                        "label": "Percent log used"
                      }
                    ]
                  },
                  "sortBy": [
                    {
                      "itemKey": "$gen_heatmap_DataFilesSize|LogFilesSize|LogFilesUsedSize_4",
                      "sortOrder": 2
                    }
                  ],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  }
                },
                "showPin": true,
                "name": "Database space"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "selectedTab",
            "comparison": "isEqualTo",
            "value": "Database space"
          },
          "name": "Database space"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| extend Tags = todynamic(Tags)\r\n| where Namespace =~ 'sqlserver_performance' and tostring(Tags.object) endswith ':Databases' and tostring(Tags.instance) !~ 'total'\r\n| extend Database = tostring(Tags.database_name), SqlInstance = tostring(Tags.sql_instance), Counter = tostring(Tags.counter), DbInstance = tostring(Tags.instance)\r\n| where SqlInstance in ({SqlServers}) or '*' in ({SqlServers})\r\n| summarize (Start, StartValue) = arg_min(TimeGenerated, Val), (End, EndValue) = arg_max(TimeGenerated, Val) by Counter, Database, SqlInstance, DbInstance, TenantId, Computer, bin(TimeGenerated, {TimeRange:grain})\r\n| extend Val = iff(EndValue >= StartValue, EndValue - StartValue, real(null))\r\n| summarize \r\n        WriteTransactionsPerSec = avgif(Val, Counter == 'Write Transactions/sec'),\r\n        LogFlushesPerSec = avgif(Val, Counter == 'Log Flushes/sec'),\r\n        LogBytesFlushedPerSec = avgif(Val, Counter == 'Log Bytes Flushed/sec'),\r\n        LogFlushWaitTime = avgif(Val, Counter == 'Log Flush Wait Time')\r\n    by SqlInstance, DbInstance, DbId = strcat('/workspace/', TenantId, '/computer/', iff(Computer == '', '*', Computer), '/sqlinstance/', SqlInstance, '/database/')\r\n\r\n",
                  "size": 2,
                  "showAnalytics": true,
                  "timeContext": {
                    "durationMs": 14400000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "table",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "$gen_group",
                        "formatter": 1,
                        "formatOptions": {
                          "linkColumn": "DbId",
                          "linkTarget": "WorkbookTemplate",
                          "workbookContext": {
                            "componentIdSource": "workbook",
                            "resourceIdsSource": "column",
                            "resourceIds": "DbId",
                            "templateIdSource": "static",
                            "templateId": "Community-Workbooks/Workloads/SQL/SQL Server",
                            "typeSource": "static",
                            "type": "workbook",
                            "gallerySource": "static",
                            "gallery": "Azure Monitor",
                            "locationSource": "default"
                          }
                        },
                        "numberFormat": {
                          "unit": 31,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "SqlInstance",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "DbInstance",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "DbId",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "TransactionsPerSec|WriteTransactionsPerSec",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "blue",
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 31,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "LogFlushesPerSec",
                        "formatter": 0,
                        "formatOptions": {
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 31,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "LogBytesFlushedPerSec",
                        "formatter": 0,
                        "formatOptions": {
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 31,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "LogFlushWaitTime",
                        "formatter": 0,
                        "numberFormat": {
                          "unit": 23,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Database",
                        "formatter": 5
                      }
                    ],
                    "rowLimit": 1000,
                    "filter": true,
                    "hierarchySettings": {
                      "treeType": 1,
                      "groupBy": [
                        "SqlInstance"
                      ],
                      "expandTopLevel": true,
                      "finalBy": "DbInstance"
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_TransactionsPerSec|WriteTransactionsPerSec_4",
                        "sortOrder": 2
                      }
                    ],
                    "labelSettings": [
                      {
                        "columnId": "SqlInstance",
                        "label": "Name"
                      },
                      {
                        "columnId": "DbInstance"
                      },
                      {
                        "columnId": "DbId"
                      },
                      {
                        "columnId": "WriteTransactionsPerSec",
                        "label": "Write transactions/sec"
                      },
                      {
                        "columnId": "LogFlushesPerSec",
                        "label": "Log flushes/sec"
                      },
                      {
                        "columnId": "LogBytesFlushedPerSec",
                        "label": "Log bytes flushed/sec"
                      },
                      {
                        "columnId": "LogFlushWaitTime",
                        "label": "Log flush wait time"
                      }
                    ]
                  },
                  "sortBy": [
                    {
                      "itemKey": "$gen_heatmap_TransactionsPerSec|WriteTransactionsPerSec_4",
                      "sortOrder": 2
                    }
                  ],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  }
                },
                "showPin": true,
                "name": "Transactions"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "selectedTab",
            "comparison": "isEqualTo",
            "value": "Transactions"
          },
          "name": "Transactions"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| extend Tags = todynamic(Tags)\r\n| where Namespace =~ 'sqlserver_database_io'\r\n| extend Database = tostring(Tags.database_name), SqlInstance = tostring(Tags.sql_instance), FileType = tostring(Tags.file_type), FileName = tostring(Tags.logical_filename)\r\n| where SqlInstance in ({SqlServers}) or '*' in ({SqlServers})\r\n| summarize (Start, StartValue) = arg_min(TimeGenerated, Val), (End, EndValue) = arg_max(TimeGenerated, Val) by Name, Database, SqlInstance, FileType, TenantId, Computer, FileName\r\n| extend Val = iff(EndValue >= StartValue, EndValue - StartValue, real(null))\r\n| summarize\r\n        DataReadBytes = sumif(Val, Name == 'read_bytes' and FileType == 'ROWS'),\r\n        DataWriteBytes = sumif(Val, Name == 'write_bytes' and FileType == 'ROWS'),\r\n        DataReadLatency = avgif(Val, Name == 'read_latency_ms' and FileType == 'ROWS'),\r\n        DataWriteLatency = avgif(Val, Name == 'write_latency_ms' and FileType == 'ROWS'),\r\n        LogReadBytes = sumif(Val, Name == 'read_bytes' and FileType == 'LOG'),\r\n        LogWriteBytes = sumif(Val, Name == 'write_bytes' and FileType == 'LOG'),\r\n        LogReadLatency = avgif(Val, Name == 'read_latency_ms' and FileType == 'LOG'),\r\n        LogWriteLatency = avgif(Val, Name == 'write_latency_ms' and FileType == 'LOG')\r\n    by SqlInstance, Database, DbId = strcat('/workspace/', TenantId, '/computer/', iff(Computer == '', '*', Computer), '/sqlinstance/', SqlInstance, '/database/')\r\n",
                  "size": 2,
                  "showAnalytics": true,
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "table",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "$gen_group",
                        "formatter": 1,
                        "formatOptions": {
                          "linkColumn": "DbId",
                          "linkTarget": "WorkbookTemplate",
                          "workbookContext": {
                            "componentIdSource": "workbook",
                            "resourceIdsSource": "column",
                            "resourceIds": "DbId",
                            "templateIdSource": "static",
                            "templateId": "Community-Workbooks/Workloads/SQL/SQL Server",
                            "typeSource": "static",
                            "type": "workbook",
                            "gallerySource": "static",
                            "gallery": "Azure Monitor",
                            "locationSource": "default"
                          }
                        }
                      },
                      {
                        "columnMatch": "SqlInstance",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "Database",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "DbId",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "DataReadBytes|DataWriteBytes",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "blue",
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 2,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "DataReadLatency|DataWriteLatency",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "orange",
                          "aggregation": "Max"
                        },
                        "numberFormat": {
                          "unit": 23,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "LogReadBytes|LogWriteBytes",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "blue",
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 2,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "LogReadLatency|LogWriteLatency",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "orange",
                          "aggregation": "Max"
                        },
                        "numberFormat": {
                          "unit": 23,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      }
                    ],
                    "rowLimit": 1000,
                    "filter": true,
                    "hierarchySettings": {
                      "treeType": 1,
                      "groupBy": [
                        "SqlInstance"
                      ],
                      "expandTopLevel": true,
                      "finalBy": "Database"
                    },
                    "labelSettings": [
                      {
                        "columnId": "SqlInstance",
                        "label": "Name"
                      },
                      {
                        "columnId": "DataReadBytes",
                        "label": "Data read bytes"
                      },
                      {
                        "columnId": "DataWriteBytes",
                        "label": "Data write bytes"
                      },
                      {
                        "columnId": "DataReadLatency",
                        "label": "Data read latency"
                      },
                      {
                        "columnId": "DataWriteLatency",
                        "label": "Data write latency"
                      },
                      {
                        "columnId": "LogReadBytes",
                        "label": "Log read bytes"
                      },
                      {
                        "columnId": "LogWriteBytes",
                        "label": "Log write bytes"
                      },
                      {
                        "columnId": "LogReadLatency",
                        "label": "Log read latency"
                      },
                      {
                        "columnId": "LogWriteLatency",
                        "label": "Log write latency"
                      }
                    ]
                  },
                  "sortBy": [],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  }
                },
                "showPin": true,
                "name": "Database IO"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "selectedTab",
            "comparison": "isEqualTo",
            "value": "Database IO"
          },
          "name": "Database IO"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "parameters": [
                    {
                      "id": "d96a773c-653b-468b-bba0-33925dabe752",
                      "version": "KqlParameterItem/1.0",
                      "name": "Metric",
                      "type": 2,
                      "isRequired": true,
                      "query": "InsightsMetrics\n| extend Tags = todynamic(Tags)\n| extend SqlServer = tostring(Tags.sql_instance)\n| where (Computer in~ ({OnboardedComputers}) or '*' in ({OnboardedComputers}))  \n| where Namespace !in ('sqlserver_performance')\n| where SqlServer in ({SqlServers})\n| summarize by Namespace, Name\n| project value = strcat('| where Namespace == \"', Namespace, '\" and Name == \"', Name, '\"'), label = Name, group = Namespace\n| union (InsightsMetrics\n    | extend Tags = todynamic(Tags)\n    | extend SqlServer = tostring(Tags.sql_instance)\n    | where (Computer in~ ({OnboardedComputers}) or '*' in ({OnboardedComputers}))  \n    | where Namespace =~ 'sqlserver_performance'\n    | where SqlServer in ({SqlServers})\n    | summarize by Namespace, Name, Counter = tostring(todynamic(Tags).counter)\n    | project value = strcat('| where Namespace == \"', Namespace, '\" and Tags.counter == \"', Counter, '\"'), label = Counter, group = \"Sql performance counters\")\n| order by group asc, label asc\n| extend Row = row_number()\n| project value, label, selected = Row == 1, group",
                      "crossComponentResources": [
                        "{Workspaces}"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": [],
                        "showDefault": false
                      },
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "timeContextFromParameter": "TimeRange",
                      "queryType": 0,
                      "resourceType": "microsoft.operationalinsights/workspaces"
                    },
                    {
                      "id": "1e8a0803-aff5-45d4-990a-29923479851b",
                      "version": "KqlParameterItem/1.0",
                      "name": "Aggregation",
                      "type": 2,
                      "isRequired": true,
                      "typeSettings": {
                        "additionalResourceOptions": [],
                        "showDefault": false
                      },
                      "jsonData": "[[[\n    { \"value\":\"avg(Val)\", \"label\":\"Average\", \"selected\":\"true\" },\n    { \"value\":\"sum(Val)\", \"label\":\"Sum\", \"selected\":\"false\" },\n    { \"value\":\"min(Val)\", \"label\":\"Minimum\", \"selected\":\"false\" },\n    { \"value\":\"max(Val)\", \"label\":\"Maximum\", \"selected\":\"false\" },\n    { \"value\":\"count()\", \"label\":\"Count\", \"selected\":\"false\" }\n]",
                      "timeContext": {
                        "durationMs": 0
                      },
                      "timeContextFromParameter": "TimeRange"
                    },
                    {
                      "id": "9b2944ed-09fe-4e36-a535-7e89d28d8c3a",
                      "version": "KqlParameterItem/1.0",
                      "name": "SplitBy",
                      "label": "Split by",
                      "type": 2,
                      "query": "InsightsMetrics\r\n| extend Tags = todynamic(Tags)\r\n| where (Computer in~ ({OnboardedComputers}) or '*' in ({OnboardedComputers}))\r\n{Metric}\r\n| take 10\r\n| project Keys = bag_keys(Tags)\r\n| mvexpand Keys\r\n| summarize by label = tostring(Keys)\r\n| extend value = case(label in ('counter', 'database_name', 'instance', 'object'), strcat('by Split = strcat(Tags[\"sql_instance\"], \"/\", Tags[\"', label, '\"])'), strcat('by Split = tostring(Tags[\"', label, '\"])'))\r\n| project value, label = replace('vm.azm.ms/', '', label), selected = true",
                      "crossComponentResources": [
                        "{Workspaces}"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": [],
                        "showDefault": false
                      },
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "timeContextFromParameter": "TimeRange",
                      "queryType": 0,
                      "resourceType": "microsoft.operationalinsights/workspaces"
                    },
                    {
                      "id": "f6dbed75-a152-4906-a04c-2b9989624538",
                      "version": "KqlParameterItem/1.0",
                      "name": "SplitByValue",
                      "type": 1,
                      "isRequired": true,
                      "isHiddenWhenLocked": true,
                      "criteriaData": [
                        {
                          "criteriaContext": {
                            "leftOperand": "SplitBy",
                            "operator": "isNotNull",
                            "rightValType": "param",
                            "resultValType": "param",
                            "resultVal": "SplitBy"
                          }
                        },
                        {
                          "criteriaContext": {
                            "operator": "Default",
                            "rightValType": "param",
                            "resultValType": "static",
                            "resultVal": "//"
                          }
                        }
                      ],
                      "timeContextFromParameter": "TimeRange"
                    }
                  ],
                  "style": "above",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                "name": "Metric selectors",
                "styleSettings": {
                  "margin": "15px 0 10px 0"
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\n| extend Tags = todynamic(Tags)\n| where (Computer in~ ({OnboardedComputers}) or '*' in ({OnboardedComputers})) \n| where Tags.sql_instance in ({SqlServers}) or '*' in ({SqlServers})\n{Metric}\n| make-series Trend = {Aggregation} default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} {SplitByValue}\n",
                  "size": 0,
                  "aggregation": 3,
                  "showAnalytics": true,
                  "title": "{Metric:label} trend",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "timechart",
                  "chartSettings": {
                    "xSettings": {},
                    "ySettings": {
                      "min": 0
                    }
                  }
                },
                "showPin": true,
                "name": "Metric trend"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "selectedTab",
            "comparison": "isEqualTo",
            "value": "Sql counters"
          },
          "name": "Sql counters"
        },
        {
          "type": 1,
          "content": {
            "json": "   ![alt](https://ehnkw9yknjp.exactdn.com/app/themes/coginiti-sage/resources/svg/Logo=Azure%20SQL%20Server,%20Color=Yes.svg)\r\n![alt](https://azureclidevops2021.blob.core.windows.net/repo/kcloud.png?sp=r&st=2022-01-05T15:45:57Z&se=2099-01-05T23:45:57Z&sv=2020-08-04&sr=b&sig=ycEAnRhZty7qtRadZ3uXYcVeJgQI6XnZ3A%2FsoYYrYpA%3D)"
          },
          "showPin": true,
          "name": "text - 10",
          "styleSettings": {
            "showBorder": true
          }
        },
        {
          "type": 1,
          "content": {
            "json": "## ⏬ Please select \"Customer DB Profile\" below the list\r\n",
            "style": "info"
          },
          "name": "text - 11"
        },
        {
          "type": 9,
          "content": {
            "version": "KqlParameterItem/1.0",
            "parameters": [
              {
                "id": "af2af70b-7ea5-40a0-be60-2d87c0d17ed8",
                "version": "KqlParameterItem/1.0",
                "name": "MonitoringProfile",
                "label": "Customer DB Profile",
                "type": 5,
                "isRequired": true,
                "query": "Resources\r\n| where type =~ 'microsoft.insights/datacollectionrules'\r\n| where name contains \"SMP\" ",
                "crossComponentResources": [
                  "value::all"
                ],
                "typeSettings": {
                  "additionalResourceOptions": [],
                  "showDefault": false
                },
                "timeContext": {
                  "durationMs": 86400000
                },
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources"
              },
              {
                "id": "0cebb139-7c97-434a-b077-07704c77c295",
                "version": "KqlParameterItem/1.0",
                "name": "Associations",
                "type": 2,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{MonitoringProfile}/associations?api-version=2019-11-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"id\",\"columnid\":\"Id\"}]}}]}",
                "value": [
                  "value::all"
                ],
                "isHiddenWhenLocked": true,
                "typeSettings": {
                  "additionalResourceOptions": [
                    "value::all"
                  ],
                  "showDefault": false
                },
                "queryType": 12
              },
              {
                "id": "0a9b1be7-5981-4d35-9b5e-fd7c7f9e80ef",
                "version": "KqlParameterItem/1.0",
                "name": "Workspaces",
                "type": 5,
                "isRequired": true,
                "query": "Resources\n| where id =~ '{MonitoringProfile}'\n| project la = properties.destinations.logAnalytics\n| mvexpand la limit 400\n| project id = tostring (la.workspaceResourceId)\n| project value = id, label = id, selected = true",
                "crossComponentResources": [
                  "value::all"
                ],
                "isHiddenWhenLocked": true,
                "typeSettings": {
                  "additionalResourceOptions": [],
                  "showDefault": false
                },
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources"
              },
              {
                "id": "0b697882-249b-4053-9807-9e654383d2a5",
                "version": "KqlParameterItem/1.0",
                "name": "TimeRange",
                "label": "Time range",
                "type": 4,
                "isRequired": true,
                "value": {
                  "durationMs": 3600000
                },
                "typeSettings": {
                  "selectableValues": [
                    {
                      "durationMs": 300000
                    },
                    {
                      "durationMs": 900000
                    },
                    {
                      "durationMs": 1800000
                    },
                    {
                      "durationMs": 3600000
                    },
                    {
                      "durationMs": 14400000
                    },
                    {
                      "durationMs": 43200000
                    },
                    {
                      "durationMs": 86400000
                    },
                    {
                      "durationMs": 172800000
                    },
                    {
                      "durationMs": 259200000
                    },
                    {
                      "durationMs": 604800000
                    },
                    {
                      "durationMs": 1209600000
                    },
                    {
                      "durationMs": 2419200000
                    },
                    {
                      "durationMs": 2592000000
                    },
                    {
                      "durationMs": 5184000000
                    },
                    {
                      "durationMs": 7776000000
                    }
                  ]
                }
              },
              {
                "id": "c7688036-0080-4174-94ae-51b64b5211d9",
                "version": "KqlParameterItem/1.0",
                "name": "OnboardedComputers",
                "type": 5,
                "isRequired": true,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "query": "Resources\r\n| take 1\r\n| project associations = dynamic([{Associations}])\r\n| mvexpand associations limit 400\r\n| project id = tolower(extract(@'(?i)/subscriptions/.+/resourcegroups/.+/providers/microsoft.compute/virtualmachines/(.+)/providers/microsoft.insights/datacollectionruleassociations/.+', 1, tostring(associations)))\r\n| project value = id, label = id, selected = true\r\n\r\n",
                "crossComponentResources": [
                  "value::all"
                ],
                "isHiddenWhenLocked": true,
                "typeSettings": {
                  "additionalResourceOptions": [],
                  "showDefault": false
                },
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources"
              },
              {
                "id": "594fa1c4-5b3a-463e-a729-8ac227d61c64",
                "version": "KqlParameterItem/1.0",
                "name": "SqlType",
                "type": 1,
                "isRequired": true,
                "value": "SQL Server instances",
                "isHiddenWhenLocked": true
              },
              {
                "id": "65e627f5-fc41-41cf-aaf3-c1b31ba2e01d",
                "version": "KqlParameterItem/1.0",
                "name": "SqlServers",
                "label": "Servers",
                "type": 2,
                "isRequired": true,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace contains 'sqlserver_server_properties' and Name == 'engine_edition'\r\n| extend Tags = todynamic(Tags)\r\n| extend Database = tostring(Tags.database_name), Instance = tostring(Tags.sql_instance)\r\n| where ('{SqlType}' == 'Databases' and Val == 5) or \r\n    ('{SqlType}'  == 'Instances' and Val == 8) or\r\n    ('{SqlType}'  == 'SQL Server instances' and Val in (1, 2, 3, 4))\r\n| summarize by Instance\r\n| project value = Instance, label = Instance, selected = true",
                "crossComponentResources": [
                  "{Workspaces}"
                ],
                "typeSettings": {
                  "additionalResourceOptions": [
                    "value::all"
                  ],
                  "showDefault": false
                },
                "timeContext": {
                  "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "value": [
                  "value::all"
                ]
              }
            ],
            "style": "above",
            "queryType": 0,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          "customWidth": "0",
          "name": "parameters - 0",
          "styleSettings": {
            "margin": "15px 0 0 0"
          }
        },
        {
          "type": 11,
          "content": {
            "version": "LinkItem/1.0",
            "style": "tabs",
            "links": [
              {
                "id": "37f0d44c-c4f4-44e6-ad23-63ddfdfe6386",
                "cellValue": "selectedTab",
                "linkTarget": "parameter",
                "linkLabel": "Overview",
                "subTarget": "Overview",
                "style": "link"
              },
              {
                "id": "552fee76-401d-4342-84d0-b5fb1354a5e4",
                "cellValue": "selectedTab",
                "linkTarget": "parameter",
                "linkLabel": "Activities",
                "subTarget": "Activities",
                "style": "link"
              },
              {
                "id": "4869d2b3-eec8-4c5f-9b40-c861ba79c853",
                "cellValue": "selectedTab",
                "linkTarget": "parameter",
                "linkLabel": "Replicas",
                "subTarget": "Replicas",
                "style": "link"
              },
              {
                "id": "5546a076-3427-4bf3-8c44-a3be9a1c39d0",
                "cellValue": "selectedTab",
                "linkTarget": "parameter",
                "linkLabel": "Database space",
                "subTarget": "Database space",
                "style": "link"
              },
              {
                "id": "5473b66e-5f55-48a3-9b1f-86a1eb2d625e",
                "cellValue": "selectedTab",
                "linkTarget": "parameter",
                "linkLabel": "Transactions",
                "subTarget": "Transactions",
                "style": "link"
              },
              {
                "id": "51bcef84-f9a7-4936-98cd-6f9c10412a52",
                "cellValue": "selectedTab",
                "linkTarget": "parameter",
                "linkLabel": "Database IO",
                "subTarget": "Database IO",
                "style": "link"
              },
              {
                "id": "fb8074f5-1109-44a3-ab3b-9c95eb768b68",
                "cellValue": "selectedTab",
                "linkTarget": "parameter",
                "linkLabel": "Explore metrics",
                "subTarget": "Sql counters",
                "style": "link"
              }
            ]
          },
          "name": "links - 3",
          "styleSettings": {
            "margin": "15px 0 0 0"
          }
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "Please select an existing SQL monitoring profile or create a new one using the `Create new profile` button.",
                  "style": "warning"
                },
                "conditionalVisibility": {
                  "parameterName": "MonitoringProfile",
                  "comparison": "isEqualTo"
                },
                "name": "text - 0",
                "styleSettings": {
                  "margin": "20px 0 0 0"
                }
              },
              {
                "type": 1,
                "content": {
                  "json": "Looks like you don't have any monitoring virtual machines associated with this profile. Please associate one or more from the `Manage profile` tab.",
                  "style": "warning"
                },
                "conditionalVisibilities": [
                  {
                    "parameterName": "MonitoringProfile",
                    "comparison": "isNotEqualTo"
                  },
                  {
                    "parameterName": "OnboardedComputers",
                    "comparison": "isEqualTo"
                  }
                ],
                "name": "text - 0 - Copy",
                "styleSettings": {
                  "margin": "20px 0 0 0"
                }
              }
            ]
          },
          "conditionalVisibilities": [
            {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Overview"
            },
            {
              "parameterName": "OnboardedComputers",
              "comparison": "isEqualTo",
              "value": ""
            }
          ],
          "name": "Onboarding message"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "let data = InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace contains 'sqlserver_server_properties'\r\n| extend Tags = todynamic(Tags)\r\n| extend Database = tostring(Tags.database_name), Instance = tostring(Tags.sql_instance)\r\n| extend DatabaseKey = iff(Database == Instance, Database, strcat(Database, ' on ', Instance))\r\n| where Instance in~ ({SqlServers});\r\ndata\r\n| summarize (LastTimestamp, Val) = arg_max(TimeGenerated, Val) by Name, Database, Instance, Computer\r\n| extend Val = iff(LastTimestamp < now() - 10m and Name != 'engine_edition', 0.0, Val)\r\n| summarize CurrentOnline = sumif(Val, Name == 'db_online'),\r\n    CurrentUnhealthy = sumif(Val, Name in~ ('db_offline', 'db_recovering', 'db_recoveryPending', 'db_restoring', 'db_suspect')),\r\n    EngineEdition = sumif(Val, Name == 'engine_edition')\r\n  by Database, Instance, Computer\r\n| extend CurrentOnline = iff(EngineEdition == 5 and CurrentOnline > 0, 1.0, CurrentOnline)\r\n| extend Key = strcat(Computer, '/', Instance, '/', Database)\r\n| join kind = inner (data\r\n    | summarize OverallOnline = minif(Val, Name == 'db_online'),\r\n                OverallUnhealthy = maxif(Val, Name in~ ('db_offline', 'db_recovering', 'db_recoveryPending', 'db_restoring', 'db_suspect')),\r\n                EngineEdition = sumif(Val, Name == 'engine_edition')\r\n    by Key = strcat(Computer, '/', Instance, '/', Database)\r\n) on Key\r\n| extend CurrentOnline = iff(EngineEdition == 5 and CurrentOnline > 0, 1.0, CurrentOnline), OverallOnline = iff(EngineEdition == 5 and OverallOnline > 0, 1.0, OverallOnline)\r\n| project-away Key, Key1, EngineEdition1\r\n| extend Type = case(\r\n            EngineEdition == 1, 'SQL Server Personal',\r\n            EngineEdition == 2, 'SQL Server Standard',\r\n            EngineEdition == 3, 'SQL Server Enterprise',\r\n            EngineEdition == 4, 'SQL Server Express',\r\n            EngineEdition == 5, 'Azure SQL Database ',\r\n            EngineEdition == 6, 'Microsoft Azure Synapse Analytics',\r\n            EngineEdition == 8, 'Instance',\r\n            EngineEdition == 9, 'Azure SQL Edge',\r\n            EngineEdition == 20, 'Azure Logical SQL Server',\r\n            '-')\r\n| project Database = strcat(Instance, '/', Database), Green = CurrentOnline, Yellow = OverallUnhealthy - CurrentUnhealthy, Red = CurrentUnhealthy, Total = CurrentOnline + CurrentUnhealthy, Gray = iff(OverallOnline == CurrentOnline, 0.0, OverallOnline + OverallUnhealthy - CurrentOnline - CurrentUnhealthy), Type, Computer\r\n| summarize ['Online dbs'] = sum(Green), ['Previously unhealthy dbs'] = sum(Yellow), ['Currently unhealthy dbs'] = sum(Red), [\"No telemetry dbs\"] = sum(Gray), Total = sum(Total) by Type\r\n| extend Subtitle = '━━━'\r\n| order by ['Currently unhealthy dbs'] desc, [\"No telemetry dbs\"] desc, ['Previously unhealthy dbs'] desc, ['Online dbs'] desc\r\n",
                        "size": 4,
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspaces}"
                        ],
                        "visualization": "tiles",
                        "sortBy": [],
                        "tileSettings": {
                          "titleContent": {
                            "columnMatch": "Type",
                            "formatter": 1
                          },
                          "subtitleContent": {
                            "columnMatch": "Subtitle",
                            "formatter": 1
                          },
                          "leftContent": {
                            "columnMatch": "Green",
                            "formatter": 22,
                            "formatOptions": {
                              "compositeBarSettings": {
                                "labelText": "[\"Online dbs\"] / [\"Total\"] dbs are online",
                                "columnSettings": [
                                  {
                                    "columnName": "Online dbs",
                                    "color": "green"
                                  },
                                  {
                                    "columnName": "No telemetry dbs",
                                    "color": "orange"
                                  },
                                  {
                                    "columnName": "Previously unhealthy dbs",
                                    "color": "yellow"
                                  },
                                  {
                                    "columnName": "Currently unhealthy dbs",
                                    "color": "redBright"
                                  }
                                ]
                              }
                            },
                            "numberFormat": {
                              "unit": 17,
                              "options": {
                                "style": "decimal",
                                "useGrouping": false,
                                "maximumFractionDigits": 1
                              }
                            }
                          },
                          "secondaryContent": {
                            "columnMatch": "Trend",
                            "formatter": 21,
                            "formatOptions": {
                              "min": 0,
                              "palette": "blue"
                            }
                          },
                          "showBorder": false
                        }
                      },
                      "name": "query - 0"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "let data = InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace contains 'sqlserver_server_properties'\r\n| extend Tags = todynamic(Tags)\r\n| extend Database = tostring(Tags.database_name), Instance = tostring(Tags.sql_instance)\r\n| extend DatabaseKey = iff(Database == Instance, Database, strcat(Database, ' on ', Instance))\r\n| where Instance in~ ({SqlServers});\r\nlet results = data\r\n| summarize (LastTimestamp, Val) = arg_max(TimeGenerated, Val) by Name, Database, Instance, Computer, TenantId\r\n| extend Val = iff(LastTimestamp < now() - 10m and Name != 'engine_edition', 0.0, Val)\r\n| summarize CurrentOnline = sumif(Val, Name == 'db_online'),\r\n    CurrentUnhealthy = sumif(Val, Name in~ ('db_offline', 'db_recovering', 'db_recoveryPending', 'db_restoring', 'db_suspect')),\r\n    EngineEdition = sumif(Val, Name == 'engine_edition')\r\n  by Database, Instance, Computer, TenantId\r\n| extend CurrentOnline = iff(EngineEdition == 5 and CurrentOnline > 0, 1.0, CurrentOnline)\r\n| extend Key = strcat(Computer, '/', Instance, '/', Database)\r\n| join kind = inner (data\r\n    | summarize OverallOnline = minif(Val, Name == 'db_online'),\r\n                OverallUnhealthy = maxif(Val, Name in~ ('db_offline', 'db_recovering', 'db_recoveryPending', 'db_restoring', 'db_suspect')),\r\n                EngineEdition = sumif(Val, Name == 'engine_edition')\r\n    by Key = strcat(Computer, '/', Instance, '/', Database)\r\n) on Key\r\n| extend CurrentOnline = iff(EngineEdition == 5 and CurrentOnline > 0, 1.0, CurrentOnline), OverallOnline = iff(EngineEdition == 5 and OverallOnline > 0, 1.0, OverallOnline)\r\n;\r\nresults\r\n| where EngineEdition == 5\r\n| summarize \r\n        CurrentOnline = sum(CurrentOnline),\r\n        CurrentUnhealthy = sum(CurrentUnhealthy),\r\n        OverallUnhealthy = sum(OverallUnhealthy),\r\n        OverallOnline = sum(OverallOnline)\r\n    by Id = Instance, Parent = '', Name = Instance, key = Instance, Instance, TenantId, Database = '*'\r\n| extend EngineEdition = 20.0\r\n| union (results\r\n    | where EngineEdition == 5\r\n    | project Id = strcat(Computer, '/', Instance, '/', Database), Parent = Instance, Name = Database, CurrentOnline, CurrentUnhealthy, OverallOnline, OverallUnhealthy, EngineEdition, Computer, Instance, Database, TenantId\r\n    | extend key = Id)\r\n| union (results\r\n    | where EngineEdition != 5\r\n    | project Id = strcat(Computer, '/', Instance), Parent = '', Name = Instance, CurrentOnline, CurrentUnhealthy, OverallOnline, OverallUnhealthy, EngineEdition, Computer, key = strcat(Computer, '/', Instance, '/', Database), Instance, Database, TenantId)\r\n| join kind = inner (\r\ndata\r\n    | where Name in~ ('db_online', 'engine_edition')\r\n    | summarize Online = minif(Val, Name == 'db_online'),\r\n                EngineEdition = maxif(Val, Name == 'engine_edition')\r\n            by Database, Instance, Computer, bin(TimeGenerated, {TimeRange:grain})\r\n    | extend Online = iff(EngineEdition == 5, 1.0, Online)\r\n    | make-series Trend = min(Online) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} by key = strcat(Computer, '/', Instance, '/', Database)\r\n| union (\r\ndata\r\n    | where Name in~ ('db_online', 'engine_edition')\r\n    | summarize Online = minif(Val, Name == 'db_online'),\r\n                EngineEdition = maxif(Val, Name == 'engine_edition')\r\n            by Database, Instance, Computer, bin(TimeGenerated, {TimeRange:grain})\r\n    | where EngineEdition == 5\r\n    | extend Online = iff(EngineEdition == 5, 1.0, Online)\r\n    | make-series Trend = sum(Online) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} by key = Instance\r\n)\r\n) on key\r\n| extend Type = case(\r\n            EngineEdition == 1, 'SQL Server Personal',\r\n            EngineEdition == 2, 'SQL Server Standard',\r\n            EngineEdition == 3, 'SQL Server Enterprise',\r\n            EngineEdition == 4, 'SQL Server Express',\r\n            EngineEdition == 5, 'Azure SQL Database ',\r\n            EngineEdition == 6, 'Microsoft Azure Synapse Analytics',\r\n            EngineEdition == 8, 'Azure Managed Instance',\r\n            EngineEdition == 9, 'Azure SQL Edge',\r\n            EngineEdition == 20, 'Azure Logical SQL Server',            '-')\r\n| project Id, Parent, Name, Status = case(CurrentUnhealthy > 0, 'Offline', CurrentOnline + CurrentUnhealthy < OverallOnline + OverallUnhealthy, 'No telemetry', OverallUnhealthy - CurrentUnhealthy > 0, 'Previously offline', OverallUnhealthy == 0, 'Online', ''), ['Online dbs'] = CurrentOnline, ['Previously unhealthy dbs'] = OverallUnhealthy - CurrentUnhealthy, ['Currently unhealthy dbs'] = CurrentUnhealthy, Total = CurrentOnline + CurrentUnhealthy, Trend, Type, Computer, DbId = strcat('/workspace/', TenantId, '/computer/', iff(Computer == '', '*', Computer), '/sqlinstance/', Instance, '/database/', Database), Title = strcat(Type, ' > ', iff(EngineEdition == 5, strcat(Instance, '/', Database), Instance)), [\"No telemetry dbs\"] =  iff(OverallOnline == CurrentOnline, 0.0, OverallOnline + OverallUnhealthy - CurrentOnline - CurrentUnhealthy)\r\n| order by ['Currently unhealthy dbs'] desc, [\"No telemetry dbs\"] desc, ['Previously unhealthy dbs'] desc, ['Online dbs'] desc, Name asc, Computer asc",
                        "size": 2,
                        "title": "Server details",
                        "timeContextFromParameter": "TimeRange",
                        "showRefreshButton": true,
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspaces}"
                        ],
                        "visualization": "table",
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Id",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Parent",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Name",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "WorkbookTemplate",
                                "workbookContext": {
                                  "componentIdSource": "column",
                                  "componentId": "Title",
                                  "resourceIdsSource": "column",
                                  "resourceIds": "DbId",
                                  "templateIdSource": "static",
                                  "templateId": "Community-Workbooks/Workloads/SQL/SQL Server",
                                  "typeSource": "static",
                                  "type": "workbook",
                                  "gallerySource": "static",
                                  "gallery": "Azure Monitor",
                                  "locationSource": "default"
                                }
                              }
                            },
                            {
                              "columnMatch": "Status",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Offline",
                                    "representation": "critical",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Previously offline",
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Online",
                                    "representation": "Blank",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "No telemetry",
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "unknown",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Online dbs",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "[[[\"Online dbs\"] / [\"Total\"]",
                                  "columnSettings": [
                                    {
                                      "columnName": "Online dbs",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "No telemetry dbs",
                                      "color": "orange"
                                    },
                                    {
                                      "columnName": "Previously unhealthy dbs",
                                      "color": "yellow"
                                    },
                                    {
                                      "columnName": "Currently unhealthy dbs",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "Previously unhealthy dbs",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Currently unhealthy dbs",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Trend",
                              "formatter": 21,
                              "formatOptions": {
                                "min": 0,
                                "palette": "grayBlue"
                              }
                            },
                            {
                              "columnMatch": "DbId",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Title",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "No telemetry dbs",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Server memory",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 3,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false
                                }
                              }
                            },
                            {
                              "columnMatch": "HealthLabel",
                              "formatter": 5
                            }
                          ],
                          "rowLimit": 1000,
                          "hierarchySettings": {
                            "idColumn": "Id",
                            "parentColumn": "Parent",
                            "treeType": 0,
                            "expanderColumn": "Name",
                            "expandTopLevel": true
                          },
                          "labelSettings": [
                            {
                              "columnId": "Online dbs",
                              "label": "Online databases"
                            },
                            {
                              "columnId": "Trend",
                              "label": "Online database trend"
                            },
                            {
                              "columnId": "Type",
                              "label": "Database type"
                            },
                            {
                              "columnId": "Computer",
                              "label": "Monitored by"
                            }
                          ]
                        },
                        "sortBy": [],
                        "tileSettings": {
                          "titleContent": {
                            "columnMatch": "Name",
                            "formatter": 1,
                            "formatOptions": {
                              "showIcon": true
                            }
                          },
                          "leftContent": {
                            "columnMatch": "Value",
                            "formatter": 12,
                            "formatOptions": {
                              "min": 0,
                              "palette": "blue",
                              "showIcon": true
                            },
                            "numberFormat": {
                              "unit": 17,
                              "options": {
                                "style": "decimal",
                                "maximumFractionDigits": 1
                              }
                            }
                          },
                          "secondaryContent": {
                            "columnMatch": "Trend",
                            "formatter": 21,
                            "formatOptions": {
                              "min": 0,
                              "palette": "blue",
                              "showIcon": true
                            }
                          },
                          "showBorder": false
                        },
                        "graphSettings": {
                          "type": 0,
                          "topContent": {
                            "columnMatch": "Id",
                            "formatter": 1
                          },
                          "centerContent": {
                            "columnMatch": "Online dbs",
                            "formatter": 1,
                            "numberFormat": {
                              "unit": 17,
                              "options": {
                                "maximumSignificantDigits": 3,
                                "maximumFractionDigits": 2
                              }
                            }
                          }
                        },
                        "mapSettings": {
                          "locInfo": "LatLong",
                          "sizeSettings": "Online dbs",
                          "sizeAggregation": "Sum",
                          "legendMetric": "Online dbs",
                          "legendAggregation": "Sum",
                          "itemColorSettings": {
                            "type": "heatmap",
                            "colorAggregation": "Sum",
                            "nodeColorField": "Online dbs",
                            "heatmapPalette": "greenRed"
                          }
                        }
                      },
                      "showPin": false,
                      "name": "Server details"
                    }
                  ]
                },
                "conditionalVisibilities": [
                  {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Overview"
                  },
                  {
                    "parameterName": "OnboardedComputerCount",
                    "comparison": "isNotEqualTo",
                    "value": "0"
                  }
                ],
                "name": "Overview"
              }
            ]
          },
          "conditionalVisibilities": [
            {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Overview"
            },
            {
              "parameterName": "Workspaces",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            {
              "parameterName": "OnboardedComputers",
              "comparison": "isNotEqualTo"
            }
          ],
          "name": "Overview",
          "styleSettings": {
            "margin": "15px 0 0 0"
          }
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace =~ 'sqlserver_performance' \r\n| extend Tags = todynamic(Tags)\r\n| extend Name = tostring(Tags.counter), Database = tostring(Tags.instance), Instance = tostring(Tags.sql_instance)\r\n| where Instance in~ ({SqlServers}) and Database == 'Total'\r\n| where Name =~ 'Transactions/sec'\r\n| extend SeriesName = strcat(Instance, '/', Database)\r\n| summarize (StartTime, StartValue) = arg_min(TimeGenerated, Val), (EndTime, EndValue) = arg_max(TimeGenerated, Val) by bin(TimeGenerated, {TimeRange:grain}), SeriesName\r\n| extend Val = iff(EndValue >= StartValue, EndValue - StartValue, real(null))\r\n| make-series Trend = sum(Val) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} by SeriesName",
                  "size": 0,
                  "aggregation": 5,
                  "showAnalytics": true,
                  "title": "Transactions./sec",
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "timechart",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Online",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "minimumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Online trend",
                        "formatter": 21,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "Offline|Recovering|Recovery pending|Restoring|Suspect",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "red",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Server memory",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 4,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "Total storage",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 38,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      }
                    ]
                  },
                  "sortBy": [],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  },
                  "chartSettings": {
                    "createOtherGroup": 0,
                    "showLegend": true,
                    "ySettings": {
                      "numberFormatSettings": {
                        "unit": 31,
                        "options": {
                          "style": "decimal"
                        }
                      }
                    }
                  }
                },
                "showPin": true,
                "name": "Transactions/sec"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace =~ 'sqlserver_performance' \r\n| extend Tags = todynamic(Tags)\r\n| extend Name = tostring(Tags.counter), Database = tostring(Tags.database_name), Instance = tostring(Tags.sql_instance)\r\n| where Instance in~ ({SqlServers})\r\n| where Name =~ 'User connections'\r\n| extend SeriesName = strcat(Instance, '/', Database)\r\n| make-series Trend = sum(Val) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} by SeriesName",
                  "size": 0,
                  "aggregation": 5,
                  "showAnalytics": true,
                  "title": "User connections",
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "timechart",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Online",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "minimumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Online trend",
                        "formatter": 21,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "Offline|Recovering|Recovery pending|Restoring|Suspect",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "red",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Server memory",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 4,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "Total storage",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 38,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      }
                    ]
                  },
                  "sortBy": [],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  },
                  "chartSettings": {
                    "ySettings": {
                      "unit": 17,
                      "min": null,
                      "max": null
                    }
                  }
                },
                "customWidth": "33",
                "showPin": true,
                "name": "User connections"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace =~ 'sqlserver_performance' \r\n| extend Tags = todynamic(Tags)\r\n| extend Name = tostring(Tags.counter), Database = tostring(Tags.database_name), Instance = tostring(Tags.sql_instance)\r\n| where Instance in~ ({SqlServers})\r\n| where Name =~ 'Batch requests/sec'\r\n| extend SeriesName = strcat(Instance, '/', Database)\r\n| summarize (StartTime, StartValue) = arg_min(TimeGenerated, Val), (EndTime, EndValue) = arg_max(TimeGenerated, Val) by bin(TimeGenerated, {TimeRange:grain}), SeriesName\r\n| extend Val = iff(EndValue >= StartValue, EndValue - StartValue, real(null))\r\n| make-series Trend = sum(Val) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} by SeriesName",
                  "size": 0,
                  "aggregation": 5,
                  "showAnalytics": true,
                  "title": "Batch requests/sec",
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "timechart",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Online",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "minimumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Online trend",
                        "formatter": 21,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "Offline|Recovering|Recovery pending|Restoring|Suspect",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "red",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Server memory",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 4,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "Total storage",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 38,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      }
                    ]
                  },
                  "sortBy": [],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  },
                  "chartSettings": {
                    "ySettings": {
                      "unit": 31,
                      "min": null,
                      "max": null
                    }
                  }
                },
                "customWidth": "33",
                "showPin": true,
                "name": "Batch requests per second"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace =~ 'sqlserver_performance' \r\n| extend Tags = todynamic(Tags)\r\n| extend Name = tostring(Tags.counter), Database = tostring(Tags.database_name), Instance = tostring(Tags.sql_instance)\r\n| where Instance in~ ({SqlServers})\r\n| where Name =~ 'SQL compilations/sec'\r\n| extend SeriesName = strcat(Instance, '/', Database)\r\n| summarize (StartTime, StartValue) = arg_min(TimeGenerated, Val), (EndTime, EndValue) = arg_max(TimeGenerated, Val) by bin(TimeGenerated, {TimeRange:grain}), SeriesName\r\n| extend Val = iff(EndValue >= StartValue, EndValue - StartValue, real(null))\r\n| make-series Trend = sum(Val) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} by SeriesName",
                  "size": 0,
                  "aggregation": 5,
                  "showAnalytics": true,
                  "title": "SQL compilations/sec",
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "timechart",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Online",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "minimumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Online trend",
                        "formatter": 21,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "Offline|Recovering|Recovery pending|Restoring|Suspect",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "red",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Server memory",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 4,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "Total storage",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 38,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      }
                    ]
                  },
                  "sortBy": [],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  },
                  "chartSettings": {
                    "ySettings": {
                      "unit": 31,
                      "min": null,
                      "max": null
                    }
                  }
                },
                "customWidth": "33",
                "showPin": true,
                "name": "SQL compilations/sec"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace =~ 'sqlserver_performance' \r\n| extend Tags = todynamic(Tags)\r\n| extend Name = tostring(Tags.counter), Database = tostring(Tags.database_name), Instance = tostring(Tags.sql_instance)\r\n| where Instance in~ ({SqlServers})\r\n| where Name =~ 'SQL re-compilations/sec'\r\n| extend SeriesName = strcat(Instance, '/', Database)\r\n| summarize (StartTime, StartValue) = arg_min(TimeGenerated, Val), (EndTime, EndValue) = arg_max(TimeGenerated, Val) by bin(TimeGenerated, {TimeRange:grain}), SeriesName\r\n| extend Val = iff(EndValue >= StartValue, EndValue - StartValue, real(null))\r\n| make-series Trend = sum(Val) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} by SeriesName",
                  "size": 0,
                  "aggregation": 5,
                  "showAnalytics": true,
                  "title": "SQL re-compilations/sec",
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "timechart",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Online",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "minimumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Online trend",
                        "formatter": 21,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "Offline|Recovering|Recovery pending|Restoring|Suspect",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "red",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Server memory",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 4,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "Total storage",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 38,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      }
                    ]
                  },
                  "sortBy": [],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  },
                  "chartSettings": {
                    "ySettings": {
                      "unit": 31,
                      "min": null,
                      "max": null
                    }
                  }
                },
                "customWidth": "33",
                "showPin": true,
                "name": "SQL re-compilations/sec"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace =~ 'sqlserver_performance' \r\n| extend Tags = todynamic(Tags)\r\n| extend Name = tostring(Tags.counter), Database = tostring(Tags.database_name), Instance = tostring(Tags.sql_instance)\r\n| where Instance in~ ({SqlServers})\r\n| where Name =~ 'Processes blocked'\r\n| extend SeriesName = strcat(Instance, '/', Database)\r\n| summarize (StartTime, StartValue) = arg_min(TimeGenerated, Val), (EndTime, EndValue) = arg_max(TimeGenerated, Val) by bin(TimeGenerated, {TimeRange:grain}), SeriesName\r\n| extend Val = iff(EndValue >= StartValue, EndValue - StartValue, real(null))\r\n| make-series Trend = sum(Val) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} by SeriesName",
                  "size": 0,
                  "aggregation": 5,
                  "showAnalytics": true,
                  "title": "Processes blocked",
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "timechart",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Online",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "minimumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Online trend",
                        "formatter": 21,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "Offline|Recovering|Recovery pending|Restoring|Suspect",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "red",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Server memory",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 4,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "Total storage",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 38,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      }
                    ]
                  },
                  "sortBy": [],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  },
                  "chartSettings": {
                    "ySettings": {
                      "unit": 17,
                      "min": null,
                      "max": null
                    }
                  }
                },
                "customWidth": "33",
                "showPin": true,
                "name": "Processes blocked"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| where Namespace =~ 'sqlserver_performance' \r\n| extend Tags = todynamic(Tags)\r\n| extend Name = tostring(Tags.counter), Database = tostring(Tags.database_name), Instance = tostring(Tags.sql_instance)\r\n| where Instance in~ ({SqlServers})\r\n| where Name =~ 'Number of deadlocks/sec'\r\n| extend SeriesName = strcat(Instance, '/', Database)\r\n| summarize (StartTime, StartValue) = arg_min(TimeGenerated, Val), (EndTime, EndValue) = arg_max(TimeGenerated, Val) by bin(TimeGenerated, {TimeRange:grain}), SeriesName\r\n| extend Val = iff(EndValue >= StartValue, EndValue - StartValue, real(null))\r\n| make-series Trend = sum(Val) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} by SeriesName",
                  "size": 0,
                  "aggregation": 5,
                  "showAnalytics": true,
                  "title": "Number of deadlocks/sec",
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "timechart",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Online",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "minimumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Online trend",
                        "formatter": 21,
                        "formatOptions": {
                          "min": 0,
                          "palette": "green",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "Offline|Recovering|Recovery pending|Restoring|Suspect",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "red",
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumSignificantDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Server memory",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 4,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      {
                        "columnMatch": "Total storage",
                        "formatter": 0,
                        "formatOptions": {
                          "showIcon": true
                        },
                        "numberFormat": {
                          "unit": 38,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      }
                    ]
                  },
                  "sortBy": [],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  },
                  "chartSettings": {
                    "ySettings": {
                      "unit": 31,
                      "min": null,
                      "max": null
                    }
                  }
                },
                "customWidth": "33",
                "showPin": true,
                "name": "Number of deadlocks/sec"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "selectedTab",
            "comparison": "isEqualTo",
            "value": "Activities"
          },
          "name": "Activities"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "let data = InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| extend Tags = todynamic(Tags)\r\n| where Namespace =~ 'sqlserver_performance' \r\n| extend Object = tostring(Tags.object)\r\n| where Object endswith 'availability replica'\r\n| extend Counter = tostring(Tags.counter), Database = tostring(Tags.database_name), Instance = tostring(Tags.instance), SqlInstance = tostring(Tags.sql_instance)\r\n| where SqlInstance in ({SqlServers}) or '*' in ({SqlServers})\r\n| where Instance !~ 'Total';\r\ndata\r\n| summarize (t1, StartValue) = arg_min(TimeGenerated, Val), (t2, EndValue) = arg_max(TimeGenerated, Val) by Database, SqlInstance, Counter, Instance\r\n| project Value = iff(EndValue >= StartValue, EndValue - StartValue, real(null)), Database, SqlInstance, Counter, Instance\r\n| summarize \r\n        SendsToTransportsPerSec = avgif(Value, Counter =~ 'Sends to Transport/sec'),\r\n        SendsToReplicasPerSec = avgif(Value, Counter =~ 'Sends to Replica/sec'),\r\n        ReceivesFromReplicasPerSec = avgif(Value, Counter =~ 'Receives from Replica/sec'),\r\n        ResentMessagesPerSec = avgif(Value, Counter =~ 'Resent Messages/sec'),\r\n        FlowControlPerSec = avgif(Value, Counter =~ 'Flow Control/sec'),\r\n        FlowControlTimeMsPerSec = avgif(Value, Counter =~ 'Flow Control Time (ms/sec)')\r\n    by SqlInstance, Database, Instance",
                  "size": 2,
                  "showAnalytics": true,
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "table",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "SqlInstance",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "Database",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "Instance",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "SendsTo.*|Receives.*",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "blue",
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 11,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "ResentMessagesPerSec",
                        "formatter": 0,
                        "formatOptions": {
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 31,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      {
                        "columnMatch": "FlowControlPerSec",
                        "formatter": 0,
                        "formatOptions": {
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 31,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "FlowControlTimeMsPerSec",
                        "formatter": 0,
                        "formatOptions": {
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 0,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      }
                    ],
                    "rowLimit": 1000,
                    "filter": true,
                    "hierarchySettings": {
                      "treeType": 1,
                      "groupBy": [
                        "SqlInstance"
                      ],
                      "expandTopLevel": true,
                      "finalBy": "Instance"
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_SendsTo.*|Receives.*_4",
                        "sortOrder": 2
                      }
                    ],
                    "labelSettings": [
                      {
                        "columnId": "SqlInstance",
                        "label": "Name"
                      },
                      {
                        "columnId": "Database"
                      },
                      {
                        "columnId": "Instance"
                      },
                      {
                        "columnId": "SendsToTransportsPerSec",
                        "label": "Sends to transports"
                      },
                      {
                        "columnId": "SendsToReplicasPerSec",
                        "label": "Sends to replicas"
                      },
                      {
                        "columnId": "ReceivesFromReplicasPerSec",
                        "label": "Receives from replicas"
                      },
                      {
                        "columnId": "ResentMessagesPerSec",
                        "label": "Resent messages"
                      },
                      {
                        "columnId": "FlowControlPerSec",
                        "label": "Flow control"
                      },
                      {
                        "columnId": "FlowControlTimeMsPerSec",
                        "label": "Flow control time (ms/sec)"
                      }
                    ]
                  },
                  "sortBy": [
                    {
                      "itemKey": "$gen_heatmap_SendsTo.*|Receives.*_4",
                      "sortOrder": 2
                    }
                  ],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  }
                },
                "showPin": true,
                "name": "Replicas"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "selectedTab",
            "comparison": "isEqualTo",
            "value": "Replicas"
          },
          "name": "Replicas"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| extend Tags = todynamic(Tags)\r\n| where Namespace =~ 'sqlserver_performance' and tostring(Tags.object) endswith ':Databases' and tostring(Tags.instance) !~ 'total'\r\n| extend Database = tostring(Tags.database_name), SqlInstance = tostring(Tags.sql_instance), Counter = tostring(Tags.counter), DbInstance = tostring(Tags.instance)\r\n| where SqlInstance in ({SqlServers}) or '*' in ({SqlServers})\r\n| summarize \r\n        DataFilesSize = avgif(Val, Counter == 'Data File(s) Size (KB)'),\r\n        LogFilesSize = avgif(Val, Counter == 'Log File(s) Size (KB)'),\r\n        LogFilesUsedSize = avgif(Val, Counter == 'Log File(s) Used Size (KB)'),\r\n        PercentLogUsed = avgif(Val, Counter == 'Percent Log Used')\r\n    by SqlInstance, DbInstance, DbId = strcat('/workspace/', TenantId, '/computer/', iff(Computer == '', '*', Computer), '/sqlinstance/', SqlInstance, '/database/')\r\n\r\n",
                  "size": 2,
                  "showAnalytics": true,
                  "timeContext": {
                    "durationMs": 14400000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "table",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "$gen_group",
                        "formatter": 1,
                        "formatOptions": {
                          "linkColumn": "DbId",
                          "linkTarget": "WorkbookTemplate",
                          "workbookContext": {
                            "componentIdSource": "workbook",
                            "resourceIdsSource": "column",
                            "resourceIds": "DbId",
                            "templateIdSource": "static",
                            "templateId": "Community-Workbooks/Workloads/SQL/SQL Server",
                            "typeSource": "static",
                            "type": "workbook",
                            "gallerySource": "static",
                            "gallery": "Azure Monitor",
                            "locationSource": "default"
                          }
                        }
                      },
                      {
                        "columnMatch": "SqlInstance",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "DbInstance",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "DbId",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "DataFilesSize|LogFilesSize|LogFilesUsedSize",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "blue",
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 37,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "PercentLogUsed",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "max": 100,
                          "palette": "orange"
                        },
                        "numberFormat": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Database",
                        "formatter": 5
                      }
                    ],
                    "rowLimit": 1000,
                    "filter": true,
                    "hierarchySettings": {
                      "treeType": 1,
                      "groupBy": [
                        "SqlInstance"
                      ],
                      "expandTopLevel": true,
                      "finalBy": "DbInstance"
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_DataFilesSize|LogFilesSize|LogFilesUsedSize_4",
                        "sortOrder": 2
                      }
                    ],
                    "labelSettings": [
                      {
                        "columnId": "SqlInstance",
                        "label": "Name"
                      },
                      {
                        "columnId": "DbInstance",
                        "label": "Name"
                      },
                      {
                        "columnId": "DbId"
                      },
                      {
                        "columnId": "DataFilesSize",
                        "label": "Data file(s) size"
                      },
                      {
                        "columnId": "LogFilesSize",
                        "label": "Log file(s) size"
                      },
                      {
                        "columnId": "LogFilesUsedSize",
                        "label": "Log file(s) used size"
                      },
                      {
                        "columnId": "PercentLogUsed",
                        "label": "Percent log used"
                      }
                    ]
                  },
                  "sortBy": [
                    {
                      "itemKey": "$gen_heatmap_DataFilesSize|LogFilesSize|LogFilesUsedSize_4",
                      "sortOrder": 2
                    }
                  ],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  }
                },
                "showPin": true,
                "name": "Database space"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "selectedTab",
            "comparison": "isEqualTo",
            "value": "Database space"
          },
          "name": "Database space"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| extend Tags = todynamic(Tags)\r\n| where Namespace =~ 'sqlserver_performance' and tostring(Tags.object) endswith ':Databases' and tostring(Tags.instance) !~ 'total'\r\n| extend Database = tostring(Tags.database_name), SqlInstance = tostring(Tags.sql_instance), Counter = tostring(Tags.counter), DbInstance = tostring(Tags.instance)\r\n| where SqlInstance in ({SqlServers}) or '*' in ({SqlServers})\r\n| summarize (Start, StartValue) = arg_min(TimeGenerated, Val), (End, EndValue) = arg_max(TimeGenerated, Val) by Counter, Database, SqlInstance, DbInstance, TenantId, Computer, bin(TimeGenerated, {TimeRange:grain})\r\n| extend Val = iff(EndValue >= StartValue, EndValue - StartValue, real(null))\r\n| summarize \r\n        WriteTransactionsPerSec = avgif(Val, Counter == 'Write Transactions/sec'),\r\n        LogFlushesPerSec = avgif(Val, Counter == 'Log Flushes/sec'),\r\n        LogBytesFlushedPerSec = avgif(Val, Counter == 'Log Bytes Flushed/sec'),\r\n        LogFlushWaitTime = avgif(Val, Counter == 'Log Flush Wait Time')\r\n    by SqlInstance, DbInstance, DbId = strcat('/workspace/', TenantId, '/computer/', iff(Computer == '', '*', Computer), '/sqlinstance/', SqlInstance, '/database/')\r\n\r\n",
                  "size": 2,
                  "showAnalytics": true,
                  "timeContext": {
                    "durationMs": 14400000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "table",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "$gen_group",
                        "formatter": 1,
                        "formatOptions": {
                          "linkColumn": "DbId",
                          "linkTarget": "WorkbookTemplate",
                          "workbookContext": {
                            "componentIdSource": "workbook",
                            "resourceIdsSource": "column",
                            "resourceIds": "DbId",
                            "templateIdSource": "static",
                            "templateId": "Community-Workbooks/Workloads/SQL/SQL Server",
                            "typeSource": "static",
                            "type": "workbook",
                            "gallerySource": "static",
                            "gallery": "Azure Monitor",
                            "locationSource": "default"
                          }
                        },
                        "numberFormat": {
                          "unit": 31,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "SqlInstance",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "DbInstance",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "DbId",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "TransactionsPerSec|WriteTransactionsPerSec",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "blue",
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 31,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "LogFlushesPerSec",
                        "formatter": 0,
                        "formatOptions": {
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 31,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "LogBytesFlushedPerSec",
                        "formatter": 0,
                        "formatOptions": {
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 31,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "LogFlushWaitTime",
                        "formatter": 0,
                        "numberFormat": {
                          "unit": 23,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "Database",
                        "formatter": 5
                      }
                    ],
                    "rowLimit": 1000,
                    "filter": true,
                    "hierarchySettings": {
                      "treeType": 1,
                      "groupBy": [
                        "SqlInstance"
                      ],
                      "expandTopLevel": true,
                      "finalBy": "DbInstance"
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_TransactionsPerSec|WriteTransactionsPerSec_4",
                        "sortOrder": 2
                      }
                    ],
                    "labelSettings": [
                      {
                        "columnId": "SqlInstance",
                        "label": "Name"
                      },
                      {
                        "columnId": "DbInstance"
                      },
                      {
                        "columnId": "DbId"
                      },
                      {
                        "columnId": "WriteTransactionsPerSec",
                        "label": "Write transactions/sec"
                      },
                      {
                        "columnId": "LogFlushesPerSec",
                        "label": "Log flushes/sec"
                      },
                      {
                        "columnId": "LogBytesFlushedPerSec",
                        "label": "Log bytes flushed/sec"
                      },
                      {
                        "columnId": "LogFlushWaitTime",
                        "label": "Log flush wait time"
                      }
                    ]
                  },
                  "sortBy": [
                    {
                      "itemKey": "$gen_heatmap_TransactionsPerSec|WriteTransactionsPerSec_4",
                      "sortOrder": 2
                    }
                  ],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  }
                },
                "showPin": true,
                "name": "Transactions"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "selectedTab",
            "comparison": "isEqualTo",
            "value": "Transactions"
          },
          "name": "Transactions"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\r\n| where Computer in~ ({OnboardedComputers})\r\n| extend Tags = todynamic(Tags)\r\n| where Namespace =~ 'sqlserver_database_io'\r\n| extend Database = tostring(Tags.database_name), SqlInstance = tostring(Tags.sql_instance), FileType = tostring(Tags.file_type), FileName = tostring(Tags.logical_filename)\r\n| where SqlInstance in ({SqlServers}) or '*' in ({SqlServers})\r\n| summarize (Start, StartValue) = arg_min(TimeGenerated, Val), (End, EndValue) = arg_max(TimeGenerated, Val) by Name, Database, SqlInstance, FileType, TenantId, Computer, FileName\r\n| extend Val = iff(EndValue >= StartValue, EndValue - StartValue, real(null))\r\n| summarize\r\n        DataReadBytes = sumif(Val, Name == 'read_bytes' and FileType == 'ROWS'),\r\n        DataWriteBytes = sumif(Val, Name == 'write_bytes' and FileType == 'ROWS'),\r\n        DataReadLatency = avgif(Val, Name == 'read_latency_ms' and FileType == 'ROWS'),\r\n        DataWriteLatency = avgif(Val, Name == 'write_latency_ms' and FileType == 'ROWS'),\r\n        LogReadBytes = sumif(Val, Name == 'read_bytes' and FileType == 'LOG'),\r\n        LogWriteBytes = sumif(Val, Name == 'write_bytes' and FileType == 'LOG'),\r\n        LogReadLatency = avgif(Val, Name == 'read_latency_ms' and FileType == 'LOG'),\r\n        LogWriteLatency = avgif(Val, Name == 'write_latency_ms' and FileType == 'LOG')\r\n    by SqlInstance, Database, DbId = strcat('/workspace/', TenantId, '/computer/', iff(Computer == '', '*', Computer), '/sqlinstance/', SqlInstance, '/database/')\r\n",
                  "size": 2,
                  "showAnalytics": true,
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "table",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "$gen_group",
                        "formatter": 1,
                        "formatOptions": {
                          "linkColumn": "DbId",
                          "linkTarget": "WorkbookTemplate",
                          "workbookContext": {
                            "componentIdSource": "workbook",
                            "resourceIdsSource": "column",
                            "resourceIds": "DbId",
                            "templateIdSource": "static",
                            "templateId": "Community-Workbooks/Workloads/SQL/SQL Server",
                            "typeSource": "static",
                            "type": "workbook",
                            "gallerySource": "static",
                            "gallery": "Azure Monitor",
                            "locationSource": "default"
                          }
                        }
                      },
                      {
                        "columnMatch": "SqlInstance",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "Database",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "DbId",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "DataReadBytes|DataWriteBytes",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "blue",
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 2,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "DataReadLatency|DataWriteLatency",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "orange",
                          "aggregation": "Max"
                        },
                        "numberFormat": {
                          "unit": 23,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "LogReadBytes|LogWriteBytes",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "blue",
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 2,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      {
                        "columnMatch": "LogReadLatency|LogWriteLatency",
                        "formatter": 8,
                        "formatOptions": {
                          "min": 0,
                          "palette": "orange",
                          "aggregation": "Max"
                        },
                        "numberFormat": {
                          "unit": 23,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      }
                    ],
                    "rowLimit": 1000,
                    "filter": true,
                    "hierarchySettings": {
                      "treeType": 1,
                      "groupBy": [
                        "SqlInstance"
                      ],
                      "expandTopLevel": true,
                      "finalBy": "Database"
                    },
                    "labelSettings": [
                      {
                        "columnId": "SqlInstance",
                        "label": "Name"
                      },
                      {
                        "columnId": "DataReadBytes",
                        "label": "Data read bytes"
                      },
                      {
                        "columnId": "DataWriteBytes",
                        "label": "Data write bytes"
                      },
                      {
                        "columnId": "DataReadLatency",
                        "label": "Data read latency"
                      },
                      {
                        "columnId": "DataWriteLatency",
                        "label": "Data write latency"
                      },
                      {
                        "columnId": "LogReadBytes",
                        "label": "Log read bytes"
                      },
                      {
                        "columnId": "LogWriteBytes",
                        "label": "Log write bytes"
                      },
                      {
                        "columnId": "LogReadLatency",
                        "label": "Log read latency"
                      },
                      {
                        "columnId": "LogWriteLatency",
                        "label": "Log write latency"
                      }
                    ]
                  },
                  "sortBy": [],
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "Name",
                      "formatter": 1,
                      "formatOptions": {
                        "showIcon": true
                      }
                    },
                    "leftContent": {
                      "columnMatch": "Value",
                      "formatter": 12,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "maximumFractionDigits": 1
                        }
                      }
                    },
                    "secondaryContent": {
                      "columnMatch": "Trend",
                      "formatter": 21,
                      "formatOptions": {
                        "min": 0,
                        "palette": "blue",
                        "showIcon": true
                      }
                    },
                    "showBorder": false
                  }
                },
                "showPin": true,
                "name": "Database IO"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "selectedTab",
            "comparison": "isEqualTo",
            "value": "Database IO"
          },
          "name": "Database IO"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "parameters": [
                    {
                      "id": "d96a773c-653b-468b-bba0-33925dabe752",
                      "version": "KqlParameterItem/1.0",
                      "name": "Metric",
                      "type": 2,
                      "isRequired": true,
                      "query": "InsightsMetrics\n| extend Tags = todynamic(Tags)\n| extend SqlServer = tostring(Tags.sql_instance)\n| where (Computer in~ ({OnboardedComputers}) or '*' in ({OnboardedComputers}))  \n| where Namespace !in ('sqlserver_performance')\n| where SqlServer in ({SqlServers})\n| summarize by Namespace, Name\n| project value = strcat('| where Namespace == \"', Namespace, '\" and Name == \"', Name, '\"'), label = Name, group = Namespace\n| union (InsightsMetrics\n    | extend Tags = todynamic(Tags)\n    | extend SqlServer = tostring(Tags.sql_instance)\n    | where (Computer in~ ({OnboardedComputers}) or '*' in ({OnboardedComputers}))  \n    | where Namespace =~ 'sqlserver_performance'\n    | where SqlServer in ({SqlServers})\n    | summarize by Namespace, Name, Counter = tostring(todynamic(Tags).counter)\n    | project value = strcat('| where Namespace == \"', Namespace, '\" and Tags.counter == \"', Counter, '\"'), label = Counter, group = \"Sql performance counters\")\n| order by group asc, label asc\n| extend Row = row_number()\n| project value, label, selected = Row == 1, group",
                      "crossComponentResources": [
                        "{Workspaces}"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": [],
                        "showDefault": false
                      },
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "timeContextFromParameter": "TimeRange",
                      "queryType": 0,
                      "resourceType": "microsoft.operationalinsights/workspaces"
                    },
                    {
                      "id": "1e8a0803-aff5-45d4-990a-29923479851b",
                      "version": "KqlParameterItem/1.0",
                      "name": "Aggregation",
                      "type": 2,
                      "isRequired": true,
                      "typeSettings": {
                        "additionalResourceOptions": [],
                        "showDefault": false
                      },
                      "jsonData": "[[[\n    { \"value\":\"avg(Val)\", \"label\":\"Average\", \"selected\":\"true\" },\n    { \"value\":\"sum(Val)\", \"label\":\"Sum\", \"selected\":\"false\" },\n    { \"value\":\"min(Val)\", \"label\":\"Minimum\", \"selected\":\"false\" },\n    { \"value\":\"max(Val)\", \"label\":\"Maximum\", \"selected\":\"false\" },\n    { \"value\":\"count()\", \"label\":\"Count\", \"selected\":\"false\" }\n]",
                      "timeContext": {
                        "durationMs": 0
                      },
                      "timeContextFromParameter": "TimeRange"
                    },
                    {
                      "id": "9b2944ed-09fe-4e36-a535-7e89d28d8c3a",
                      "version": "KqlParameterItem/1.0",
                      "name": "SplitBy",
                      "label": "Split by",
                      "type": 2,
                      "query": "InsightsMetrics\r\n| extend Tags = todynamic(Tags)\r\n| where (Computer in~ ({OnboardedComputers}) or '*' in ({OnboardedComputers}))\r\n{Metric}\r\n| take 10\r\n| project Keys = bag_keys(Tags)\r\n| mvexpand Keys\r\n| summarize by label = tostring(Keys)\r\n| extend value = case(label in ('counter', 'database_name', 'instance', 'object'), strcat('by Split = strcat(Tags[\"sql_instance\"], \"/\", Tags[\"', label, '\"])'), strcat('by Split = tostring(Tags[\"', label, '\"])'))\r\n| project value, label = replace('vm.azm.ms/', '', label), selected = true",
                      "crossComponentResources": [
                        "{Workspaces}"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": [],
                        "showDefault": false
                      },
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "timeContextFromParameter": "TimeRange",
                      "queryType": 0,
                      "resourceType": "microsoft.operationalinsights/workspaces"
                    },
                    {
                      "id": "f6dbed75-a152-4906-a04c-2b9989624538",
                      "version": "KqlParameterItem/1.0",
                      "name": "SplitByValue",
                      "type": 1,
                      "isRequired": true,
                      "isHiddenWhenLocked": true,
                      "criteriaData": [
                        {
                          "criteriaContext": {
                            "leftOperand": "SplitBy",
                            "operator": "isNotNull",
                            "rightValType": "param",
                            "resultValType": "param",
                            "resultVal": "SplitBy"
                          }
                        },
                        {
                          "criteriaContext": {
                            "operator": "Default",
                            "rightValType": "param",
                            "resultValType": "static",
                            "resultVal": "//"
                          }
                        }
                      ],
                      "timeContextFromParameter": "TimeRange"
                    }
                  ],
                  "style": "above",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                "name": "Metric selectors",
                "styleSettings": {
                  "margin": "15px 0 10px 0"
                }
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "InsightsMetrics\n| extend Tags = todynamic(Tags)\n| where (Computer in~ ({OnboardedComputers}) or '*' in ({OnboardedComputers})) \n| where Tags.sql_instance in ({SqlServers}) or '*' in ({SqlServers})\n{Metric}\n| make-series Trend = {Aggregation} default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end}-{TimeRange:grain} step {TimeRange:grain} {SplitByValue}\n",
                  "size": 0,
                  "aggregation": 3,
                  "showAnalytics": true,
                  "title": "{Metric:label} trend",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "visualization": "timechart",
                  "chartSettings": {
                    "xSettings": {},
                    "ySettings": {
                      "min": 0
                    }
                  }
                },
                "showPin": true,
                "name": "Metric trend"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "selectedTab",
            "comparison": "isEqualTo",
            "value": "Sql counters"
          },
          "name": "Sql counters"
        }
      ],
      "isLocked": false,
      "fallbackResourceIds": [
        "azure monitor"
      ],
      "fromTemplateId": "Community-Workbooks/Workloads/SQL/SQL Servers"
    }
  },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2021-03-08",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "[string(variables('workbookContent'))]",
        "version": "1.0",
        "sourceId": "[parameters('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
}
