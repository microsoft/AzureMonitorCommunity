{
    "version": "Notebook/1.0",
    "items": [
      {
        "type": 1,
        "content": {
          "json": "# Update Assessment #"
        },
        "name": "WorkbookName"
      },
      {
        "type": 9,
        "content": {
          "version": "KqlParameterItem/1.0",
          "parameters": [
            {
              "id": "1e2b3246-fe4e-4d39-b265-7a42a4ae46c1",
              "version": "KqlParameterItem/1.0",
              "name": "DefaultSubscription_Internal",
              "type": 1,
              "isRequired": true,
              "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| take 1\r\n| project subscriptionId",
              "crossComponentResources": [
                "value::selected"
              ],
              "isHiddenWhenLocked": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources"
            },
            {
              "id": "99cc0623-1cf2-42ee-ae97-0e1321843c9d",
              "version": "KqlParameterItem/1.0",
              "name": "Subscriptions",
              "type": 6,
              "isRequired": true,
              "multiSelect": true,
              "quote": "'",
              "delimiter": ",",
              "query": "summarize by subscriptionId\r\n| project value = strcat(\"/subscriptions/\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription_Internal}', true, false)",
              "crossComponentResources": [
                "value::selected"
              ],
              "typeSettings": {
                "additionalResourceOptions": [
                  "value::all"
                ],
                "showDefault": false
              },
              "defaultValue": "value::all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "value": [
                "value::all"
              ]
            },
            {
              "id": "e249244e-b556-4ecb-aae0-36843bc5a5a7",
              "version": "KqlParameterItem/1.0",
              "name": "Workspaces",
              "type": 5,
              "isRequired": true,
              "multiSelect": true,
              "quote": "'",
              "delimiter": ",",
              "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| project id, selected = iff(id =~ todynamic('{DefaultSubscription_Internal}').ws, true, false), custId= properties.customerId",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "value": [
                "/subscriptions/23aa6822-7f78-4718-b0c5-381b8b204c33/resourceGroups/mms-weu/providers/Microsoft.OperationalInsights/workspaces/Minlavoro-AD"
              ],
              "typeSettings": {
                "additionalResourceOptions": [
                  "value::all"
                ],
                "showDefault": false
              },
              "defaultValue": "value::all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources"
            },
            {
              "id": "5e8549d6-22aa-47e0-a84b-bf1848cd44cc",
              "version": "KqlParameterItem/1.0",
              "name": "TimeRange",
              "type": 4,
              "isRequired": true,
              "value": {
                "durationMs": 604800000
              },
              "typeSettings": {
                "selectableValues": [
                  {
                    "durationMs": 300000
                  },
                  {
                    "durationMs": 900000
                  },
                  {
                    "durationMs": 1800000
                  },
                  {
                    "durationMs": 3600000
                  },
                  {
                    "durationMs": 14400000
                  },
                  {
                    "durationMs": 43200000
                  },
                  {
                    "durationMs": 86400000
                  },
                  {
                    "durationMs": 172800000
                  },
                  {
                    "durationMs": 259200000
                  },
                  {
                    "durationMs": 604800000
                  },
                  {
                    "durationMs": 1209600000
                  },
                  {
                    "durationMs": 2419200000
                  },
                  {
                    "durationMs": 2592000000
                  },
                  {
                    "durationMs": 5184000000
                  },
                  {
                    "durationMs": 7776000000
                  }
                ],
                "allowCustom": true
              }
            },
            {
              "id": "381923f4-82a2-4575-a734-21292c84b476",
              "version": "KqlParameterItem/1.0",
              "name": "IsUpdateManagementEnabled",
              "type": 2,
              "isRequired": true,
              "query": "Update\r\n| take 1\r\n| summarize recCount = count() \r\n| project selected = iff(recCount > 0, true, false)",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "isHiddenWhenLocked": true,
              "typeSettings": {
                "additionalResourceOptions": [],
                "defaultItemsText": "true"
              },
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "defaultValue": "value::1",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            {
              "id": "05905f19-229e-454a-ab71-c3b682bfca5c",
              "version": "KqlParameterItem/1.0",
              "name": "Help",
              "label": "Show Help",
              "type": 10,
              "isRequired": true,
              "typeSettings": {
                "additionalResourceOptions": []
              },
              "jsonData": "[\r\n  { \"value\": \"Yes\", \"label\": \"Yes\"},\r\n  { \"value\": \"No\", \"label\": \"No\", \"selected\":true },\r\n  { \"value\": \"ChangeLog\", \"label\": \"Change Log\"}\r\n]"
            }
          ],
          "style": "pills",
          "queryType": 0,
          "resourceType": "microsoft.operationalinsights/workspaces"
        },
        "name": "ParameterSection-1"
      },
      {
        "type": 1,
        "content": {
          "json": ">** Author **\r\n>[Bruno Gabrielli](mailto:bruno.gabrielli@microsoft.com)\r\n>\r\n>** Version 1.7 **\r\n>2022-03-14\r\n>- Added Tabs to separate between ***Windows*** and ***Linux*** operating systems\r\n>- Added Linux related info\r\n>\r\n>** Version 1.6 **\r\n>2021-04-08\r\n>- Revised, fixed and optimized queries.\r\n>\r\n>** Version 1.5 **\r\n>2020-12-10\r\n>* Added the Show Help parameter. You can select if you wish to see help for initial configuration (Get Started part) or if you wich to see the this Change Log.\r\n>* Added GetStarted section with documentation to follow to enable Diagnostic Settings for log collection.\r\n>\r\n>** Version 1.4 **\r\n>2020-05-21\r\n>- Revisited parameter section to avoid null selection and error messages.\r\n>- Added guidance to configure the UpdateManagement if missing\r\n>\r\n>** Version 1.3 **\r\n>2020-04-06\r\n>- Fixed a bug that was preventing a text from being displayed correctly.\r\n>\r\n>** Version 1.2 **\r\n>2020-03-24\r\n>- Changed some of the distinct and summarize instructions to use SourceComputerId in order to include Computer names which are the same across different workspaces (duplicate computer names are allowed inside different workspaces).\r\n>- Added workspace lookup query to allow duplicate computer name to be recognized based on the WS they are reporting to.\r\n>- Moved update details queries inside the group.\r\n>- Named the group *Missing Update Details*\r\n>\r\n>** Version 1.1 **\r\n>2020-03-11\r\n>- Grouped together the *Total missing updates by computer* tile and the related *List of all updates by selected computer* tile\r\n>\r\n>** Version 1.0 **\r\n>2020-02-27\r\n> - Initial version"
        },
        "conditionalVisibility": {
          "parameterName": "Help",
          "comparison": "isEqualTo",
          "value": "ChangeLog"
        },
        "customWidth": "66",
        "name": "GeneralInfo",
        "styleSettings": {
          "showBorder": true
        }
      },
      {
        "type": 1,
        "content": {
          "json": "# Get Started #\r\n\r\n-------------------------\r\n\r\nWelcome to the Update Management workbook. This workbook is designed to to ease the reporting for virtual machine patching status in the given time frame. It gives the flexibility of excluding patches by: month of publishing, KBID, Classification. You can select single or multiple virtual machine, subscriptions and workspaces to report on. You can also select a time range with the most common patterns or custom interval.\r\n\r\n## Requirements ##\r\n\r\n* A [Log Analytics workspace.](https://docs.microsoft.com/en-us/azure/azure-monitor/platform/design-logs-deployment?WT.mc_id=Portal-fx)\r\n\r\n* [Update Management](https://docs.microsoft.com/en-us/azure/automation/update-management/overview) enabled.\r\n"
        },
        "conditionalVisibility": {
          "parameterName": "Help",
          "comparison": "isEqualTo",
          "value": "Yes"
        },
        "name": "getStarted"
      },
      {
        "type": 1,
        "content": {
          "json": "<br>\r\n### âš ï¸ Update Management, which is necessary for this workbook to work properly, was not found as enabled in the selected workspace(s).\r\n\r\nPlease select another workspace or check out the detailed documentation on how to enable the Update Management at [this](https://docs.microsoft.com/en-us/azure/automation/automation-update-management#onboard) link."
        },
        "conditionalVisibility": {
          "parameterName": "IsUpdateManagementEnabled",
          "comparison": "isNotEqualTo",
          "value": "true"
        },
        "name": "UpdateManagementNotEnabled"
      },
      {
        "type": 11,
        "content": {
          "version": "LinkItem/1.0",
          "style": "tabs",
          "links": [
            {
              "id": "970f0b0d-dd25-46c0-910f-86bc1fb37396",
              "cellValue": "selectedTab",
              "linkTarget": "parameter",
              "linkLabel": "Windows",
              "subTarget": "Windows",
              "preText": "Windows",
              "style": "link"
            },
            {
              "id": "157004e9-4339-48ed-a942-275ae71ba8db",
              "cellValue": "selectedTab",
              "linkTarget": "parameter",
              "linkLabel": "Linux",
              "subTarget": "Linux",
              "style": "link"
            }
          ]
        },
        "name": "links - 9"
      },
      {
        "type": 12,
        "content": {
          "version": "NotebookGroup/1.0",
          "groupType": "editable",
          "items": [
            {
              "type": 9,
              "content": {
                "version": "KqlParameterItem/1.0",
                "crossComponentResources": [
                  "{Workspaces}"
                ],
                "parameters": [
                  {
                    "id": "01b782de-6cb7-4c31-b6ad-0a502c604fbe",
                    "version": "KqlParameterItem/1.0",
                    "name": "Servers",
                    "type": 2,
                    "isRequired": true,
                    "multiSelect": true,
                    "quote": "'",
                    "delimiter": ",",
                    "query": "Update\r\n| where OSType != \"Linux\"\r\n| distinct SourceComputerId, Computer\r\n| project Computer\r\n| order by Computer asc",
                    "crossComponentResources": [
                      "{Workspaces}"
                    ],
                    "typeSettings": {
                      "additionalResourceOptions": [
                        "value::all"
                      ],
                      "showDefault": false
                    },
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "defaultValue": "value::all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  {
                    "id": "7d383415-a188-420b-bca8-7286db9d677f",
                    "version": "KqlParameterItem/1.0",
                    "name": "ExcludeByKBID",
                    "label": "Exclude by KB",
                    "type": 2,
                    "multiSelect": true,
                    "quote": "'",
                    "delimiter": ",",
                    "query": "Update\r\n| where OSType != \"Linux\"\r\n| where Optional==false\r\n| where Approved!=false\r\n| where UpdateState == \"Needed\" \r\n| distinct KBID\r\n| order by toint(KBID) desc\r\n",
                    "crossComponentResources": [
                      "{Workspaces}"
                    ],
                    "typeSettings": {
                      "additionalResourceOptions": [
                        "value::all"
                      ],
                      "showDefault": false
                    },
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  {
                    "id": "8b1ce7d3-4e7f-474a-8fcd-90c00131977a",
                    "version": "KqlParameterItem/1.0",
                    "name": "ExcludeByPublishedDate",
                    "label": "Exclude by Published Date Month",
                    "type": 2,
                    "multiSelect": true,
                    "quote": "'",
                    "delimiter": ",",
                    "query": "Update\r\n| where OSType != \"Linux\"\r\n| where Optional==false \r\n| where Approved!=false \r\n| where UpdateState == \"Needed\"\r\n| extend PublishedMonth= substring(tostring(PublishedDate),0,indexof(PublishedDate,\"-\",0,-1,2))\r\n| distinct PublishedMonth\r\n| order by PublishedMonth desc\r\n",
                    "crossComponentResources": [
                      "{Workspaces}"
                    ],
                    "typeSettings": {
                      "additionalResourceOptions": [
                        "value::all"
                      ],
                      "showDefault": false
                    },
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  {
                    "id": "6c8b0c26-2abe-47f8-b52e-96c5cb142492",
                    "version": "KqlParameterItem/1.0",
                    "name": "ExcludeByClassification",
                    "label": "Exclude by Classification",
                    "type": 2,
                    "multiSelect": true,
                    "quote": "'",
                    "delimiter": ",",
                    "query": "Update\r\n| where OSType != \"Linux\"\r\n| where Optional==false \r\n| where Approved!=false \r\n| where UpdateState == \"Needed\" \r\n| distinct Classification\r\n| order by Classification desc\r\n ",
                    "crossComponentResources": [
                      "{Workspaces}"
                    ],
                    "typeSettings": {
                      "additionalResourceOptions": [
                        "value::all"
                      ],
                      "showDefault": false
                    },
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "value": [
                      "Definition Updates"
                    ]
                  }
                ],
                "style": "pills",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces"
              },
              "name": "ParameterSection_Windows"
            },
            {
              "type": 3,
              "content": {
                "version": "KqlItem/1.0",
                "query": "let excludedPublishedDates = iif(\"{ExcludeByPublishedDate}\"==\"\", dynamic(['9999-01-01','9999-02-01']), dynamic([{ExcludeByPublishedDate}]));\r\nlet excludedKBID = iif(\"{ExcludeByKBID}\"==\"\", dynamic(['Blank','Blank2']), dynamic([{ExcludeByKBID}]));\r\nlet excludedClassification = iif(\"{ExcludeByClassification}\"==\"\", dynamic(['Blank3','Blank4']), dynamic([{ExcludeByClassification}]));\r\nUpdate\r\n| where Computer in ({Servers})\r\n| where Optional==false\r\n| where Approved!=false\r\n| where KBID !in (excludedKBID)\r\n| where Classification !in (excludedClassification)\r\n| where substring(PublishedDate,0,7) !in (excludedPublishedDates)\r\n| summarize arg_max(TimeGenerated, *) by SourceComputerId, KBID, Classification\r\n| summarize nonCompl=countif(UpdateState==\"Needed\"), compl=countif(UpdateState!=\"Needed\") by SourceComputerId\r\n| extend status = iif((compl>0 and nonCompl==0),\"Compliant\",iif((compl>=0 and nonCompl>0),\"Not-Compliant\",\"Unknown\"))\r\n| summarize compliance = count() by status\r\n| sort by status asc",
                "size": 0,
                "title": "Update compliance status",
                "noDataMessage": "No data for the selected conditions.",
                "timeContext": {
                  "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                  "{Workspaces}"
                ],
                "visualization": "piechart",
                "sortBy": [],
                "tileSettings": {
                  "titleContent": {
                    "columnMatch": "status",
                    "formatter": 1,
                    "formatOptions": {}
                  },
                  "leftContent": {
                    "columnMatch": "compliance",
                    "formatter": 1,
                    "formatOptions": {},
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  "rightContent": {
                    "columnMatch": "status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Not-Compliant",
                          "representation": "redBright",
                          "text": "Server(s)"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Unknown",
                          "representation": "gray",
                          "text": "Server(s)"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "green",
                          "text": "Server(s)"
                        }
                      ]
                    }
                  },
                  "showBorder": false
                },
                "graphSettings": {
                  "type": 0,
                  "topContent": {
                    "columnMatch": "status",
                    "formatter": 1
                  },
                  "centerContent": {
                    "columnMatch": "compliance",
                    "formatter": 1,
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "maximumSignificantDigits": 3,
                        "maximumFractionDigits": 2
                      }
                    }
                  }
                },
                "chartSettings": {
                  "seriesLabelSettings": [
                    {
                      "seriesName": "Not-Compliant",
                      "label": "Not-Compliant Server(s)",
                      "color": "redBright"
                    },
                    {
                      "seriesName": "Compliant",
                      "label": "Compliant Server(s)",
                      "color": "green"
                    },
                    {
                      "seriesName": "Unknown",
                      "color": "gray"
                    }
                  ]
                },
                "mapSettings": {
                  "locInfo": "AzureResource",
                  "sizeSettings": "compliance",
                  "sizeAggregation": "Sum",
                  "legendMetric": "compliance",
                  "legendAggregation": "Sum",
                  "itemColorSettings": {
                    "type": "heatmap",
                    "colorAggregation": "Sum",
                    "nodeColorField": "compliance",
                    "heatmapPalette": "greenRed"
                  }
                }
              },
              "customWidth": "40",
              "showPin": true,
              "name": "UpdateComplianceStatus_Windows",
              "styleSettings": {
                "showBorder": true
              }
            },
            {
              "type": 3,
              "content": {
                "version": "KqlItem/1.0",
                "query": "let excludedPublishedDates = iif(\"{ExcludeByPublishedDate}\"==\"\", dynamic(['9999-01-01','9999-02-01']), dynamic([{ExcludeByPublishedDate}]));\r\nlet excludedKBID = iif(\"{ExcludeByKBID}\"==\"\", dynamic(['Blank','Blank2']), dynamic([{ExcludeByKBID}]));\r\nlet excludedClassification = iif(\"{ExcludeByClassification}\"==\"\", dynamic(['Blank3','Blank4']), dynamic([{ExcludeByClassification}]));\r\nUpdate\r\n| where Computer in ({Servers})\r\n| where Optional==false\r\n| where Approved!=false\r\n| where KBID !in (excludedKBID)\r\n| where Classification !in (excludedClassification)\r\n| where substring(PublishedDate,0,7) !in (excludedPublishedDates)\r\n| summarize arg_max(TimeGenerated, *) by SourceComputerId, KBID, Classification\r\n| summarize Updates_Count=countif(UpdateState==\"Needed\") by Classification\r\n| sort by Classification asc",
                "size": 0,
                "showAnalytics": true,
                "title": "Total missing updates by Classification",
                "noDataMessage": "No data for the selected conditions.",
                "timeContext": {
                  "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "showExportToExcel": true,
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                  "{Workspaces}"
                ],
                "visualization": "barchart"
              },
              "customWidth": "60",
              "showPin": true,
              "name": "TotalMissingUpdates_Windows",
              "styleSettings": {
                "showBorder": true
              }
            },
            {
              "type": 12,
              "content": {
                "version": "NotebookGroup/1.0",
                "groupType": "editable",
                "title": "Missing Update details",
                "items": [
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "let excludedPublishedDates = iif(\"{ExcludeByPublishedDate}\"==\"\", dynamic(['9999-01-01','9999-02-01']), dynamic([{ExcludeByPublishedDate}]));\r\nlet excludedKBID = iif(\"{ExcludeByKBID}\"==\"\", dynamic(['Blank','Blank2']), dynamic([{ExcludeByKBID}]));\r\nlet excludedClassification = iif(\"{ExcludeByClassification}\"==\"\", dynamic(['Blank3','Blank4']), dynamic([{ExcludeByClassification}]));\r\nUpdate\r\n| where Computer in ({Servers})\r\n| where Optional==false\r\n| where Approved!=false\r\n| where KBID !in (excludedKBID)\r\n| where Classification !in (excludedClassification)\r\n| where substring(PublishedDate,0,7) !in (excludedPublishedDates)\r\n| summarize arg_max(TimeGenerated, *) by SourceComputerId, KBID, Classification\r\n| where UpdateState == \"Needed\" \r\n| summarize Updates_Count=count() by SourceComputerId, Computer\r\n| order by Updates_Count desc",
                      "size": 0,
                      "showAnalytics": true,
                      "title": "Total by computer",
                      "noDataMessage": "No data for the selected conditions.",
                      "timeContext": {
                        "durationMs": 0
                      },
                      "timeContextFromParameter": "TimeRange",
                      "exportFieldName": "SourceComputerId",
                      "exportParameterName": "row",
                      "exportDefaultValue": "",
                      "showExportToExcel": true,
                      "queryType": 0,
                      "resourceType": "microsoft.operationalinsights/workspaces",
                      "crossComponentResources": [
                        "{Workspaces}"
                      ],
                      "visualization": "tiles",
                      "gridSettings": {
                        "filter": true,
                        "sortBy": [
                          {
                            "itemKey": "Computer",
                            "sortOrder": 1
                          }
                        ]
                      },
                      "sortBy": [
                        {
                          "itemKey": "Computer",
                          "sortOrder": 1
                        }
                      ],
                      "tileSettings": {
                        "titleContent": {
                          "columnMatch": "Computer",
                          "formatter": 1,
                          "formatOptions": {
                            "showIcon": true
                          }
                        },
                        "leftContent": {
                          "columnMatch": "Updates_Count",
                          "formatter": 12,
                          "formatOptions": {
                            "palette": "auto",
                            "linkTarget": "GenericDetails",
                            "linkIsContextBlade": true,
                            "showIcon": true
                          },
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        "showBorder": false
                      },
                      "graphSettings": {
                        "type": 0,
                        "topContent": {
                          "columnMatch": "Computer",
                          "formatter": 1
                        },
                        "centerContent": {
                          "columnMatch": "Updates_Count",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "maximumSignificantDigits": 3,
                              "maximumFractionDigits": 2
                            }
                          }
                        }
                      }
                    },
                    "showPin": true,
                    "name": "TotalByComputer_Windows",
                    "styleSettings": {
                      "showBorder": true
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "let excludedPublishedDates = iif(\"{ExcludeByPublishedDate}\"==\"\", dynamic(['9999-01-01','9999-02-01']), dynamic([{ExcludeByPublishedDate}]));\r\nlet excludedKBID = iif(\"{ExcludeByKBID}\"==\"\", dynamic(['Blank','Blank2']), dynamic([{ExcludeByKBID}]));\r\nlet excludedClassification = iif(\"{ExcludeByClassification}\"==\"\", dynamic(['Blank3','Blank4']), dynamic([{ExcludeByClassification}]));\r\nUpdate\r\n| where SourceComputerId == tostring(\"{row}\")\r\n| where Optional==false\r\n| where Approved!=false\r\n| where KBID !in (excludedKBID)\r\n| where Classification !in (excludedClassification)\r\n| where substring(PublishedDate,0,7) !in (excludedPublishedDates)\r\n| summarize arg_max(TimeGenerated, *) by SourceComputerId, KBID, Classification\r\n| where UpdateState == \"Needed\" \r\n| project TimeGenerated, Computer, UpdateState, Classification, KBID, TenantId, Title, PublishedDate, Product, MSRCSeverity, RebootBehavior, Approved",
                      "size": 0,
                      "showAnalytics": true,
                      "title": "updateBySelectedComputer_hidden",
                      "timeContext": {
                        "durationMs": 0
                      },
                      "timeContextFromParameter": "TimeRange",
                      "showExportToExcel": true,
                      "queryType": 0,
                      "resourceType": "microsoft.operationalinsights/workspaces",
                      "crossComponentResources": [
                        "{Workspaces}"
                      ],
                      "visualization": "table",
                      "gridSettings": {
                        "formatters": [
                          {
                            "columnMatch": "KBID",
                            "formatter": 1,
                            "formatOptions": {
                              "linkTarget": "GenericDetails",
                              "linkIsContextBlade": true,
                              "showIcon": true
                            }
                          },
                          {
                            "columnMatch": "Title",
                            "formatter": 5,
                            "formatOptions": {
                              "showIcon": true
                            }
                          },
                          {
                            "columnMatch": "PublishedDate",
                            "formatter": 5,
                            "formatOptions": {
                              "showIcon": true
                            }
                          },
                          {
                            "columnMatch": "Product",
                            "formatter": 5,
                            "formatOptions": {
                              "showIcon": true
                            }
                          },
                          {
                            "columnMatch": "MSRCSeverity",
                            "formatter": 5,
                            "formatOptions": {
                              "showIcon": true
                            }
                          },
                          {
                            "columnMatch": "RebootBehavior",
                            "formatter": 5,
                            "formatOptions": {
                              "showIcon": true
                            }
                          },
                          {
                            "columnMatch": "Approved",
                            "formatter": 5,
                            "formatOptions": {
                              "showIcon": true
                            }
                          }
                        ],
                        "filter": true
                      },
                      "sortBy": []
                    },
                    "customWidth": "33",
                    "conditionalVisibilities": [
                      {
                        "parameterName": "row",
                        "comparison": "isNotEqualTo",
                        "value": ""
                      },
                      {
                        "parameterName": "_",
                        "comparison": "isEqualTo",
                        "value": "_"
                      }
                    ],
                    "showPin": true,
                    "name": "updateBySelectedComputer_hidden",
                    "styleSettings": {
                      "showBorder": true
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "let excludedPublishedDates = iif(\"{ExcludeByPublishedDate}\"==\"\", dynamic(['9999-01-01','9999-02-01']), dynamic([{ExcludeByPublishedDate}]));\r\nlet excludedKBID = iif(\"{ExcludeByKBID}\"==\"\", dynamic(['Blank','Blank2']), dynamic([{ExcludeByKBID}]));\r\nlet excludedClassification = iif(\"{ExcludeByClassification}\"==\"\", dynamic(['Blank3','Blank4']), dynamic([{ExcludeByClassification}]));\r\nUpdate\r\n| where Computer in ({Servers})\r\n| where Optional==false\r\n| where Approved!=false\r\n| where KBID !in (excludedKBID)\r\n| where Classification !in (excludedClassification)\r\n| where substring(PublishedDate,0,7) !in (excludedPublishedDates)\r\n| summarize arg_max(TimeGenerated, *) by SourceComputerId, KBID, Classification\r\n| where UpdateState == \"Needed\" \r\n| project TimeGenerated, Computer, UpdateState, Classification, KBID, TenantId, Title, PublishedDate, Product, MSRCSeverity, RebootBehavior, Approved\r\n",
                      "size": 0,
                      "showAnalytics": true,
                      "title": "AllUpdateNeeded_hidden",
                      "noDataMessage": "No data for the selected conditions.",
                      "timeContext": {
                        "durationMs": 0
                      },
                      "timeContextFromParameter": "TimeRange",
                      "showExportToExcel": true,
                      "queryType": 0,
                      "resourceType": "microsoft.operationalinsights/workspaces",
                      "crossComponentResources": [
                        "{Workspaces}"
                      ],
                      "visualization": "table",
                      "gridSettings": {
                        "formatters": [
                          {
                            "columnMatch": "KBID",
                            "formatter": 1,
                            "formatOptions": {
                              "linkTarget": "GenericDetails",
                              "linkIsContextBlade": true,
                              "showIcon": true
                            }
                          },
                          {
                            "columnMatch": "Title",
                            "formatter": 5,
                            "formatOptions": {
                              "showIcon": true
                            }
                          },
                          {
                            "columnMatch": "PublishedDate",
                            "formatter": 5,
                            "formatOptions": {
                              "showIcon": true
                            }
                          },
                          {
                            "columnMatch": "Product",
                            "formatter": 5,
                            "formatOptions": {
                              "showIcon": true
                            }
                          },
                          {
                            "columnMatch": "MSRCSeverity",
                            "formatter": 5,
                            "formatOptions": {
                              "showIcon": true
                            }
                          },
                          {
                            "columnMatch": "RebootBehavior",
                            "formatter": 5,
                            "formatOptions": {
                              "showIcon": true
                            }
                          },
                          {
                            "columnMatch": "Approved",
                            "formatter": 5,
                            "formatOptions": {
                              "showIcon": true
                            }
                          }
                        ],
                        "filter": true,
                        "sortBy": [
                          {
                            "itemKey": "$gen_link_KBID_4",
                            "sortOrder": 1
                          }
                        ]
                      },
                      "sortBy": [
                        {
                          "itemKey": "$gen_link_KBID_4",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "customWidth": "33",
                    "conditionalVisibility": {
                      "parameterName": "_",
                      "comparison": "isEqualTo",
                      "value": "_"
                    },
                    "showPin": true,
                    "name": "AllUpdateNeeded_hidden",
                    "styleSettings": {
                      "showBorder": true
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "Resources | where id in~ ({Workspaces}) | project id, name, properties.customerId",
                      "size": 0,
                      "title": "workspace_lookup",
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources",
                      "crossComponentResources": [
                        "{Subscriptions}"
                      ]
                    },
                    "customWidth": "33",
                    "conditionalVisibility": {
                      "parameterName": "_",
                      "comparison": "isEqualTo",
                      "value": "_"
                    },
                    "name": "workspace_lookup",
                    "styleSettings": {
                      "showBorder": true
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\",\"mergeType\":\"innerunique\",\"leftTable\":\"workspace_lookup\",\"rightTable\":\"updateBySelectedComputer_hidden\",\"leftColumn\":\"properties_customerId\",\"rightColumn\":\"TenantId\"}],\"projectRename\":[{\"originalName\":\"[updateBySelectedComputer_hidden].TimeGenerated\",\"mergedName\":\"TimeGenerated\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[updateBySelectedComputer_hidden].Computer\",\"mergedName\":\"Computer\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[workspace_lookup].id\",\"mergedName\":\"Workspace\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[updateBySelectedComputer_hidden].UpdateState\",\"mergedName\":\"UpdateState\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[updateBySelectedComputer_hidden].Classification\",\"mergedName\":\"Classification\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[updateBySelectedComputer_hidden].KBID\",\"mergedName\":\"KBID\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[updateBySelectedComputer_hidden].Title\",\"mergedName\":\"Title\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[updateBySelectedComputer_hidden].PublishedDate\",\"mergedName\":\"PublishedDate\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[updateBySelectedComputer_hidden].Product\",\"mergedName\":\"Product\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[updateBySelectedComputer_hidden].MSRCSeverity\",\"mergedName\":\"MSRCSeverity\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[updateBySelectedComputer_hidden].RebootBehavior\",\"mergedName\":\"RebootBehavior\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[updateBySelectedComputer_hidden].Approved\",\"mergedName\":\"Approved\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[workspace_lookup].name\"},{\"originalName\":\"[workspace_lookup].properties_customerId\"},{\"originalName\":\"[updateBySelectedComputer].TenantId\"},{\"originalName\":\"[updateBySelectedComputer_hidden].TenantId\"}]}",
                      "size": 0,
                      "title": "List of all missing updates by selected computer",
                      "queryType": 7,
                      "gridSettings": {
                        "formatters": [
                          {
                            "columnMatch": "KBID",
                            "formatter": 1,
                            "formatOptions": {
                              "linkTarget": "GenericDetails",
                              "linkIsContextBlade": true,
                              "showIcon": true
                            }
                          },
                          {
                            "columnMatch": "PublishedDate",
                            "formatter": 5,
                            "formatOptions": {
                              "showIcon": true
                            }
                          },
                          {
                            "columnMatch": "Product",
                            "formatter": 5,
                            "formatOptions": {
                              "showIcon": true
                            }
                          },
                          {
                            "columnMatch": "MSRCSeverity",
                            "formatter": 5,
                            "formatOptions": {
                              "showIcon": true
                            }
                          },
                          {
                            "columnMatch": "RebootBehavior",
                            "formatter": 5,
                            "formatOptions": {
                              "showIcon": true
                            }
                          },
                          {
                            "columnMatch": "Approved",
                            "formatter": 5,
                            "formatOptions": {
                              "showIcon": true
                            }
                          },
                          {
                            "columnMatch": "TenantId",
                            "formatter": 5,
                            "formatOptions": {
                              "showIcon": true
                            }
                          }
                        ],
                        "filter": true
                      },
                      "sortBy": []
                    },
                    "conditionalVisibility": {
                      "parameterName": "row",
                      "comparison": "isNotEqualTo"
                    },
                    "showPin": false,
                    "name": "updateBySelectedComputer_Windows"
                  },
                  {
                    "type": 1,
                    "content": {
                      "json": "ðŸ’¡ _Click on the Computer name above to see more details about missing updates._"
                    },
                    "conditionalVisibility": {
                      "parameterName": "row",
                      "comparison": "isEqualTo"
                    },
                    "name": "GuideToComputerSelection_Windows",
                    "styleSettings": {
                      "showBorder": true
                    }
                  },
                  {
                    "type": 1,
                    "content": {
                      "json": "ðŸ’¡ _Click on the KB number in KBID column to see more details._"
                    },
                    "conditionalVisibility": {
                      "parameterName": "row",
                      "comparison": "isNotEqualTo"
                    },
                    "name": "GuideToKBDetails_Windows"
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\",\"mergeType\":\"innerunique\",\"leftTable\":\"workspace_lookup\",\"rightTable\":\"AllUpdateNeeded_hidden\",\"leftColumn\":\"properties_customerId\",\"rightColumn\":\"TenantId\"}],\"projectRename\":[{\"originalName\":\"[AllUpdateNeeded_hidden].TimeGenerated\",\"mergedName\":\"TimeGenerated\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[AllUpdateNeeded_hidden].Computer\",\"mergedName\":\"Computer\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[workspace_lookup].id\",\"mergedName\":\"Workspace\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[AllUpdateNeeded_hidden].UpdateState\",\"mergedName\":\"UpdateState\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[AllUpdateNeeded_hidden].Classification\",\"mergedName\":\"Classification\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[AllUpdateNeeded_hidden].KBID\",\"mergedName\":\"KBID\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[AllUpdateNeeded_hidden].Title\",\"mergedName\":\"Title\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[AllUpdateNeeded_hidden].PublishedDate\",\"mergedName\":\"PublishedDate\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[AllUpdateNeeded_hidden].Product\",\"mergedName\":\"Product\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[AllUpdateNeeded_hidden].MSRCSeverity\",\"mergedName\":\"MSRCSeverity\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[AllUpdateNeeded_hidden].RebootBehavior\",\"mergedName\":\"RebootBehavior\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[AllUpdateNeeded_hidden].Approved\",\"mergedName\":\"Approved\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[workspace_lookup].name\"},{\"originalName\":\"[workspace_lookup].properties_customerId\"},{\"originalName\":\"[AllUpdateNeeded_hidden].TenantId\"}]}",
                      "size": 0,
                      "title": "List of all updates needed",
                      "queryType": 7,
                      "gridSettings": {
                        "formatters": [
                          {
                            "columnMatch": "KBID",
                            "formatter": 1,
                            "formatOptions": {
                              "linkTarget": "GenericDetails",
                              "linkIsContextBlade": true
                            }
                          },
                          {
                            "columnMatch": "PublishedDate",
                            "formatter": 5
                          },
                          {
                            "columnMatch": "Product",
                            "formatter": 5,
                            "formatOptions": {
                              "linkTarget": "GenericDetails",
                              "linkIsContextBlade": true
                            }
                          },
                          {
                            "columnMatch": "MSRCSeverity",
                            "formatter": 5
                          },
                          {
                            "columnMatch": "RebootBehavior",
                            "formatter": 5
                          },
                          {
                            "columnMatch": "Approved",
                            "formatter": 5
                          },
                          {
                            "columnMatch": "TenantId",
                            "formatter": 5
                          }
                        ],
                        "filter": true,
                        "sortBy": [
                          {
                            "itemKey": "Computer",
                            "sortOrder": 1
                          }
                        ]
                      },
                      "sortBy": [
                        {
                          "itemKey": "Computer",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "name": "AllUpdateNeeded_Windows",
                    "styleSettings": {
                      "showBorder": true
                    }
                  },
                  {
                    "type": 1,
                    "content": {
                      "json": "ðŸ’¡ _Click on the KB number in KBID column to see more details._"
                    },
                    "name": "kbidDetails_Windows"
                  }
                ]
              },
              "name": "MissingUpdateDetails_Windows",
              "styleSettings": {
                "showBorder": true
              }
            }
          ]
        },
        "conditionalVisibility": {
          "parameterName": "selectedTab",
          "comparison": "isEqualTo",
          "value": "Windows"
        },
        "name": "grp_Windows"
      },
      {
        "type": 12,
        "content": {
          "version": "NotebookGroup/1.0",
          "groupType": "editable",
          "items": [
            {
              "type": 9,
              "content": {
                "version": "KqlParameterItem/1.0",
                "crossComponentResources": [
                  "{Workspaces}"
                ],
                "parameters": [
                  {
                    "id": "01b782de-6cb7-4c31-b6ad-0a502c604fbe",
                    "version": "KqlParameterItem/1.0",
                    "name": "Servers",
                    "type": 2,
                    "isRequired": true,
                    "multiSelect": true,
                    "quote": "'",
                    "delimiter": ",",
                    "query": "Update\r\n| where OSType == \"Linux\"\r\n| distinct SourceComputerId, Computer\r\n| project Computer\r\n| order by Computer asc",
                    "crossComponentResources": [
                      "{Workspaces}"
                    ],
                    "typeSettings": {
                      "additionalResourceOptions": [
                        "value::all"
                      ],
                      "showDefault": false
                    },
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "defaultValue": "value::all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  {
                    "id": "6c8b0c26-2abe-47f8-b52e-96c5cb142492",
                    "version": "KqlParameterItem/1.0",
                    "name": "ExcludeByClassification",
                    "label": "Exclude by Classification",
                    "type": 2,
                    "multiSelect": true,
                    "quote": "'",
                    "delimiter": ",",
                    "query": "Update\r\n| where OSType == \"Linux\"\r\n| where Optional==false \r\n| where Approved!=false \r\n| where UpdateState == \"Needed\" \r\n| distinct Classification\r\n| order by Classification desc\r\n ",
                    "crossComponentResources": [
                      "{Workspaces}"
                    ],
                    "typeSettings": {
                      "additionalResourceOptions": [
                        "value::all"
                      ],
                      "showDefault": false
                    },
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  }
                ],
                "style": "pills",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces"
              },
              "name": "ParameterSection_Linux"
            },
            {
              "type": 3,
              "content": {
                "version": "KqlItem/1.0",
                "query": "let excludedClassification = iif(\"{ExcludeByClassification}\"==\"\", dynamic(['Blank3','Blank4']), dynamic([{ExcludeByClassification}]));\r\nUpdate\r\n| where Computer in ({Servers})\r\n| where Approved!=false\r\n| where Classification !in (excludedClassification)\r\n| summarize arg_max(TimeGenerated, *) by SourceComputerId, KBID, Classification\r\n| summarize nonCompl=countif(UpdateState==\"Needed\"), compl=countif(UpdateState!=\"Needed\") by SourceComputerId\r\n| extend status = iif((compl>0 and nonCompl==0),\"Compliant\",iif((compl>=0 and nonCompl>0),\"Not-Compliant\",\"Unknown\"))\r\n| summarize compliance = count() by status\r\n| sort by status asc",
                "size": 0,
                "title": "Update compliance status",
                "noDataMessage": "No data for the selected conditions.",
                "timeContext": {
                  "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                  "{Workspaces}"
                ],
                "visualization": "piechart",
                "sortBy": [],
                "tileSettings": {
                  "titleContent": {
                    "columnMatch": "status",
                    "formatter": 1,
                    "formatOptions": {}
                  },
                  "leftContent": {
                    "columnMatch": "compliance",
                    "formatter": 1,
                    "formatOptions": {},
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  "rightContent": {
                    "columnMatch": "status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Not-Compliant",
                          "representation": "redBright",
                          "text": "Server(s)"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Unknown",
                          "representation": "gray",
                          "text": "Server(s)"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "green",
                          "text": "Server(s)"
                        }
                      ]
                    }
                  },
                  "showBorder": false
                },
                "graphSettings": {
                  "type": 0,
                  "topContent": {
                    "columnMatch": "status",
                    "formatter": 1
                  },
                  "centerContent": {
                    "columnMatch": "compliance",
                    "formatter": 1,
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "maximumSignificantDigits": 3,
                        "maximumFractionDigits": 2
                      }
                    }
                  }
                },
                "chartSettings": {
                  "seriesLabelSettings": [
                    {
                      "seriesName": "Not-Compliant",
                      "label": "Not-Compliant Server(s)",
                      "color": "redBright"
                    },
                    {
                      "seriesName": "Compliant",
                      "label": "Compliant Server(s)",
                      "color": "green"
                    },
                    {
                      "seriesName": "Unknown",
                      "color": "gray"
                    }
                  ]
                },
                "mapSettings": {
                  "locInfo": "AzureResource",
                  "sizeSettings": "compliance",
                  "sizeAggregation": "Sum",
                  "legendMetric": "compliance",
                  "legendAggregation": "Sum",
                  "itemColorSettings": {
                    "type": "heatmap",
                    "colorAggregation": "Sum",
                    "nodeColorField": "compliance",
                    "heatmapPalette": "greenRed"
                  }
                }
              },
              "customWidth": "40",
              "showPin": true,
              "name": "UpdateComplianceStatus_Linux",
              "styleSettings": {
                "showBorder": true
              }
            },
            {
              "type": 3,
              "content": {
                "version": "KqlItem/1.0",
                "query": "let excludedClassification = iif(\"{ExcludeByClassification}\"==\"\", dynamic(['Blank3','Blank4']), dynamic([{ExcludeByClassification}]));\r\nUpdate\r\n| where Computer in ({Servers})\r\n| where Approved!=false\r\n| where Classification !in (excludedClassification)\r\n| summarize arg_max(TimeGenerated, *) by SourceComputerId, KBID, Classification\r\n| summarize Updates_Count=countif(UpdateState==\"Needed\") by Classification\r\n| sort by Classification asc",
                "size": 0,
                "showAnalytics": true,
                "title": "Total missing updates by Classification",
                "noDataMessage": "No data for the selected conditions.",
                "timeContext": {
                  "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "showExportToExcel": true,
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                  "{Workspaces}"
                ],
                "visualization": "barchart"
              },
              "customWidth": "60",
              "showPin": true,
              "name": "TotalMissingUpdates_Linux",
              "styleSettings": {
                "showBorder": true
              }
            },
            {
              "type": 12,
              "content": {
                "version": "NotebookGroup/1.0",
                "groupType": "editable",
                "title": "Missing Update details",
                "items": [
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "let excludedClassification = iif(\"{ExcludeByClassification}\"==\"\", dynamic(['Blank3','Blank4']), dynamic([{ExcludeByClassification}]));\r\nUpdate\r\n| where Computer in ({Servers})\r\n| where Approved!=false\r\n| where Classification !in (excludedClassification)\r\n| summarize arg_max(TimeGenerated, *) by SourceComputerId, KBID, Classification\r\n| where UpdateState == \"Needed\" \r\n| summarize Updates_Count=count() by SourceComputerId, Computer\r\n| order by Updates_Count desc",
                      "size": 0,
                      "showAnalytics": true,
                      "title": "Total by computer",
                      "noDataMessage": "No data for the selected conditions.",
                      "timeContext": {
                        "durationMs": 0
                      },
                      "timeContextFromParameter": "TimeRange",
                      "exportFieldName": "SourceComputerId",
                      "exportParameterName": "row",
                      "exportDefaultValue": "",
                      "showExportToExcel": true,
                      "queryType": 0,
                      "resourceType": "microsoft.operationalinsights/workspaces",
                      "crossComponentResources": [
                        "{Workspaces}"
                      ],
                      "visualization": "tiles",
                      "gridSettings": {
                        "filter": true,
                        "sortBy": [
                          {
                            "itemKey": "Computer",
                            "sortOrder": 1
                          }
                        ]
                      },
                      "sortBy": [
                        {
                          "itemKey": "Computer",
                          "sortOrder": 1
                        }
                      ],
                      "tileSettings": {
                        "titleContent": {
                          "columnMatch": "Computer",
                          "formatter": 1,
                          "formatOptions": {
                            "showIcon": true
                          }
                        },
                        "leftContent": {
                          "columnMatch": "Updates_Count",
                          "formatter": 12,
                          "formatOptions": {
                            "palette": "auto",
                            "linkTarget": "GenericDetails",
                            "linkIsContextBlade": true,
                            "showIcon": true
                          },
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        "showBorder": false
                      },
                      "graphSettings": {
                        "type": 0,
                        "topContent": {
                          "columnMatch": "Computer",
                          "formatter": 1
                        },
                        "centerContent": {
                          "columnMatch": "Updates_Count",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "maximumSignificantDigits": 3,
                              "maximumFractionDigits": 2
                            }
                          }
                        }
                      }
                    },
                    "showPin": true,
                    "name": "TotalByComputer_Windows",
                    "styleSettings": {
                      "showBorder": true
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "let excludedClassification = iif(\"{ExcludeByClassification}\"==\"\", dynamic(['Blank3','Blank4']), dynamic([{ExcludeByClassification}]));\r\nUpdate\r\n| where SourceComputerId == tostring(\"{row}\")\r\n| where Approved!=false\r\n| where Classification !in (excludedClassification)\r\n| summarize arg_max(TimeGenerated, *) by SourceComputerId, Product, Classification\r\n| where UpdateState == \"Needed\" \r\n| project TimeGenerated, Computer, UpdateState, Classification, TenantId, Product, ProductVersion, ProductArch, PackageRepository",
                      "size": 0,
                      "showAnalytics": true,
                      "title": "updateBySelectedComputer_hidden",
                      "timeContext": {
                        "durationMs": 0
                      },
                      "timeContextFromParameter": "TimeRange",
                      "showExportToExcel": true,
                      "queryType": 0,
                      "resourceType": "microsoft.operationalinsights/workspaces",
                      "crossComponentResources": [
                        "{Workspaces}"
                      ],
                      "visualization": "table",
                      "gridSettings": {
                        "filter": true
                      },
                      "sortBy": []
                    },
                    "customWidth": "33",
                    "conditionalVisibilities": [
                      {
                        "parameterName": "row",
                        "comparison": "isNotEqualTo",
                        "value": ""
                      },
                      {
                        "parameterName": "_",
                        "comparison": "isEqualTo",
                        "value": "_"
                      }
                    ],
                    "showPin": true,
                    "name": "updateBySelectedComputerLinux_hidden",
                    "styleSettings": {
                      "showBorder": true
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "let excludedClassification = iif(\"{ExcludeByClassification}\"==\"\", dynamic(['Blank3','Blank4']), dynamic([{ExcludeByClassification}]));\r\nUpdate\r\n| where Computer in ({Servers})\r\n| where Approved!=false\r\n| where Classification !in (excludedClassification)\r\n| summarize arg_max(TimeGenerated, *) by SourceComputerId, Product, Classification\r\n| where UpdateState == \"Needed\" \r\n| project TimeGenerated, Computer, UpdateState, Classification, TenantId, Product, ProductVersion, ProductArch, PackageRepository\r\n",
                      "size": 0,
                      "showAnalytics": true,
                      "title": "AllUpdateNeeded_hidden",
                      "noDataMessage": "No data for the selected conditions.",
                      "timeContext": {
                        "durationMs": 0
                      },
                      "timeContextFromParameter": "TimeRange",
                      "showExportToExcel": true,
                      "queryType": 0,
                      "resourceType": "microsoft.operationalinsights/workspaces",
                      "crossComponentResources": [
                        "{Workspaces}"
                      ],
                      "visualization": "table",
                      "gridSettings": {
                        "filter": true
                      },
                      "sortBy": []
                    },
                    "customWidth": "33",
                    "conditionalVisibility": {
                      "parameterName": "_",
                      "comparison": "isEqualTo",
                      "value": "_"
                    },
                    "showPin": true,
                    "name": "AllUpdateNeededLinux_hidden",
                    "styleSettings": {
                      "showBorder": true
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "Resources | where id in~ ({Workspaces}) | project id, name, properties.customerId",
                      "size": 0,
                      "title": "workspace_lookup",
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources",
                      "crossComponentResources": [
                        "{Subscriptions}"
                      ]
                    },
                    "customWidth": "33",
                    "conditionalVisibility": {
                      "parameterName": "_",
                      "comparison": "isEqualTo",
                      "value": "_"
                    },
                    "name": "workspace_lookup",
                    "styleSettings": {
                      "showBorder": true
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\",\"mergeType\":\"innerunique\",\"leftTable\":\"workspace_lookup\",\"rightTable\":\"updateBySelectedComputerLinux_hidden\",\"leftColumn\":\"properties_customerId\",\"rightColumn\":\"TenantId\"}],\"projectRename\":[{\"originalName\":\"[updateBySelectedComputerLinux_hidden].TimeGenerated\",\"mergedName\":\"TimeGenerated\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[updateBySelectedComputerLinux_hidden].Computer\",\"mergedName\":\"Computer\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[workspace_lookup].id\",\"mergedName\":\"id\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[updateBySelectedComputerLinux_hidden].UpdateState\",\"mergedName\":\"UpdateState\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[updateBySelectedComputerLinux_hidden].Classification\",\"mergedName\":\"Classification\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[updateBySelectedComputerLinux_hidden].Product\",\"mergedName\":\"Product\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[updateBySelectedComputerLinux_hidden].ProductVersion\",\"mergedName\":\"ProductVersion\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[updateBySelectedComputerLinux_hidden].ProductArch\",\"mergedName\":\"ProductArch\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[updateBySelectedComputerLinux_hidden].PackageRepository\",\"mergedName\":\"PackageRepository\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b21f\"},{\"originalName\":\"[workspace_lookup].name\"},{\"originalName\":\"[workspace_lookup].properties_customerId\"},{\"originalName\":\"[updateBySelectedComputer].TenantId\"},{\"originalName\":\"[updateBySelectedComputer_hidden].TenantId\"},{\"originalName\":\"[updateBySelectedComputerLinux_hidden].TenantId\"}]}",
                      "size": 0,
                      "title": "List of all missing updates by selected computer",
                      "queryType": 7,
                      "gridSettings": {
                        "formatters": [
                          {
                            "columnMatch": "TimeGenerated",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "26ch"
                            }
                          },
                          {
                            "columnMatch": "Computer",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "21ch"
                            }
                          },
                          {
                            "columnMatch": "id",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "32.5ch"
                            }
                          },
                          {
                            "columnMatch": "UpdateState",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "17ch"
                            }
                          },
                          {
                            "columnMatch": "Classification",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "22ch"
                            }
                          },
                          {
                            "columnMatch": "Product",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "34.8571ch"
                            }
                          },
                          {
                            "columnMatch": "ProductVersion",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "42ch"
                            }
                          },
                          {
                            "columnMatch": "ProductArch",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "17ch"
                            }
                          },
                          {
                            "columnMatch": "PackageRepository",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "23ch"
                            }
                          }
                        ],
                        "filter": true,
                        "labelSettings": [
                          {
                            "columnId": "id",
                            "label": "Workspace"
                          }
                        ]
                      },
                      "sortBy": []
                    },
                    "conditionalVisibility": {
                      "parameterName": "row",
                      "comparison": "isNotEqualTo"
                    },
                    "showPin": false,
                    "name": "updateBySelectedComputer_Linux"
                  },
                  {
                    "type": 1,
                    "content": {
                      "json": "ðŸ’¡ _Click on the Computer name above to see more details about missing updates._"
                    },
                    "conditionalVisibility": {
                      "parameterName": "row",
                      "comparison": "isEqualTo"
                    },
                    "name": "GuideToComputerSelection_Windows",
                    "styleSettings": {
                      "showBorder": true
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\",\"mergeType\":\"innerunique\",\"leftTable\":\"workspace_lookup\",\"rightTable\":\"AllUpdateNeededLinux_hidden\",\"leftColumn\":\"properties_customerId\",\"rightColumn\":\"TenantId\"}],\"projectRename\":[{\"originalName\":\"[AllUpdateNeededLinux_hidden].TimeGenerated\",\"mergedName\":\"TimeGenerated\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[AllUpdateNeededLinux_hidden].Computer\",\"mergedName\":\"Computer\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[workspace_lookup].id\",\"mergedName\":\"id\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[AllUpdateNeededLinux_hidden].UpdateState\",\"mergedName\":\"UpdateState\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[AllUpdateNeededLinux_hidden].Classification\",\"mergedName\":\"Classification\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[AllUpdateNeededLinux_hidden].Product\",\"mergedName\":\"Product\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[AllUpdateNeededLinux_hidden].ProductVersion\",\"mergedName\":\"ProductVersion\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[AllUpdateNeededLinux_hidden].ProductArch\",\"mergedName\":\"ProductArch\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[AllUpdateNeededLinux_hidden].PackageRepository\",\"mergedName\":\"PackageRepository\",\"fromId\":\"57c84d2e-df44-4e7d-bc74-e01c44f0b22b\"},{\"originalName\":\"[workspace_lookup].name\"},{\"originalName\":\"[workspace_lookup].properties_customerId\"},{\"originalName\":\"[AllUpdateNeeded_hidden].TenantId\"},{\"originalName\":\"[AllUpdateNeededLinux_hidden].TenantId\"}]}",
                      "size": 0,
                      "title": "List of all updates needed",
                      "queryType": 7,
                      "gridSettings": {
                        "formatters": [
                          {
                            "columnMatch": "TimeGenerated",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "26ch"
                            }
                          },
                          {
                            "columnMatch": "Computer",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "19ch"
                            }
                          },
                          {
                            "columnMatch": "id",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "32.5ch"
                            }
                          },
                          {
                            "columnMatch": "UpdateState",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "17ch"
                            }
                          },
                          {
                            "columnMatch": "Classification",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "20ch"
                            }
                          },
                          {
                            "columnMatch": "Product",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "36ch"
                            }
                          },
                          {
                            "columnMatch": "ProductVersion",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "42ch"
                            }
                          },
                          {
                            "columnMatch": "ProductArch",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "17ch"
                            }
                          },
                          {
                            "columnMatch": "PackageRepository",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "33ch"
                            }
                          }
                        ],
                        "filter": true,
                        "sortBy": [
                          {
                            "itemKey": "Computer",
                            "sortOrder": 1
                          }
                        ],
                        "labelSettings": [
                          {
                            "columnId": "id",
                            "label": "Workspace"
                          }
                        ]
                      },
                      "sortBy": [
                        {
                          "itemKey": "Computer",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "name": "AllUpdateNeeded_Windows",
                    "styleSettings": {
                      "showBorder": true
                    }
                  }
                ]
              },
              "name": "MissingUpdateDetails_Windows",
              "styleSettings": {
                "showBorder": true
              }
            }
          ]
        },
        "conditionalVisibility": {
          "parameterName": "selectedTab",
          "comparison": "isEqualTo",
          "value": "Linux"
        },
        "name": "grp_Linux"
      }
    ],
    "fallbackResourceIds": [
      "Azure Monitor"
    ],
    "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
  }