{
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "Change Tracking",
      "metadata": {
        "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "workbook",
      "metadata": {
        "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
      }
    },
    "workbookSourceId": {
      "type": "string",
      "defaultValue": "Azure Monitor",
      "metadata": {
        "description": "The id of resource instance to which the workbook will be associated"
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    }
  },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2018-06-17-preview",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"21dea311-7dfc-41fb-99f6-d72f0f0c33c9\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscriptions\",\"type\":6,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::1\",\"value::all\"],\"includeAll\":false}},{\"id\":\"9b289ad1-7eaa-411d-b2b0-43c69cf5aa14\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"value\":{\"durationMs\":86400000}},{\"id\":\"0698db8c-7a3a-4aec-bfb2-eb59942b0375\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"where type =~ 'microsoft.operationalinsights/workspaces'\",\"crossComponentResources\":[\"{Subscriptions}\"],\"typeSettings\":{\"additionalResourceOptions\":[]},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":[\"/subscriptions/8cc1a4b7-7849-4303-b6ae-13e38074cce2/resourceGroups/VS_Monitoring/providers/Microsoft.OperationalInsights/workspaces/VS-Sandlot\"]},{\"id\":\"22a1d683-7992-454d-a97d-14c43b0705cc\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Heartbeat\",\"type\":1,\"isRequired\":true,\"query\":\"Heartbeat\\r\\n| summarize HeartbeatCount=dcount(Computer)\\r\\n\",\"crossComponentResources\":[\"{Workspace}\"],\"isHiddenWhenLocked\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"f5050feb-8763-4358-8f21-8000b8fb3235\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ChangeTracking\",\"type\":1,\"isRequired\":true,\"query\":\"ConfigurationData\\r\\n| summarize ConfigCount=dcount(Computer)\",\"crossComponentResources\":[\"{Workspace}\"],\"isHiddenWhenLocked\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 0\"},{\"type\":1,\"content\":{\"json\":\"## There are {ChangeTracking} machines scoped to Change Tracking out of {Heartbeat} reporting to Log Analytics \"},\"name\":\"text - 8\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Software\",\"subTarget\":\"software\",\"style\":\"link\"},{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Services\",\"subTarget\":\"services\",\"style\":\"link\"},{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Updates\",\"subTarget\":\"updates\",\"style\":\"link\"}]},\"name\":\"links - 2\"},{\"type\":1,\"content\":{\"json\":\"# Change Tracking - Windows Services\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"services\"},\"name\":\"text - Services\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"769f0149-8413-450a-a96d-8912f2d1b47d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Computer\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"ConfigurationData\\r\\n| distinct _ResourceId\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::1\",\"value::all\"]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"4a64dd88-3926-4075-a2bf-04aa91170d0a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ServiceName\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"ConfigurationData\\r\\n| where ConfigDataType == \\\"WindowsServices\\\"\\r\\n| where _ResourceId in~ ({Computer}) or '*' in~ ({Computer}) \\r\\n| distinct SvcName\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::1\",\"value::all\"]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"doNotRunWhenHidden\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"services\"},\"name\":\"parameters - Services\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ConfigurationData\\r\\n| where ConfigDataType == \\\"WindowsServices\\\"\\r\\n| project Computer=_ResourceId, SvcDisplayName, SvcName, SvcState, SvcAccount, SvcPath, SvcDescription\\r\\n| where Computer in~ ({Computer}) or '*' in~ ({Computer}) \\r\\n| where SvcName in~ ({ServiceName}) or '*' in~ ({ServiceName})\\r\\n\",\"size\":2,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"services\"},\"name\":\"query - Services\"},{\"type\":1,\"content\":{\"json\":\"# Change Tracking - Software Inventory\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"software\"},\"name\":\"text - Software\"},{\"type\":1,\"content\":{\"json\":\"# Change Tracking - Updates\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"updates\"},\"name\":\"text - Updates\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"2701e62d-09fc-46bf-940a-ed35acdde578\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Computer\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"Heartbeat\\r\\n| distinct _ResourceId\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::1\",\"value::all\"]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"0152f4ef-fb06-4827-b920-c523b37ee5ca\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Publisher\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"ConfigurationData\\r\\n| where ConfigDataType == \\\"Software\\\"\\r\\n| where _ResourceId in~ ({Computer}) or '*' in~ ({Computer}) \\r\\n| distinct Publisher\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::1\",\"value::all\"]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"028d3fb0-611e-4132-a235-05ccd1736545\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Application\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"ConfigurationData\\r\\n| where ConfigDataType == \\\"Software\\\"\\r\\n| where SoftwareType == \\\"Application\\\"\\r\\n| where _ResourceId in~ ({Computer}) or '*' in~ ({Computer}) \\r\\n| distinct SoftwareName\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"PowerShell 6-x64\",\"Windows Admin Center\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::1\",\"value::all\"]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"doNotRunWhenHidden\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"software\"},\"name\":\"parameters - Software\"},{\"type\":1,\"content\":{\"json\":\"### Distinct count of publishers and Application across selected parameters\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"software\"},\"name\":\"text - Software\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ConfigurationData\\r\\n| where _ResourceId in~ ({Computer}) or '*' in~ ({Computer}) \\r\\n| summarize Publishers=dcount(Publisher), Software=dcount(SoftwareName)\\r\\n| evaluate narrow()\",\"size\":4,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Column\",\"formatter\":1},\"rightContent\":{\"columnMatch\":\"Value\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"}},\"showBorder\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"software\"},\"name\":\"query - Software\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"2701e62d-09fc-46bf-940a-ed35acdde578\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Computer\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"Heartbeat\\r\\n| distinct _ResourceId\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::1\",\"value::all\"]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"0152f4ef-fb06-4827-b920-c523b37ee5ca\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"UpdateSource\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"ConfigurationData\\r\\n| where ConfigDataType == \\\"Software\\\"\\r\\n| where SoftwareType == \\\"Update\\\"\\r\\n| where _ResourceId in~ ({Computer}) or '*' in~ ({Computer}) \\r\\n| distinct Publisher\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::1\",\"value::all\"]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"028d3fb0-611e-4132-a235-05ccd1736545\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Update\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"ConfigurationData\\r\\n| where ConfigDataType == \\\"Software\\\"\\r\\n| where SoftwareType == \\\"Update\\\"\\r\\n| where _ResourceId in~ ({Computer}) or '*' in~ ({Computer}) \\r\\n| distinct SoftwareName\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::1\",\"value::all\"]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"doNotRunWhenHidden\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"updates\"},\"name\":\"parameters - Updates\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ConfigurationData\\r\\n| where ConfigDataType == \\\"Software\\\"\\r\\n| where SoftwareType == \\\"Update\\\"\\r\\n| project Computer=_ResourceId, SoftwareName, Publisher, CurrentVersion, TimeGenerated\\r\\n| where Computer in~ ({Computer}) or '*' in~ ({Computer}) \\r\\n| where Publisher in~ ({UpdateSource}) or '*' in ({UpdateSource})\\r\\n| where SoftwareName in~ ({Update}) or '*' in ({Update})\",\"size\":2,\"timeContext\":{\"durationMs\":86400000},\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"updates\"},\"name\":\"query - Updates\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ConfigurationData\\r\\n| where ConfigDataType == \\\"Software\\\"\\r\\n| where SoftwareType == \\\"Application\\\"\\r\\n| project Computer=_ResourceId, SoftwareName, Publisher, CurrentVersion, TimeGenerated\\r\\n| where Computer in~ ({Computer}) or '*' in~ ({Computer}) \\r\\n| where Publisher in~ ({Publisher}) or '*' in ({Publisher})\\r\\n| where SoftwareName in~ ({Application}) or '*' in ({Application})\",\"size\":2,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"software\"},\"name\":\"Software\"}],\"isLocked\":false,\"fallbackResourceIds\":[\"Azure Monitor\"]}",
        "version": "1.0",
        "sourceId": "[parameters('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
}